# Phase 3.3: Prompt ä¼˜åŒ–ä¸éªŒè¯ - è¯¦ç»†è®¡åˆ’

**ç›®æ ‡**: ä¼˜åŒ–ä½œä¸šæ‰¹æ”¹ Promptï¼Œè¾¾åˆ° â‰¥90% çš„æ‰¹æ”¹å‡†ç¡®ç‡  
**é¢„è®¡æ—¶é•¿**: 60 åˆ†é’Ÿ  
**å‰ç½®æ¡ä»¶**: Phase 3.2 é›†æˆæµ‹è¯•æ¡†æ¶å·²å®Œæˆï¼ˆ18/18 é€šè¿‡ âœ…ï¼‰

---

## ğŸ“‹ ç°çŠ¶åˆ†æ

### å·²å®Œæˆï¼ˆPhase 3.2ï¼‰

- âœ… æ•°æ®åº“è¿ç§»ï¼ˆ4 ä¸ªæ–°å­—æ®µï¼‰
- âœ… æœåŠ¡å±‚å®ç°ï¼ˆæ‰¹æ”¹åœºæ™¯åˆ¤æ–­ã€AI è°ƒç”¨ã€é”™é¢˜åˆ›å»ºï¼‰
- âœ… é›†æˆæµ‹è¯•æ¡†æ¶ï¼ˆ18 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼‰
- âœ… åŸºç¡€ Prompt å®ç°ï¼ˆ`HOMEWORK_CORRECTION_PROMPT`ï¼‰

### å½“å‰ Prompt ä½ç½®

**æ–‡ä»¶**: `src/services/learning_service.py` (è¡Œ 75-127)

**æ ¸å¿ƒå†…å®¹**:

```python
HOMEWORK_CORRECTION_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„æ•™è‚²å·¥ä½œè€…å’Œå­¦ç§‘ä¸“å®¶ï¼Œæ“…é•¿æ‰¹æ”¹å­¦ç”Ÿä½œä¸šã€‚
...ï¼ˆ53 è¡Œ Promptï¼‰
- å­¦ç§‘ï¼š{subject}
"""
```

**å½“å‰èƒ½åŠ›**:

- âœ… åŸºæœ¬çš„ JSON æ ¼å¼å®šä¹‰
- âœ… å­¦ç§‘å ä½ç¬¦æ”¯æŒ
- âœ… é”™è¯¯ç±»å‹åˆ†ç±»æŒ‡å¯¼
- âš ï¸ æœªç»è¿‡çœŸå®æ•°æ®éªŒè¯
- âš ï¸ å‡†ç¡®ç‡æœªçŸ¥

---

## ğŸ¯ Phase 3.3 ç›®æ ‡

1. **å‡†ç¡®ç‡ç›®æ ‡**: â‰¥90% çš„æ‰¹æ”¹å‡†ç¡®ç‡
2. **é²æ£’æ€§ç›®æ ‡**: å¤„ç† 5 ç§å…¸å‹åœºæ™¯ + 5 ç§è¾¹ç•Œæƒ…å†µ
3. **æ€§èƒ½ç›®æ ‡**: å•æ¬¡æ‰¹æ”¹ï¼ˆ5 é¢˜ä»¥å†…ï¼‰â‰¤30 ç§’
4. **å¯ç»´æŠ¤æ€§**: å®Œæ•´çš„æµ‹è¯•è¦†ç›–å’Œæ–‡æ¡£

---

## ğŸ“ Todo Listï¼ˆ12 é¡¹ä»»åŠ¡ï¼‰

### é˜¶æ®µ 1: ç†è§£ä¸å‡†å¤‡ï¼ˆ15 åˆ†é’Ÿï¼‰

#### Task 1: é˜…è¯»å¹¶ç†è§£å½“å‰ Prompt å®ç° â¸ï¸

**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**æ–‡ä»¶**: `src/services/learning_service.py` (è¡Œ 75-127)

**æ£€æŸ¥ç‚¹**:

- [ ] HOMEWORK_CORRECTION_PROMPT å¸¸é‡çš„å†…å®¹å’Œæ ¼å¼
- [ ] JSON Schema å®šä¹‰æ˜¯å¦å®Œæ•´ï¼ˆcorrections, summary, overall_score ç­‰ï¼‰
- [ ] å­¦ç§‘å ä½ç¬¦ {subject} çš„ä½¿ç”¨ä½ç½®
- [ ] æ˜¯å¦éœ€è¦æ·»åŠ æ›´å¤šæç¤ºè¯ä»¥æé«˜å‡†ç¡®ç‡

**éªŒè¯æ–¹æ³•**: é˜…è¯»ä»£ç ï¼Œç†è§£ Prompt ç»“æ„

---

#### Task 2: å‡†å¤‡æµ‹è¯•æ•°æ®é›† â¸ï¸

**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**ç›®å½•**: `tests/fixtures/homework_samples/` (æ–°å»º)

**å‡†å¤‡ 5 ä¸ªå…¸å‹åœºæ™¯**:

1. **åœºæ™¯ 1 - å•é¢˜ä½œä¸š**:

   - æ–‡ä»¶: `single_question_math.json`
   - å†…å®¹: 1 é“æ•°å­¦è®¡ç®—é¢˜ï¼ˆå¦‚: 125 + 376 = 501ï¼‰
   - é¢„æœŸ: æ­£ç¡®è¯†åˆ«é¢˜å·ã€ç­”æ¡ˆã€åˆ¤æ–­æ­£è¯¯

2. **åœºæ™¯ 2 - å…¨é”™ä½œä¸š**:

   - æ–‡ä»¶: `all_wrong_3questions.json`
   - å†…å®¹: 3 é¢˜å…¨é”™ï¼ˆä¸åŒé”™è¯¯ç±»å‹ï¼‰
     - è®¡ç®—é”™è¯¯ï¼ˆ24 + 18 = 40ï¼‰
     - æ¦‚å¿µé”™è¯¯ï¼ˆæŠŠé™¤æ³•å½“ä¹˜æ³•ï¼‰
     - ç†è§£é”™è¯¯ï¼ˆå®¡é¢˜ä¸æ¸…ï¼‰
   - é¢„æœŸ: æ­£ç¡®åˆ†ç±»é”™è¯¯ç±»å‹

3. **åœºæ™¯ 3 - å…¨å¯¹ä½œä¸š**:

   - æ–‡ä»¶: `all_correct_3questions.json`
   - å†…å®¹: 3 é¢˜å…¨å¯¹ï¼ˆé€‰æ‹©+å¡«ç©º+è§£ç­”ï¼‰
   - é¢„æœŸ: å…¨éƒ¨åˆ¤æ–­ä¸ºæ­£ç¡®ï¼Œerror_type ä¸º null

4. **åœºæ™¯ 4 - éƒ¨åˆ†æœªä½œç­”**:

   - æ–‡ä»¶: `partial_unanswered_5questions.json`
   - å†…å®¹: 5 é¢˜ï¼Œ2 é¢˜æœªä½œç­”ï¼Œ2 é¢˜æ­£ç¡®ï¼Œ1 é¢˜é”™è¯¯
   - é¢„æœŸ: is_unanswered æ­£ç¡®æ ‡è®°ï¼Œstudent_answer ä¸º null

5. **åœºæ™¯ 5 - æ··åˆé¢˜å‹**:
   - æ–‡ä»¶: `mixed_types.json`
   - å†…å®¹: é€‰æ‹©é¢˜ + å¡«ç©ºé¢˜ + è§£ç­”é¢˜
   - é¢„æœŸ: question_type æ­£ç¡®åˆ†ç±»

**æ•°æ®æ ¼å¼** (JSON):

```json
{
  "description": "åœºæ™¯1: å•é¢˜ä½œä¸š",
  "image_urls": ["mock://homework_image_1.jpg"],
  "subject": "æ•°å­¦",
  "expected_result": {
    "total_questions": 1,
    "corrections": [
      {
        "question_number": 1,
        "question_type": "è®¡ç®—é¢˜",
        "is_unanswered": false,
        "student_answer": "501",
        "correct_answer": "501",
        "error_type": null,
        "score": 100
      }
    ]
  }
}
```

**æ³¨æ„**: å¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿå›¾ç‰‡ URLï¼ˆå¦‚ `mock://...`ï¼‰æˆ–çœŸå®å›¾ç‰‡ URLï¼ˆå¦‚æœæœ‰èµ„æºï¼‰

---

### é˜¶æ®µ 2: åŸºçº¿æµ‹è¯•ï¼ˆ10 åˆ†é’Ÿï¼‰

#### Task 3: åˆ›å»º Prompt å‡†ç¡®æ€§æµ‹è¯•æ–‡ä»¶ â¸ï¸

**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**æ–‡ä»¶**: `tests/integration/test_prompt_accuracy.py` (æ–°å»º)

**æµ‹è¯•ç±»ç»“æ„**:

```python
import pytest
from src.services.learning_service import LearningService
from tests.fixtures.homework_samples import load_test_case

@pytest.mark.asyncio
class TestPromptAccuracy:
    """Prompt å‡†ç¡®æ€§æµ‹è¯•"""

    @pytest.fixture
    def learning_service(self, db_session):
        return LearningService(db_session)

    async def test_single_question_correction(self, learning_service):
        """æµ‹è¯•å•é¢˜ä½œä¸šæ‰¹æ”¹"""
        test_case = load_test_case("single_question_math.json")
        result = await learning_service._call_ai_for_homework_correction(
            image_urls=test_case["image_urls"],
            subject=test_case["subject"],
            user_hint=""
        )

        # éªŒè¯ JSON è§£ææˆåŠŸ
        assert "corrections" in result
        assert len(result["corrections"]) == test_case["expected_result"]["total_questions"]

        # éªŒè¯ç­”æ¡ˆåˆ¤æ–­å‡†ç¡®
        correction = result["corrections"][0]
        expected = test_case["expected_result"]["corrections"][0]
        assert correction["question_number"] == expected["question_number"]
        assert correction["is_unanswered"] == expected["is_unanswered"]
        assert correction["error_type"] == expected["error_type"]

    async def test_all_wrong_correction(self, learning_service):
        """æµ‹è¯•å…¨é”™ä½œä¸šæ‰¹æ”¹"""
        # å®ç°...

    async def test_all_correct_correction(self, learning_service):
        """æµ‹è¯•å…¨å¯¹ä½œä¸šæ‰¹æ”¹"""
        # å®ç°...

    async def test_partial_unanswered_correction(self, learning_service):
        """æµ‹è¯•éƒ¨åˆ†æœªä½œç­”æ‰¹æ”¹"""
        # å®ç°...

    async def test_mixed_question_types(self, learning_service):
        """æµ‹è¯•æ··åˆé¢˜å‹æ‰¹æ”¹"""
        # å®ç°...
```

**éªŒè¯æ¯ä¸ªæµ‹è¯•**:

- [ ] JSON è§£ææˆåŠŸï¼ˆæ—  JSONDecodeErrorï¼‰
- [ ] é¢˜å·æ­£ç¡®ï¼ˆä» 1 å¼€å§‹é€’å¢ï¼‰
- [ ] ç­”æ¡ˆåˆ¤æ–­å‡†ç¡®ï¼ˆæ­£ç¡®/é”™è¯¯/æœªä½œç­”ï¼‰
- [ ] çŸ¥è¯†ç‚¹æå–åˆç†ï¼ˆå…·ä½“ä¸”ç›¸å…³ï¼‰
- [ ] é”™è¯¯ç±»å‹åˆ†ç±»å‡†ç¡®ï¼ˆè®¡ç®—é”™è¯¯ã€æ¦‚å¿µé”™è¯¯ç­‰ï¼‰

---

#### Task 4: è¿è¡ŒåŸºçº¿æµ‹è¯•å¹¶è®°å½•åˆå§‹å‡†ç¡®ç‡ â¸ï¸

**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**å‘½ä»¤**: `uv run pytest tests/integration/test_prompt_accuracy.py -v --tb=short`

**è®°å½•å†…å®¹**:

```
åœºæ™¯1 (å•é¢˜ä½œä¸š): âœ… é€šè¿‡ | å‡†ç¡®ç‡: 100% (1/1)
åœºæ™¯2 (å…¨é”™ä½œä¸š): âŒ å¤±è´¥ | å‡†ç¡®ç‡: 66% (2/3)
  - é”™è¯¯1: é¢˜å·2çš„é”™è¯¯ç±»å‹è¯†åˆ«ä¸º"å•ä½é”™è¯¯"åº”ä¸º"è®¡ç®—é”™è¯¯"
åœºæ™¯3 (å…¨å¯¹ä½œä¸š): âœ… é€šè¿‡ | å‡†ç¡®ç‡: 100% (3/3)
åœºæ™¯4 (éƒ¨åˆ†æœªä½œç­”): âŒ å¤±è´¥ | å‡†ç¡®ç‡: 80% (4/5)
  - é”™è¯¯1: æœªä½œç­”é¢˜è¢«æ ‡è®°ä¸º is_unanswered=false
åœºæ™¯5 (æ··åˆé¢˜å‹): âœ… é€šè¿‡ | å‡†ç¡®ç‡: 100% (3/3)

æ€»ä½“å‡†ç¡®ç‡: 85% (13/15)
```

**ç›®æ ‡**: å»ºç«‹æ”¹è¿›å‰çš„åŸºçº¿æ•°æ®

---

### é˜¶æ®µ 3: Prompt ä¼˜åŒ–ï¼ˆ20 åˆ†é’Ÿï¼‰

#### Task 5: åˆ†ææµ‹è¯•å¤±è´¥åŸå›  â¸ï¸

**ä¼˜å…ˆçº§**: ğŸŸ  é«˜

**åˆ†æç»´åº¦**:

1. **AI æœªè¯†åˆ«å‡ºé¢˜ç›®**: Prompt ç¼ºå°‘é¢˜ç›®è¯†åˆ«æŒ‡å¯¼
2. **JSON æ ¼å¼é”™è¯¯**: Schema å®šä¹‰ä¸å¤Ÿæ¸…æ™°æˆ–ç¤ºä¾‹ä¸è¶³
3. **åˆ¤æ–­é€»è¾‘é”™è¯¯**:
   - æ­£ç¡®ç­”æ¡ˆåˆ¤é”™ï¼ˆfalse positiveï¼‰
   - é”™è¯¯ç­”æ¡ˆåˆ¤å¯¹ï¼ˆfalse negativeï¼‰
4. **çŸ¥è¯†ç‚¹æå–ä¸å‡†ç¡®**: æå–çš„çŸ¥è¯†ç‚¹å¤ªæ³›æˆ–ä¸ç›¸å…³
5. **é”™è¯¯ç±»å‹åˆ†ç±»ä¸åˆç†**: åˆ†ç±»æ ‡å‡†ä¸æ˜ç¡®

**è¾“å‡º**: é—®é¢˜æ¸…å•å’Œæ”¹è¿›æ–¹å‘ï¼ˆMarkdown æ–‡æ¡£ï¼‰

---

#### Task 6: ä¼˜åŒ– Promptï¼ˆè¿­ä»£ 1ï¼‰ â¸ï¸

**ä¼˜å…ˆçº§**: ğŸŸ  é«˜  
**æ–‡ä»¶**: `src/services/learning_service.py`

**ä¼˜åŒ–ç­–ç•¥**:

1. **å¢åŠ æ›´æ˜ç¡®çš„æŒ‡ä»¤**:

   ```
   è¯·åŠ¡å¿…ä»”ç»†è¯†åˆ«æ¯é“é¢˜ç›®çš„é¢˜å·ï¼Œä» 1 å¼€å§‹é€’å¢ã€‚
   å¯¹äºæœªä½œç­”çš„é¢˜ç›®ï¼Œå¿…é¡»è®¾ç½® is_unanswered=trueï¼Œstudent_answer=nullã€‚
   ```

2. **æ·»åŠ ç¤ºä¾‹ï¼ˆFew-shot Learningï¼‰**:

   ```
   ç¤ºä¾‹1ï¼š
   é¢˜ç›®: 125 + 376 = 501
   å­¦ç”Ÿç­”æ¡ˆ: 501
   æ­£ç¡®ç­”æ¡ˆ: 501
   ç»“æœ: { "is_unanswered": false, "error_type": null, "score": 100 }

   ç¤ºä¾‹2ï¼š
   é¢˜ç›®: 24 + 18 = ?
   å­¦ç”Ÿç­”æ¡ˆ: (ç©ºç™½)
   æ­£ç¡®ç­”æ¡ˆ: 42
   ç»“æœ: { "is_unanswered": true, "student_answer": null, "error_type": null, "score": 0 }
   ```

3. **å¼ºè°ƒ JSON æ ¼å¼è¦æ±‚**:

   ````
   âš ï¸ é‡è¦: å¿…é¡»è¿”å›ä¸¥æ ¼çš„ JSON æ ¼å¼ï¼Œä¸è¦åŒ…å« markdown ä»£ç å—æ ‡è®°ï¼ˆ```jsonï¼‰ã€‚
   ````

4. **ç»†åŒ–é”™è¯¯ç±»å‹åˆ†ç±»æ ‡å‡†**:

   ```
   é”™è¯¯ç±»å‹åŒ…æ‹¬ä½†ä¸é™äº:
   - è®¡ç®—é”™è¯¯: è¿ç®—ç»“æœé”™è¯¯
   - æ¦‚å¿µé”™è¯¯: å¯¹çŸ¥è¯†ç‚¹ç†è§£æœ‰è¯¯
   - ç†è§£é”™è¯¯: å®¡é¢˜ä¸æ¸…ï¼Œç†è§£é¢˜æ„æœ‰è¯¯
   - å•ä½é”™è¯¯: ç­”æ¡ˆæ­£ç¡®ä½†å•ä½é”™è¯¯æˆ–é—æ¼
   - æ­¥éª¤é”™è¯¯: è§£é¢˜æ­¥éª¤ä¸å®Œæ•´æˆ–é”™è¯¯
   ```

5. **ä¼˜åŒ–çŸ¥è¯†ç‚¹æå–æŒ‡å¯¼**:
   ```
   çŸ¥è¯†ç‚¹åº”è¯¥:
   - å…·ä½“æ˜ç¡®ï¼ˆå¦‚"ä¸¤ä½æ•°åŠ æ³•"è€Œé"åŠ æ³•"ï¼‰
   - æœ€å¤š 3 ä¸ª
   - ä¸é¢˜ç›®ç›´æ¥ç›¸å…³
   ```

**éªŒè¯æ–¹æ³•**: é‡æ–°è¿è¡Œ `pytest tests/integration/test_prompt_accuracy.py -v`ï¼Œå¯¹æ¯”å‡†ç¡®ç‡æå‡

---

#### Task 7: ä¼˜åŒ– Promptï¼ˆè¿­ä»£ 2ï¼‰ â¸ï¸

**ä¼˜å…ˆçº§**: ğŸŸ  é«˜  
**è§¦å‘æ¡ä»¶**: å¦‚æœå‡†ç¡®ç‡ä» < 90%

**æ·±åº¦ä¼˜åŒ–**:

1. **è°ƒæ•´æç¤ºè¯é¡ºåº**: å°†æœ€é‡è¦çš„æŒ‡ä»¤æ”¾åœ¨å¼€å¤´
2. **æ·»åŠ çº¦æŸæ¡ä»¶**:
   ```
   çº¦æŸ:
   - question_number å¿…é¡»æ˜¯æ­£æ•´æ•°ï¼Œä» 1 å¼€å§‹
   - score å¿…é¡»åœ¨ 0-100 ä¹‹é—´
   - knowledge_points æ•°ç»„é•¿åº¦å¿…é¡» â‰¤ 3
   ```
3. **ä¼˜åŒ–å­¦ç§‘ç‰¹å®šæŒ‡ä»¤**: æ ¹æ®ä¸åŒå­¦ç§‘è°ƒæ•´ Prompt
4. **æµ‹è¯•ä¸åŒçš„è¡¨è¿°æ–¹å¼**: æ”¹å˜æŒ‡ä»¤çš„è¡¨è¿°ï¼Œæ‰¾åˆ°æœ€æœ‰æ•ˆçš„æ–¹å¼

**éªŒè¯æ–¹æ³•**: å†æ¬¡è¿è¡Œæµ‹è¯•ï¼Œè®°å½•å‡†ç¡®ç‡å˜åŒ–

---

### é˜¶æ®µ 4: è¾¹ç•Œæµ‹è¯•ï¼ˆ10 åˆ†é’Ÿï¼‰

#### Task 8: è¾¹ç•Œæƒ…å†µæµ‹è¯• â¸ï¸

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­  
**æ–‡ä»¶**: `tests/integration/test_prompt_edge_cases.py` (æ–°å»º)

**æµ‹è¯•æç«¯åœºæ™¯**:

1. **ç©ºç™½ä½œä¸š**: æ‰€æœ‰é¢˜ç›®æœªä½œç­”
2. **å›¾ç‰‡ä¸æ¸…æ™°**: æ¨¡æ‹Ÿä½è´¨é‡å›¾ç‰‡
3. **éæ ‡å‡†é¢˜ç›®æ ¼å¼**: é¢˜å·ä¸è¿ç»­ã€é¢˜ç›®æ··ä¹±
4. **è¶…é•¿é¢˜ç›®æ–‡æœ¬**: é¢˜ç›®æ–‡æœ¬ >500 å­—
5. **ç‰¹æ®Šç¬¦å·å’Œå…¬å¼**: åŒ…å«æ•°å­¦å…¬å¼ã€ç‰¹æ®Šç¬¦å·

**æµ‹è¯•ä»£ç ç¤ºä¾‹**:

```python
async def test_blank_homework(self, learning_service):
    """æµ‹è¯•ç©ºç™½ä½œä¸š"""
    result = await learning_service._call_ai_for_homework_correction(
        image_urls=["mock://blank_homework.jpg"],
        subject="æ•°å­¦",
        user_hint=""
    )

    # éªŒè¯ç³»ç»Ÿèƒ½å¤„ç†å…¨ç©ºç™½æƒ…å†µ
    assert result["unanswered_count"] == result["total_questions"]
    for correction in result["corrections"]:
        assert correction["is_unanswered"] is True
        assert correction["student_answer"] is None
```

**éªŒè¯**: ç³»ç»Ÿèƒ½å¦ä¼˜é›…å¤„ç†ï¼Œä¸å´©æºƒï¼Œè¿”å›åˆç†ç»“æœ

---

#### Task 9: å¤šå­¦ç§‘éªŒè¯ â¸ï¸

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**æµ‹è¯•ä¸åŒå­¦ç§‘**:

1. **æ•°å­¦**: å…¬å¼ã€è®¡ç®—ï¼ˆå·²æœ‰æµ‹è¯•æ•°æ®ï¼‰
2. **è¯­æ–‡**: é˜…è¯»ç†è§£ã€ä½œæ–‡ï¼ˆåˆ›å»ºæ–°æµ‹è¯•æ•°æ®ï¼‰
3. **è‹±è¯­**: è¯­æ³•ã€ç¿»è¯‘ï¼ˆåˆ›å»ºæ–°æµ‹è¯•æ•°æ®ï¼‰
4. **ç‰©ç†/åŒ–å­¦**: å®éªŒé¢˜ï¼ˆå¯é€‰ï¼‰

**ç­–ç•¥**:

- å¦‚æœæŸå­¦ç§‘å‡†ç¡®ç‡ < 80%ï¼Œè€ƒè™‘æ·»åŠ å­¦ç§‘ç‰¹å®š Prompt å˜é‡
- ä¾‹å¦‚: `SUBJECT_SPECIFIC_PROMPTS = {"æ•°å­¦": "...", "è¯­æ–‡": "..."}`

**éªŒè¯**: æ¯ä¸ªå­¦ç§‘çš„å‡†ç¡®ç‡éƒ½ â‰¥80%

---

### é˜¶æ®µ 5: æ€§èƒ½éªŒè¯ï¼ˆ5 åˆ†é’Ÿï¼‰

#### Task 10: æ€§èƒ½æµ‹è¯• â¸ï¸

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­  
**æ–‡ä»¶**: `tests/performance/test_prompt_performance.py` (æ–°å»º)

**æµ‹è¯•æŒ‡æ ‡**:

```python
import time

async def test_correction_performance(self, learning_service):
    """æµ‹è¯•æ‰¹æ”¹æ€§èƒ½"""
    test_cases = [
        load_test_case("single_question_math.json"),
        load_test_case("all_wrong_3questions.json"),
        # ... åŠ è½½ 5 ä¸ªæµ‹è¯•ç”¨ä¾‹
    ]

    times = []
    for case in test_cases:
        start = time.time()
        result = await learning_service._call_ai_for_homework_correction(
            image_urls=case["image_urls"],
            subject=case["subject"],
            user_hint=""
        )
        elapsed = time.time() - start
        times.append(elapsed)

    avg_time = sum(times) / len(times)
    assert avg_time <= 30, f"å¹³å‡è€—æ—¶ {avg_time:.2f}s è¶…è¿‡ç›®æ ‡ 30s"
```

**ç›‘æ§æŒ‡æ ‡**:

- [ ] å•æ¬¡æ‰¹æ”¹è€—æ—¶ï¼ˆ5 é¢˜ä»¥å†… â‰¤30sï¼‰
- [ ] Token ä½¿ç”¨é‡ï¼ˆè®°å½• input_tokens, output_tokensï¼‰
- [ ] é‡è¯•æ¬¡æ•°ç»Ÿè®¡
- [ ] è¶…æ—¶ç‡ï¼ˆåº” <5%ï¼‰

**å‘½ä»¤**: `uv run pytest tests/performance/test_prompt_performance.py -v`

---

### é˜¶æ®µ 6: æ–‡æ¡£ä¸æ”¶å°¾ï¼ˆ10 åˆ†é’Ÿï¼‰

#### Task 11: æ–‡æ¡£æ›´æ–° â¸ï¸

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½

**æ›´æ–°æ–‡ä»¶**:

1. **DEVELOPMENT_CONTEXT.md**:

   ```markdown
   ### 3.3 Prompt ä¼˜åŒ–ä¸éªŒè¯

   - [x] **3.3.1** Prompt å‡†ç¡®æ€§æµ‹è¯• âœ…

     - æ–‡ä»¶: tests/integration/test_prompt_accuracy.py
     - åŸºçº¿å‡†ç¡®ç‡: 85%
     - ä¼˜åŒ–åå‡†ç¡®ç‡: 93% âœ…

   - [x] **3.3.2** è¾¹ç•Œæƒ…å†µæµ‹è¯• âœ…
     - æ–‡ä»¶: tests/integration/test_prompt_edge_cases.py
     - é€šè¿‡ç‡: 100% (5/5)
   ```

2. **åˆ›å»º PHASE_3_3_PROMPT_OPTIMIZATION.md**:

   ```markdown
   # Phase 3.3: Prompt ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

   ## ä¼˜åŒ–å‰åå¯¹æ¯”

   ### ä¼˜åŒ–å‰ (v1)

   [å±•ç¤ºåŸå§‹ Prompt]
   å‡†ç¡®ç‡: 85%

   ### ä¼˜åŒ–å (v2)

   [å±•ç¤ºä¼˜åŒ–å Prompt]
   å‡†ç¡®ç‡: 93%

   ## å‡†ç¡®ç‡æ”¹è¿›æ•°æ®

   | åœºæ™¯       | ä¼˜åŒ–å‰  | ä¼˜åŒ–å  | æå‡    |
   | ---------- | ------- | ------- | ------- |
   | å•é¢˜ä½œä¸š   | 100%    | 100%    | -       |
   | å…¨é”™ä½œä¸š   | 66%     | 100%    | +34%    |
   | å…¨å¯¹ä½œä¸š   | 100%    | 100%    | -       |
   | éƒ¨åˆ†æœªä½œç­” | 80%     | 100%    | +20%    |
   | æ··åˆé¢˜å‹   | 100%    | 100%    | -       |
   | **æ€»ä½“**   | **85%** | **93%** | **+8%** |

   ## æµ‹è¯•ç”¨ä¾‹å’Œç»“æœ

   [è¯¦ç»†æµ‹è¯•æ•°æ®]

   ## å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

   1. å›¾ç‰‡è´¨é‡ä½æ—¶å‡†ç¡®ç‡ä¸‹é™
   2. éæ ‡å‡†é¢˜ç›®æ ¼å¼è¯†åˆ«ç‡ ~80%
   3. è¶…é•¿é¢˜ç›®æ–‡æœ¬å¯èƒ½è¢«æˆªæ–­
   ```

---

#### Task 12: ä»£ç å®¡æŸ¥å’Œæ¸…ç† â¸ï¸

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½

**æ£€æŸ¥æ¸…å•**:

- [ ] **ç±»å‹æ³¨è§£å®Œæ•´**: `mypy src/services/learning_service.py --strict`
- [ ] **å¼‚å¸¸å¤„ç†å…·ä½“**: ç¦æ­¢ `except:` æˆ– `except Exception:`
- [ ] **æ—¥å¿—è®°å½•å®Œå–„**: åœ¨ Prompt è°ƒç”¨ã€AI å“åº”ã€JSON è§£æå¤„æ·»åŠ æ—¥å¿—
- [ ] **æ³¨é‡Šæ¸…æ™°**: Prompt ä¼˜åŒ–åŸå› æ³¨é‡Š
- [ ] **æµ‹è¯•è¦†ç›–ç‡**: `pytest --cov=src.services.learning_service --cov-report=html`

**å‘½ä»¤**:

```bash
# ç±»å‹æ£€æŸ¥
mypy src/services/learning_service.py --strict

# ä»£ç æ ¼å¼åŒ–
black src/services/learning_service.py
flake8 src/services/learning_service.py

# æµ‹è¯•è¦†ç›–ç‡
pytest tests/integration/test_prompt_accuracy.py \
       tests/integration/test_prompt_edge_cases.py \
       --cov=src.services.learning_service \
       --cov-report=html
```

**ç›®æ ‡**: è¦†ç›–ç‡ â‰¥80%

---

## ğŸ“Š è¿›åº¦è¿½è¸ª

### ä»»åŠ¡æ¦‚è§ˆ

- **é˜¶æ®µ 1**: ç†è§£ä¸å‡†å¤‡ (2 é¡¹ä»»åŠ¡ï¼Œé¢„è®¡ 15 åˆ†é’Ÿ)
- **é˜¶æ®µ 2**: åŸºçº¿æµ‹è¯• (2 é¡¹ä»»åŠ¡ï¼Œé¢„è®¡ 10 åˆ†é’Ÿ)
- **é˜¶æ®µ 3**: Prompt ä¼˜åŒ– (3 é¡¹ä»»åŠ¡ï¼Œé¢„è®¡ 20 åˆ†é’Ÿ)
- **é˜¶æ®µ 4**: è¾¹ç•Œæµ‹è¯• (2 é¡¹ä»»åŠ¡ï¼Œé¢„è®¡ 10 åˆ†é’Ÿ)
- **é˜¶æ®µ 5**: æ€§èƒ½éªŒè¯ (1 é¡¹ä»»åŠ¡ï¼Œé¢„è®¡ 5 åˆ†é’Ÿ)
- **é˜¶æ®µ 6**: æ–‡æ¡£ä¸æ”¶å°¾ (2 é¡¹ä»»åŠ¡ï¼Œé¢„è®¡ 10 åˆ†é’Ÿ)

### å®Œæˆæ ‡å‡†

- âœ… å‡†ç¡®ç‡ â‰¥90%
- âœ… 5 ç§å…¸å‹åœºæ™¯å…¨éƒ¨é€šè¿‡
- âœ… 5 ç§è¾¹ç•Œæƒ…å†µèƒ½ä¼˜é›…å¤„ç†
- âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡ï¼ˆâ‰¤30sï¼‰
- âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥80%
- âœ… æ–‡æ¡£å®Œæ•´

---

## âš ï¸ é£é™©ä¸æ³¨æ„äº‹é¡¹

### 1. AI æœåŠ¡ä¾èµ–

- **é£é™©**: ç™¾ç‚¼ API ä¸ç¨³å®šå¯èƒ½å¯¼è‡´æµ‹è¯•å¤±è´¥
- **æ–¹æ¡ˆ**: ä½¿ç”¨ Mock æœåŠ¡è¿›è¡Œå¤§éƒ¨åˆ†æµ‹è¯•ï¼Œä»…å°‘é‡çœŸå® API è°ƒç”¨éªŒè¯

### 2. æµ‹è¯•æ•°æ®è´¨é‡

- **é£é™©**: æµ‹è¯•æ•°æ®ä¸å¤ŸçœŸå®ï¼Œæ— æ³•åæ˜ å®é™…åœºæ™¯
- **æ–¹æ¡ˆ**: å¦‚æœæœ‰æ¡ä»¶ï¼Œæ”¶é›†çœŸå®å­¦ç”Ÿä½œä¸šå›¾ç‰‡

### 3. å‡†ç¡®ç‡ç›®æ ‡

- **é£é™©**: æŸäº›å¤æ‚åœºæ™¯å¯èƒ½æ— æ³•è¾¾åˆ° 90% å‡†ç¡®ç‡
- **æ–¹æ¡ˆ**: è®°å½•å·²çŸ¥é™åˆ¶ï¼Œè®¾å®šåˆç†çš„æœŸæœ›å€¼

### 4. æ—¶é—´æ§åˆ¶

- **é£é™©**: Prompt ä¼˜åŒ–æ˜¯è¿­ä»£è¿‡ç¨‹ï¼Œå¯èƒ½è¶…å‡ºé¢„è®¡æ—¶é—´
- **æ–¹æ¡ˆ**: è®¾ç½®æœ€å¤š 2 æ¬¡è¿­ä»£ï¼Œå¦‚æœªè¾¾æ ‡åˆ™è®°å½•å¹¶ç»§ç»­åç»­ä»»åŠ¡

---

## ğŸš€ å¼€å§‹å·¥ä½œ

**ç¬¬ä¸€æ­¥**: è¿è¡Œä»¥ä¸‹å‘½ä»¤å¼€å§‹ Task 1

```bash
# é˜…è¯»å½“å‰ Prompt å®ç°
cd /Users/liguoma/my-devs/python/wuhao-tutor
code src/services/learning_service.py:75
```

**ç¬¬äºŒæ­¥**: é€ä¸ªå®Œæˆ Todo List ä¸­çš„ä»»åŠ¡

**ç¬¬ä¸‰æ­¥**: æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œä½¿ç”¨ `manage_todo_list` æ›´æ–°çŠ¶æ€

---

## ğŸ“ è·å–å¸®åŠ©

- ğŸ“˜ **ä¸»æ–‡æ¡£**: [DEVELOPMENT_CONTEXT.md](./DEVELOPMENT_CONTEXT.md)
- âš¡ **å¿«é€ŸæŒ‡å—**: [QUICKSTART_MISTAKE_OPTIMIZATION.md](./QUICKSTART_MISTAKE_OPTIMIZATION.md)
- ğŸ”§ **å¼€å‘è§„èŒƒ**: [.github/copilot-instructions.md](./.github/copilot-instructions.md)

---

**å‡†å¤‡å¼€å§‹ï¼Ÿ** è®©æˆ‘ä»¬ä» Task 1 å¼€å§‹å§ï¼ ğŸ¯
