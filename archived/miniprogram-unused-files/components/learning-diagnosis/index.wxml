<!--学情诊断报告组件模板-->
<view class="learning-diagnosis">
  <!-- 报告头部 -->
  <view class="diagnosis-header">
    <view class="header-title">
      <text class="title-main">学情诊断报告</text>
      <text class="title-sub">{{reportData.student_name}} · {{reportData.time_range}}</text>
    </view>
    <view class="header-score">
      <view class="score-circle">
        <text class="score-number">{{reportData.overall_score}}</text>
        <text class="score-unit">分</text>
      </view>
      <text class="score-label">综合评分</text>
    </view>
  </view>

  <!-- 学习风格分析 -->
  <view class="diagnosis-section" wx:if="{{reportData.learning_style}}">
    <view class="section-title">
      <van-icon name="user-circle-o" />
      <text>学习风格分析</text>
    </view>
    <view class="learning-style">
      <view class="style-item" wx:for="{{reportData.learning_style.analysis}}" wx:key="type">
        <view class="style-header">
          <text class="style-name">{{item.name}}</text>
          <text class="style-percentage">{{item.percentage}}%</text>
        </view>
        <van-progress percentage="{{item.percentage}}" stroke-width="8" color="{{getStyleColor(item.type)}}" />
      </view>
      <view class="style-description">
        <text>{{reportData.learning_style.description}}</text>
      </view>
    </view>
  </view>

  <!-- 知识点掌握情况 -->
  <view class="diagnosis-section">
    <view class="section-title">
      <van-icon name="bookmark-o" />
      <text>知识点掌握情况</text>
    </view>
    <view class="knowledge-mastery">
      <view class="mastery-item" wx:for="{{reportData.knowledge_mastery}}" wx:key="subject">
        <view class="mastery-header">
          <text class="subject-name">{{item.subject}}</text>
          <text class="mastery-rate">掌握率: {{item.mastery_rate}}%</text>
        </view>
        <view class="knowledge-points">
          <view class="point-item" wx:for="{{item.points}}" wx:for-item="point" wx:key="name">
            <view class="point-info">
              <text class="point-name">{{point.name}}</text>
              <van-tag type="{{point.level === 'high' ? 'success' : point.level === 'medium' ? 'warning' : 'danger'}}" size="mini">
                {{point.level === 'high' ? '熟练' : point.level === 'medium' ? '一般' : '薄弱'}}
              </van-tag>
            </view>
            <van-progress percentage="{{point.score}}" stroke-width="6" color="{{getMasteryColor(point.level)}}" />
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 学习行为分析 -->
  <view class="diagnosis-section" wx:if="{{reportData.behavior_analysis}}">
    <view class="section-title">
      <van-icon name="chart-trending-o" />
      <text>学习行为分析</text>
    </view>
    <view class="behavior-analysis">
      <view class="behavior-metrics">
        <view class="metric-item" wx:for="{{reportData.behavior_analysis.metrics}}" wx:key="name">
          <view class="metric-icon">
            <van-icon name="{{item.icon}}" />
          </view>
          <view class="metric-content">
            <text class="metric-name">{{item.name}}</text>
            <text class="metric-value">{{item.value}}</text>
            <text class="metric-trend {{item.trend > 0 ? 'up' : item.trend < 0 ? 'down' : 'stable'}}">
              {{item.trend > 0 ? '↗' : item.trend < 0 ? '↘' : '→'}} {{item.trend_text}}
            </text>
          </view>
        </view>
      </view>
      <view class="behavior-patterns">
        <text class="patterns-title">学习模式识别</text>
        <view class="pattern-tags">
          <van-tag wx:for="{{reportData.behavior_analysis.patterns}}" wx:key="*this" type="primary" plain>
            {{item}}
          </van-tag>
        </view>
      </view>
    </view>
  </view>

  <!-- 改进建议 -->
  <view class="diagnosis-section">
    <view class="section-title">
      <van-icon name="guide-o" />
      <text>个性化改进建议</text>
    </view>
    <view class="improvement-suggestions">
      <view class="suggestion-item" wx:for="{{reportData.improvement_suggestions}}" wx:key="category">
        <view class="suggestion-header">
          <van-icon name="{{item.icon}}" />
          <text class="suggestion-category">{{item.category}}</text>
        </view>
        <view class="suggestion-content">
          <view class="suggestion-text" wx:for="{{item.suggestions}}" wx:for-item="suggestion" wx:key="*this">
            • {{suggestion}}
          </view>
        </view>
        <view class="suggestion-priority" wx:if="{{item.priority}}">
          <van-tag type="{{item.priority === 'high' ? 'danger' : item.priority === 'medium' ? 'warning' : 'primary'}}" size="mini">
            {{item.priority === 'high' ? '高优先级' : item.priority === 'medium' ? '中优先级' : '低优先级'}}
          </van-tag>
        </view>
      </view>
    </view>
  </view>

  <!-- 进步跟踪 -->
  <view class="diagnosis-section" wx:if="{{reportData.progress_tracking}}">
    <view class="section-title">
      <van-icon name="success" />
      <text>进步跟踪分析</text>
    </view>
    <view class="progress-tracking">
      <view class="progress-summary">
        <view class="summary-item">
          <text class="summary-label">总体进步</text>
          <text class="summary-value {{reportData.progress_tracking.overall_trend > 0 ? 'positive' : 'negative'}}">
            {{reportData.progress_tracking.overall_trend > 0 ? '+' : ''}}{{reportData.progress_tracking.overall_trend}}%
          </text>
        </view>
        <view class="summary-item">
          <text class="summary-label">连续学习天数</text>
          <text class="summary-value">{{reportData.progress_tracking.consecutive_days}}天</text>
        </view>
      </view>
      
      <view class="progress-highlights">
        <text class="highlights-title">近期亮点</text>
        <view class="highlight-item" wx:for="{{reportData.progress_tracking.highlights}}" wx:key="*this">
          <van-icon name="star" color="#ffd21e" />
          <text>{{item}}</text>
        </view>
      </view>
      
      <view class="progress-goals" wx:if="{{reportData.progress_tracking.next_goals}}">
        <text class="goals-title">下阶段目标</text>
        <view class="goal-item" wx:for="{{reportData.progress_tracking.next_goals}}" wx:key="*this">
          <van-checkbox value="{{false}}" disabled />
          <text>{{item}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="diagnosis-actions" wx:if="{{showActions}}">
    <van-button type="primary" size="large" bind:click="onExportReport" loading="{{exporting}}">
      导出报告
    </van-button>
    <van-button type="default" size="large" bind:click="onShareReport" style="margin-left: 16rpx;">
      分享报告
    </van-button>
  </view>

  <!-- 生成时间 -->
  <view class="diagnosis-footer">
    <text class="footer-text">报告生成时间：{{reportData.generated_time}}</text>
    <text class="footer-text">数据来源：近{{reportData.data_range}}天学习记录</text>
  </view>
</view>

<!-- 加载状态 -->
<van-loading wx:if="{{loading}}" type="spinner" color="#1989fa" size="24px">
  正在生成诊断报告...
</van-loading>

<!-- 空状态 -->
<van-empty wx:if="{{!loading && !reportData}}" image="search" description="暂无学情数据">
  <van-button round type="primary" bind:click="onRefreshData">刷新数据</van-button>
</van-empty>