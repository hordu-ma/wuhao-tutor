# 小程序滚动修复 - 测试检查清单

**修复版本**: 2025-11-02  
**测试环境**: 微信开发者工具 + 真机体验版

---

## 🧪 快速测试步骤（5 分钟）

### ✅ 测试 1: 基础滚动功能

**步骤**:

1. 打开作业问答页面
2. 发送一个简单问题："1+1=？"
3. 观察 AI 回复时的滚动行为

**预期结果**:

- [x] 页面自动滚动到底部
- [x] AI 回复流式显示
- [x] 控制台无报错

---

### ✅ 测试 2: 核心修复验证（用户主动浏览）

**步骤**:

1. 发送问题："请详细解释量子力学的基本原理"（触发长回复）
2. **在 AI 生成过程中**，立即上滑到页面顶部
3. 保持在顶部 5 秒钟
4. 观察是否被强制拉回底部

**预期结果**:

- [x] 用户可以停留在顶部，**不会被强制滚动**
- [x] 右下角出现"回到底部"按钮（下箭头图标）
- [x] 控制台打印 `⏸️ 用户正在浏览历史，跳过自动滚动`

**⚠️ 关键**: 如果被强制拉回底部 = 修复失败

---

### ✅ 测试 3: 回到底部按钮

**步骤**:

1. 承接测试 2，仍在页面顶部
2. 点击右下角的"回到底部"按钮
3. 观察滚动行为

**预期结果**:

- [x] 立即滚动到最新消息
- [x] 按钮消失
- [x] 后续 AI 生成继续自动滚动

---

### ✅ 测试 4: 限流问题验证

**步骤**:

1. 发送问题触发 AI 回复
2. 在 AI 生成过程中，**快速上下滑动 15 次**
3. 观察是否有错误提示

**预期结果**:

- [x] **不会**出现"操作频繁，稍后再试"
- [x] 滚动流畅，无卡顿
- [x] 控制台无限流相关错误

**⚠️ 关键**: 如果出现限流提示 = 修复失败

---

### ✅ 测试 5: 发送新消息

**步骤**:

1. 上滑到历史消息区域
2. 在输入框输入新问题并发送
3. 观察滚动行为

**预期结果**:

- [x] 立即滚动到新消息位置
- [x] `isUserScrolling` 状态被重置
- [x] AI 回复时正常自动滚动

---

### ✅ 测试 6: 图片消息滚动

**步骤**:

1. 选择并上传一张图片
2. 发送图片问题
3. 观察 AI 分析图片时的滚动

**预期结果**:

- [x] 图片消息发送后滚动到底部
- [x] AI 回复时智能滚动正常
- [x] 用户仍可主动浏览历史

---

## 🔍 控制台日志检查

**应该看到的日志**:

```
📜 滚动状态: { scrollTop: xxx, distanceToBottom: xxx, isUserScrolling: true/false }
⏸️ 用户正在浏览历史，跳过自动滚动  // 用户上滑时
🔽 用户点击回到底部按钮  // 点击按钮时
```

**不应该看到的日志**:

```
❌ TypeError: Cannot read property 'xxx' of undefined
❌ RateLimitError: 操作频繁
❌ 频繁的 setData 警告
```

---

## 📊 性能验证（可选）

**开发者工具 Performance 面板**:

1. 开启录制
2. 发送问题并等待 AI 完整回复
3. 停止录制，查看 `setData` 调用次数

**预期**:

- 修复前: ~100+ 次/秒（流式更新期间）
- 修复后: ≤ 2 次/秒（节流生效）

---

## ❌ 常见问题排查

### 问题 1: 仍然被强制滚动到底部

**可能原因**:

- `onScroll` 事件未正确绑定
- `throttle` 函数初始化失败
- `autoScrollEnabled` 状态未正确更新

**检查方法**:

```javascript
// 在 onScroll 方法中添加日志
console.log('onScroll 触发', this.data.isUserScrolling)
```

### 问题 2: "回到底部"按钮不显示

**可能原因**:

- `showScrollToBottom` 阈值设置问题（当前 300px）
- WXML 条件渲染失效

**检查方法**:

```javascript
// 在 onScroll 方法中查看
console.log('距离底部:', distanceToBottom)
console.log('显示按钮:', this.data.showScrollToBottom)
```

### 问题 3: 滚动卡顿

**可能原因**:

- 节流时间过短（当前 500ms）
- 消息列表过长（建议启用虚拟滚动）

**优化建议**:

```javascript
// 调整节流时间
this.scrollToBottomThrottled = this.throttle(this.scrollToBottomSmart, 800)
```

---

## ✅ 测试通过标准

**全部通过条件**:

- [x] 测试 1-6 全部符合预期
- [x] 控制台无报错
- [x] 性能日志显示 setData 显著减少
- [x] 用户体验流畅，无明显滞后

**如有任意测试失败，请查看 `SCROLL_FIX_SUMMARY.md` 中的回滚方案。**

---

**测试完成时间**: ****\_\_\_****  
**测试人员**: ****\_\_\_****  
**测试结果**: [ ] 通过 / [ ] 失败  
**备注**: ****\_\_\_****
