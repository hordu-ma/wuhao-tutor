<!--pages/homework/list/index.wxml-->
<view class="homework-list-container">
  <!-- 头部筛选区域 -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view class="filter-tab {{activeTab === 'all' ? 'active' : ''}}"
            bindtap="onTabChange" data-tab="all">
        全部
      </view>
      <view class="filter-tab {{activeTab === 'pending' ? 'active' : ''}}"
            bindtap="onTabChange" data-tab="pending">
        待完成
      </view>
      <view class="filter-tab {{activeTab === 'completed' ? 'active' : ''}}"
            bindtap="onTabChange" data-tab="completed">
        已完成
      </view>
      <view class="filter-tab {{activeTab === 'overdue' ? 'active' : ''}}"
            bindtap="onTabChange" data-tab="overdue">
        已逾期
      </view>
    </view>
  </view>

  <!-- 作业列表区域 -->
  <scroll-view class="homework-scroll"
               scroll-y="{{true}}"
               refresher-enabled="{{true}}"
               refresher-triggered="{{refreshing}}"
               bindrefresherrefresh="onRefresh"
               bindscrolltolower="onLoadMore">

    <!-- 加载状态 -->
    <loading wx:if="{{loading && !homeworkList.length}}" />

    <!-- 空状态 -->
    <empty-state wx:if="{{!loading && !homeworkList.length}}"
                 type="homework"
                 title="暂无作业"
                 description="{{getEmptyDescription(activeTab)}}" />

    <!-- 作业列表 -->
    <view class="homework-list" wx:if="{{homeworkList.length > 0}}">
      <homework-card
        wx:for="{{homeworkList}}"
        wx:key="id"
        homework="{{item}}"
        bind:tap="onHomeworkTap"
        bind:submit="onHomeworkSubmit" />
    </view>

    <!-- 加载更多状态 -->
    <view class="load-more" wx:if="{{hasMore && homeworkList.length > 0}}">
      <view class="load-more-loading" wx:if="{{loadingMore}}">
        <van-loading size="20rpx" />
        <text class="load-more-text">加载中...</text>
      </view>
      <view class="load-more-text" wx:else>上拉加载更多</view>
    </view>

    <!-- 没有更多数据 -->
    <view class="no-more" wx:if="{{!hasMore && homeworkList.length > 0}}">
      <text class="no-more-text">没有更多作业了</text>
    </view>
  </scroll-view>

  <!-- 浮动操作按钮 -->
  <view class="fab-container" wx:if="{{userRole === 'teacher'}}">
    <view class="fab" bindtap="onCreateHomework">
      <van-icon name="plus" size="40rpx" color="#fff" />
    </view>
  </view>

  <!-- 作业筛选弹窗 -->
  <van-popup show="{{showFilterPopup}}"
             position="bottom"
             round="{{true}}"
             bind:close="onCloseFilter">
    <view class="filter-popup">
      <view class="filter-header">
        <text class="filter-title">筛选条件</text>
        <van-icon name="cross" bindtap="onCloseFilter" />
      </view>

      <view class="filter-content">
        <!-- 科目筛选 -->
        <view class="filter-group">
          <text class="filter-label">科目</text>
          <view class="filter-options">
            <view class="filter-option {{selectedSubject === item ? 'selected' : ''}}"
                  wx:for="{{subjectOptions}}"
                  wx:key="*this"
                  bindtap="onSubjectSelect"
                  data-subject="{{item}}">
              {{item}}
            </view>
          </view>
        </view>

        <!-- 难度筛选 -->
        <view class="filter-group">
          <text class="filter-label">难度</text>
          <view class="filter-options">
            <view class="filter-option {{selectedDifficulty === item.value ? 'selected' : ''}}"
                  wx:for="{{difficultyOptions}}"
                  wx:key="value"
                  bindtap="onDifficultySelect"
                  data-difficulty="{{item.value}}">
              {{item.label}}
            </view>
          </view>
        </view>
      </view>

      <view class="filter-actions">
        <van-button plain bindtap="onResetFilter">重置</van-button>
        <van-button type="primary" bindtap="onConfirmFilter">确定</van-button>
      </view>
    </view>
  </van-popup>
</view>
