<!--
  Task 1.5 æµ‹è¯•é¡µé¢
  å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­çš„æµ‹è¯•ç•Œé¢
-->

<view class="test-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="test-header">
    <text class="test-title">ğŸ§ª Task 1.5 å…¨é¢æµ‹è¯•</text>
    <text class="test-subtitle">Phase 3 é›†æˆæµ‹è¯•å’Œè°ƒè¯•</text>
  </view>

  <!-- æµ‹è¯•çŠ¶æ€ -->
  <view class="test-status" wx:if="{{isRunning}}">
    <view class="status-indicator">
      <text class="status-icon">â³</text>
      <text class="status-text">æ­£åœ¨æ‰§è¡Œ: {{currentTest}}</text>
    </view>
    <view class="progress-bar">
      <view class="progress-fill"></view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œæŒ‰é’® -->
  <view class="quick-actions">
    <button
      class="action-btn primary"
      bindtap="runQuickTests"
      disabled="{{isRunning}}"
    >
      âš¡ å¿«é€Ÿæµ‹è¯•
    </button>

    <button
      class="action-btn secondary"
      bindtap="runFullTests"
      disabled="{{isRunning}}"
    >
      ğŸ” å®Œæ•´æµ‹è¯•
    </button>

    <button
      class="action-btn info"
      bindtap="testSingleApi"
      disabled="{{isRunning}}"
    >
      ğŸŒ æµ‹è¯•API
    </button>
  </view>

  <!-- ç™»å½•è¯Šæ–­å·¥å…· -->
  <view class="quick-actions">
    <button
      class="action-btn warning"
      bindtap="runLoginDiagnostic"
      disabled="{{isRunning}}"
    >
      ğŸ” ç™»å½•è¯Šæ–­
    </button>

    <button
      class="action-btn success"
      bindtap="testLoginFlow"
      disabled="{{isRunning}}"
    >
      ğŸ§ª æµ‹è¯•ç™»å½•
    </button>

    <button
      class="action-btn danger"
      bindtap="fixLoginState"
      disabled="{{isRunning}}"
    >
      ğŸ”§ ä¿®å¤ç™»å½•
    </button>

    <button
      class="action-btn secondary"
      bindtap="cleanOldData"
      disabled="{{isRunning}}"
    >
      ğŸ§¹ æ¸…ç†æ—§æ•°æ®
    </button>
  </view>

  <!-- API è¯Šæ–­å·¥å…· -->
  <view class="quick-actions">
    <button
      class="action-btn info"
      bindtap="runApiDiagnostic"
      disabled="{{isRunning}}"
    >
      ğŸ” APIè¯Šæ–­
    </button>

    <button
      class="action-btn primary"
      bindtap="testSingleApi"
      disabled="{{isRunning}}"
    >
      ğŸŒ æµ‹è¯•API
    </button>
  </view>

  <!-- æµ‹è¯•é…ç½® -->
  <view class="test-config">
    <view class="config-title">æµ‹è¯•é…ç½®</view>
    <view class="config-options">
      <view class="config-item">
        <switch
          checked="{{testConfig.runApiTests}}"
          bindchange="toggleConfig"
          data-key="runApiTests"
        />
        <text class="config-label">APIé›†æˆæµ‹è¯•</text>
      </view>

      <view class="config-item">
        <switch
          checked="{{testConfig.runFrontendTests}}"
          bindchange="toggleConfig"
          data-key="runFrontendTests"
        />
        <text class="config-label">å‰ç«¯åŠŸèƒ½æµ‹è¯•</text>
      </view>

      <view class="config-item">
        <switch
          checked="{{testConfig.runPerformanceTests}}"
          bindchange="toggleConfig"
          data-key="runPerformanceTests"
        />
        <text class="config-label">æ€§èƒ½ç›‘æ§æµ‹è¯•</text>
      </view>

      <view class="config-item">
        <switch
          checked="{{testConfig.enableDetailedLogs}}"
          bindchange="toggleConfig"
          data-key="enableDetailedLogs"
        />
        <text class="config-label">è¯¦ç»†æ—¥å¿—</text>
      </view>
    </view>
  </view>

  <!-- æµ‹è¯•ç»“æœæ¦‚è§ˆ -->
  <view class="test-results" wx:if="{{testResults}}">
    <view class="results-header">
      <text class="results-title">ğŸ“Š æµ‹è¯•ç»“æœ</text>
      <view class="results-actions">
        <button class="mini-btn" bindtap="viewDetailedResults">è¯¦æƒ…</button>
        <button class="mini-btn" bindtap="exportResults">å¯¼å‡º</button>
        <button class="mini-btn" bindtap="shareResults">åˆ†äº«</button>
      </view>
    </view>

    <view class="results-summary">
      <view class="summary-item">
        <text class="summary-label">æ€»æµ‹è¯•æ•°</text>
        <text class="summary-value">{{testResults.summary.total_tests}}</text>
      </view>

      <view class="summary-item">
        <text class="summary-label">é€šè¿‡æ•°</text>
        <text class="summary-value success">{{testResults.summary.passed_tests}}</text>
      </view>

      <view class="summary-item">
        <text class="summary-label">å¤±è´¥æ•°</text>
        <text class="summary-value error">{{testResults.summary.failed_tests}}</text>
      </view>

      <view class="summary-item">
        <text class="summary-label">é€šè¿‡ç‡</text>
        <text class="summary-value">{{testResults.summary.pass_rate}}</text>
      </view>
    </view>

    <view class="overall-status">
      <text class="status-label">æ€»ä½“çŠ¶æ€:</text>
      <text class="status-value {{testResults.summary.overall_status}}">
        {{testResults.summary.overall_status === 'passed' ? 'âœ… å…¨éƒ¨é€šè¿‡' :
          testResults.summary.overall_status === 'failed' ? 'âŒ å­˜åœ¨å¤±è´¥' : 'âš ï¸ éƒ¨åˆ†é€šè¿‡'}}
      </text>
    </view>
  </view>

  <!-- æ€§èƒ½æ•°æ® -->
  <view class="performance-data" wx:if="{{performanceData}}">
    <view class="perf-header">
      <text class="perf-title">ğŸš€ æ€§èƒ½ç›‘æ§</text>
      <button class="mini-btn" bindtap="viewPerformanceSuggestions">å»ºè®®</button>
    </view>

    <view class="perf-summary">
      <view class="perf-item">
        <text class="perf-label">å¥åº·å¾—åˆ†</text>
        <text class="perf-value {{performanceData.health.health}}">
          {{performanceData.health.score}}/100
        </text>
      </view>

      <view class="perf-item">
        <text class="perf-label">å¥åº·çŠ¶å†µ</text>
        <text class="perf-value {{performanceData.health.health}}">
          {{performanceData.health.health === 'good' ? 'è‰¯å¥½' :
            performanceData.health.health === 'fair' ? 'ä¸€èˆ¬' : 'è¾ƒå·®'}}
        </text>
      </view>

      <view class="perf-item" wx:if="{{performanceData.suggestions.length > 0}}">
        <text class="perf-label">ä¼˜åŒ–å»ºè®®</text>
        <text class="perf-value warning">{{performanceData.suggestions.length}}æ¡</text>
      </view>
    </view>
  </view>

  <!-- æµ‹è¯•æ—¥å¿— -->
  <view class="test-logs">
    <view class="logs-header">
      <text class="logs-title">ğŸ“ æµ‹è¯•æ—¥å¿—</text>
      <button class="mini-btn" bindtap="clearLogs">æ¸…ç©º</button>
    </view>

    <scroll-view class="logs-container" scroll-y="true" scroll-top="{{999999}}">
      <view class="log-item {{item.type}}" wx:for="{{testLogs}}" wx:key="index">
        <text class="log-time">{{item.time}}</text>
        <text class="log-message">{{item.message}}</text>
      </view>

      <view class="log-item info" wx:if="{{testLogs.length === 0}}">
        <text class="log-message">æš‚æ— æ—¥å¿—è®°å½•</text>
      </view>
    </scroll-view>
  </view>

  <!-- åº•éƒ¨å·¥å…·æ  -->
  <view class="test-toolbar">
    <button class="tool-btn" bindtap="getPerformanceReport">
      ğŸ“ˆ æ€§èƒ½æŠ¥å‘Š
    </button>

    <button class="tool-btn" bindtap="exportResults">
      ğŸ’¾ å¯¼å‡ºç»“æœ
    </button>

    <navigator url="/pages/index/index" class="tool-btn">
      ğŸ  è¿”å›é¦–é¡µ
    </navigator>
  </view>
</view>
