<!--学习报告页面-->
<view class="report-container">
  <!-- 页面头部 -->
  <view class="page-header">
    <view class="header-content">
      <text class="page-title">学习报告</text>
      <text class="page-subtitle">全面了解您的学习状况</text>
    </view>
    <view class="header-actions">
      <button class="action-btn" bindtap="onShareReport">
        <van-icon name="share-o" size="20px" />
      </button>
    </view>
  </view>

  <!-- 时间范围选择 -->
  <view class="time-filter">
    <van-dropdown-menu>
      <van-dropdown-item value="{{timeRange}}" options="{{timeRangeOptions}}" bind:change="onTimeRangeChange" />
    </van-dropdown-menu>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <van-loading type="spinner" size="40px">加载中...</van-loading>
  </view>

  <!-- 空状态 -->
  <view wx:elif="{{!loading && !hasData}}" class="empty-container">
    <van-empty description="暂无学习数据" />
    <view class="empty-tip">完成作业或提问后，这里将展示您的学习报告</view>
  </view>

  <!-- 报告内容：简洁显示学习概览和学习模式 -->
  <view wx:elif="{{!loading && hasData}}" class="report-content">
    <!-- 学习概览 -->
    <view class="section overview-section">
      <view class="section-header">
        <text class="section-title">学习概览</text>
        <text class="section-subtitle">最近{{timeRangeText}}的学习数据</text>
      </view>
      
      <view class="stat-grid">
        <view class="stat-card">
          <view class="stat-icon study-time-icon">
            <van-icon name="clock-o" size="24px" />
          </view>
          <view class="stat-content">
            <text class="stat-value">{{analytics.total_sessions}}</text>
            <text class="stat-label">学习会话</text>
          </view>
        </view>

        <view class="stat-card">
          <view class="stat-icon question-icon">
            <van-icon name="chat-o" size="24px" />
          </view>
          <view class="stat-content">
            <text class="stat-value">{{analytics.total_questions}}</text>
            <text class="stat-label">总提问数</text>
          </view>
        </view>

        <view class="stat-card">
          <view class="stat-icon rating-icon">
            <van-icon name="star-o" size="24px" />
          </view>
          <view class="stat-content">
            <text class="stat-value">{{analytics.avg_rating > 0 ? analytics.avg_rating : '--'}}</text>
            <text class="stat-label">平均评分</text>
          </view>
        </view>

        <view class="stat-card">
          <view class="stat-icon feedback-icon">
            <van-icon name="thumb-circle-o" size="24px" />
          </view>
          <view class="stat-content">
            <text class="stat-value">{{analytics.positive_feedback_rate > 0 ? analytics.positive_feedback_rate + '%' : '--'}}</text>
            <text class="stat-label">好评率</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 学习模式 -->
    <view class="section pattern-section">
      <view class="section-header">
        <text class="section-title">学习模式</text>
        <text class="section-subtitle">了解您的学习习惯</text>
      </view>

      <view class="pattern-cards">
        <view class="pattern-card">
          <view class="pattern-label">最活跃时段</view>
          <view class="pattern-value">{{learningPattern.most_active_hour}}:00</view>
        </view>

        <view class="pattern-card">
          <view class="pattern-label">最活跃日</view>
          <view class="pattern-value">{{learningPattern.most_active_day_text}}</view>
        </view>

        <view class="pattern-card">
          <view class="pattern-label">平均会话时长</view>
          <view class="pattern-value">{{learningPattern.avg_session_length}} 分钟</view>
        </view>

        <view class="pattern-card">
          <view class="pattern-label">偏好难度</view>
          <view class="pattern-value">{{learningPattern.preferred_difficulty_text}}</view>
        </view>
      </view>
    </view>

    <!-- 最后更新时间 -->
    <view class="report-footer">
      <text class="update-time">更新于 {{formattedUpdateTime}}</text>
    </view>
  </view>
</view>
