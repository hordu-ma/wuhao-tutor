# 📱 五好伴学小程序 - 开发调试指南

## 🎯 快速开始（3步搞定）

### 步骤 1: 安装微信开发者工具

1. **下载工具**
   - 访问：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
   - 选择 **macOS** 版本下载
   - 安装到 `/Applications` 目录

2. **启动工具**

   ```bash
   open -a "微信开发者工具"
   ```

3. **微信扫码登录**
   - 使用你的微信扫码登录开发者工具

---

### 步骤 2: 导入小程序项目

1. **打开微信开发者工具**

2. **点击 "导入" 或 "+"** 按钮

3. **填写项目信息**：
   - **项目目录**: `/Users/liguoma/my-devs/python/wuhao-tutor/miniprogram`
   - **AppID**:
     - 如果有测试 AppID，填入 `wx2a8b340606664785`（当前配置的）
     - 如果没有，选择 "使用测试号" 或 "不使用 AppID"
   - **项目名称**: `五好伴学小程序`

4. **点击 "导入"** 按钮

---

### 步骤 3: 启动后端服务（重要！）

小程序需要连接后端 API，确保后端服务在运行：

```bash
# 在项目根目录运行
cd /Users/liguoma/my-devs/python/wuhao-tutor
./scripts/start-dev.sh
```

或者分别启动：

```bash
# 后端（8000端口）
cd /Users/liguoma/my-devs/python/wuhao-tutor
uv run uvicorn src.main:app --reload --host 0.0.0.0 --port 8000

# 前端（5173端口，可选）
cd /Users/liguoma/my-devs/python/wuhao-tutor/frontend
npm run dev
```

---

## 🛠️ 开发工具配置

### 本地设置配置

在微信开发者工具中：

1. **点击右上角 "详情" 按钮**

2. **在 "本地设置" 标签中**：
   - ✅ 勾选 **"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"**
     - 这样才能访问 `http://localhost:8000` 的后端
   - ✅ 勾选 **"启用调试"**
   - ✅ 勾选 **"开启热重载"**
   - ✅ 勾选 **"调试基础库"** 选择最新版本

3. **编译模式**（可选）：
   - 可以添加自定义编译模式，快速跳转到特定页面
   - 点击 "添加编译模式" 按钮
   - 设置启动页面，如 `pages/login/login` 或 `pages/index/index`

---

## 📂 项目结构说明

```
miniprogram/
├── app.js                    # 小程序入口
├── app.json                  # 全局配置（页面路由、窗口样式等）
├── app.wxss                  # 全局样式
├── config/
│   └── index.js              # 环境配置（API地址等）★重要
├── pages/                    # 页面目录
│   ├── login/                # 登录页
│   ├── index/                # 首页/仪表盘
│   ├── homework/             # 作业批改
│   ├── chat/                 # AI问答
│   └── analysis/             # 学情分析
├── utils/                    # 工具函数
│   ├── request.js            # 网络请求封装
│   ├── auth.js               # 认证工具
│   └── storage.js            # 本地存储
└── components/               # 公共组件
```

---

## 🔧 常见调试技巧

### 1. 查看控制台日志

- **Console 面板**: 查看 `console.log()` 输出
- **Network 面板**: 查看网络请求
- **Storage 面板**: 查看本地存储数据

### 2. 调试 API 请求

小程序的 API 配置在 `config/index.js`：

```javascript
api: {
  baseUrl: 'http://localhost:8000',  // 后端地址
  version: 'v1',
  timeout: 10000,
}
```

**检查后端是否运行**：

```bash
curl http://localhost:8000/api/v1/health
```

应该返回：

```json
{ "status": "healthy" }
```

### 3. 真机调试

如果需要在真实手机上测试：

1. **点击工具栏的 "真机调试"** 按钮
2. **用微信扫描二维码**
3. **手机和电脑在同一局域网**
4. **修改 API 地址**：
   ```javascript
   baseUrl: 'http://你的电脑IP:8000'; // 例如 'http://192.168.1.100:8000'
   ```

获取电脑 IP：

```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

---

## 🐛 常见问题解决

### 问题 1: 请求失败 "不在以下 request 合法域名列表中"

**解决方案**：

- 在开发者工具 → 详情 → 本地设置
- 勾选 **"不校验合法域名..."**

### 问题 2: 无法连接后端 API

**检查清单**：

1. ✅ 后端服务是否在 8000 端口运行？

   ```bash
   lsof -ti:8000
   ```

2. ✅ API 地址配置是否正确？
   - 查看 `config/index.js` 中的 `api.baseUrl`

3. ✅ 网络请求是否被拦截？
   - 查看开发者工具的 Network 面板
   - 查看控制台错误信息

### 问题 3: 页面空白或报错

**调试步骤**：

1. 打开 Console 面板查看错误
2. 检查 `app.json` 中的页面路径是否正确
3. 检查页面的 `.json`、`.wxml`、`.wxss` 文件是否完整

### 问题 4: npm 依赖无法使用

**解决方案**：

```bash
# 在小程序目录安装依赖
cd /Users/liguoma/my-devs/python/wuhao-tutor/miniprogram
npm install

# 在微信开发者工具中：工具 → 构建 npm
```

---

## 📝 开发流程

### 日常开发步骤

1. **启动后端服务**

   ```bash
   cd /Users/liguoma/my-devs/python/wuhao-tutor
   ./scripts/start-dev.sh
   ```

2. **打开微信开发者工具**
   - 导入小程序项目
   - 确保 "不校验合法域名" 已勾选

3. **开始编码**
   - 修改代码会自动刷新（热重载）
   - 查看控制台调试信息

4. **测试功能**
   - 模拟器测试
   - 真机调试（可选）

5. **提交代码**
   ```bash
   git add .
   git commit -m "feat(miniprogram): 添加某功能"
   git push
   ```

---

## 🎨 推荐 VS Code 扩展

虽然主要在微信开发者工具中调试，但编写代码可以用 VS Code：

- **WXML - Language Service**: 小程序 WXML 语法高亮
- **wxapp-helper**: 小程序代码补全
- **minapp**: 微信小程序标签、属性的智能补全

安装：

```bash
code --install-extension qiu8310.minapp-vscode
```

---

## 📞 获取帮助

- **微信开放文档**: https://developers.weixin.qq.com/miniprogram/dev/framework/
- **项目文档**: `docs/miniprogram/`
- **API 文档**: `docs/api/`

---

## 🚀 下一步

完成上述步骤后，你应该能够：

✅ 在微信开发者工具中看到小程序界面  
✅ 登录功能正常（连接后端 API）  
✅ 可以查看控制台日志进行调试  
✅ 代码修改后自动刷新预览

开始愉快地开发吧！🎉
