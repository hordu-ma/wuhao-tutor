# 🔧 立即修复：字体加载和域名校验问题

**错误信息**: `Failed to load font http://at.alicdn.com/t/font_...`  
**原因**: 微信小程序默认要求 HTTPS，但 Vant 字体使用 HTTP  
**状态**: 需要关闭域名校验

---

## ✅ 解决方案（2 分钟完成）

### 步骤 1：打开本地设置

在微信开发者工具中：

1. 点击右上角 **"详情"** 按钮
2. 选择 **"本地设置"** 选项卡

---

### 步骤 2：关闭域名校验

找到并 **勾选** 以下选项：

```
✅ 不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书
```

**重要**: 这个选项必须勾选，否则 HTTP 请求会被拦截

---

### 步骤 3：同时确认其他必要选项

在同一个"本地设置"页面，确认以下选项也已勾选：

```
✅ 增强编译
✅ 使用 npm 模块
✅ ES6 转 ES5
✅ 上传代码时样式自动补全
✅ 上传代码时自动压缩混淆
```

---

### 步骤 4：清除缓存并重新编译

1. 菜单栏 → **工具** → **清除缓存** → **清除全部**
2. 点击 **"编译"** 按钮
3. 等待编译完成

---

## 🎯 验证修复是否成功

### 情况 A：错误消失 ✅

控制台不再显示字体加载错误，说明修复成功。

**下一步**：

- 如果当前页面是测试页面（紫色背景），查看测试结果
- 如果测试通过，按照 `问题诊断指南.md` 恢复首页

---

### 情况 B：仍有字体错误 ⚠️

如果错误持续，检查：

1. **"不校验合法域名"** 是否真的勾选上了（蓝色勾）
2. 是否已清除缓存
3. 是否已重新编译

**如果仍失败**，尝试：

- 完全关闭微信开发者工具
- 重新打开
- 再次检查"本地设置"
- 重新编译

---

### 情况 C：出现其他错误 ⚠️

如果出现 `regeneratorRuntime is not defined` 错误：

- 说明"增强编译"未正确启用
- 参考 `紧急修复指南.md` 处理

---

## 📊 完整的本地设置清单

请确认以下所有选项都已勾选：

```
本地设置：
✅ 不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书
✅ 增强编译
✅ 启用自定义处理命令
✅ 启用自定义处理命令（脚本类文件）
✅ 不校验插件有效域名
✅ 使用 npm 模块
✅ ES6 转 ES5
✅ 上传代码时样式自动补全
✅ 上传代码时自动压缩混淆
✅ 上传时进行代码保护
```

**注意**: "不校验合法域名" 仅在开发环境使用，生产环境需要在微信公众平台配置合法域名。

---

## 🔍 技术说明

### 为什么需要关闭域名校验？

1. **Vant Weapp** 使用阿里云 CDN 加载图标字体
2. 字体 URL: `http://at.alicdn.com/t/font_*.woff`（HTTP）
3. 微信小程序默认只允许 **HTTPS** 请求
4. **开发环境**可以关闭校验方便调试
5. **生产环境**需要在后台配置 `downloadDomain`

### project.config.json 已配置

```json
{
  "downloadDomain": ["https://t.alicdn.com", "https://at.alicdn.com"]
}
```

但这个配置**仅在生产环境生效**。开发环境必须手动关闭校验。

---

## ⚡ 快速检查命令

在控制台（Console）中输入以下命令，检查域名配置：

```javascript
// 查看当前配置
console.log('downloadDomain:', wx.getSystemInfoSync());
```

---

## 🎨 视觉确认

正确配置后，你应该看到：

- ✅ 页面正常显示
- ✅ Vant 组件图标正常显示
- ✅ 控制台没有字体加载错误
- ✅ 控制台没有网络请求错误

---

## 📝 操作总结

```
打开详情
   ↓
本地设置
   ↓
勾选"不校验合法域名"
   ↓
勾选"增强编译"
   ↓
勾选"使用 npm 模块"
   ↓
勾选"ES6 转 ES5"
   ↓
清除全部缓存
   ↓
重新编译
   ↓
验证结果
```

---

## 🆘 如果问题持续

请提供以下截图：

1. **"详情" → "本地设置"** 的完整截图
2. **控制台 Console** 的错误信息
3. **控制台 Network** 的请求列表

---

**优先级**: 🔴 最高（阻塞编译）  
**预计耗时**: 2 分钟  
**成功率**: 99%

---

**创建时间**: 2025-01-16  
**文档版本**: v1.0
