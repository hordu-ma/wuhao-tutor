# äº”å¥½ä¼´å­¦å¾®ä¿¡å°ç¨‹åº - ç½‘ç»œå±‚æ¶æ„æ–‡æ¡£

## ç›®å½•

- [1. æ¦‚è¿°](#1-æ¦‚è¿°)
- [2. æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
- [3. æ ¸å¿ƒç»„ä»¶](#3-æ ¸å¿ƒç»„ä»¶)
- [4. ä½¿ç”¨æŒ‡å—](#4-ä½¿ç”¨æŒ‡å—)
- [5. é…ç½®è¯´æ˜](#5-é…ç½®è¯´æ˜)
- [6. é”™è¯¯å¤„ç†](#6-é”™è¯¯å¤„ç†)
- [7. æ€§èƒ½ä¼˜åŒ–](#7-æ€§èƒ½ä¼˜åŒ–)
- [8. ç›‘æ§ä¸è°ƒè¯•](#8-ç›‘æ§ä¸è°ƒè¯•)
- [9. æœ€ä½³å®è·µ](#9-æœ€ä½³å®è·µ)
- [10. æ•…éšœæ’æŸ¥](#10-æ•…éšœæ’æŸ¥)

## 1. æ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

äº”å¥½ä¼´å­¦å¾®ä¿¡å°ç¨‹åºç½‘ç»œå±‚æ¶æ„æ—¨åœ¨æä¾›ï¼š

- **ç»Ÿä¸€çš„APIè¯·æ±‚ç®¡ç†**ï¼šæ ‡å‡†åŒ–çš„è¯·æ±‚/å“åº”å¤„ç†
- **æ™ºèƒ½ç¼“å­˜ç­–ç•¥**ï¼šå¤šå±‚ç¼“å­˜æœºåˆ¶ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **å¥å£®çš„é”™è¯¯å¤„ç†**ï¼šå…¨é¢çš„é”™è¯¯æ•è·ä¸å¤„ç†æœºåˆ¶
- **ç½‘ç»œçŠ¶æ€ç›‘æ§**ï¼šå®æ—¶ç½‘ç»œè´¨é‡ç›‘æµ‹ä¸é€‚é…
- **è¯·æ±‚é˜Ÿåˆ—ç®¡ç†**ï¼šå¹¶å‘æ§åˆ¶ä¸ä¼˜å…ˆçº§ç®¡ç†
- **æ€§èƒ½ç›‘æ§**ï¼šè¯·æ±‚æ€§èƒ½è·Ÿè¸ªä¸ä¼˜åŒ–å»ºè®®

### 1.2 æŠ€æœ¯ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½**ï¼šè¯·æ±‚å»é‡ã€å¹¶å‘æ§åˆ¶ã€æ™ºèƒ½é‡è¯•
- ğŸ”§ **å¯é…ç½®**ï¼šçµæ´»çš„é…ç½®ç³»ç»Ÿï¼Œæ”¯æŒå¤šç¯å¢ƒåˆ‡æ¢
- ğŸ›¡ï¸ **å®‰å…¨å¯é **ï¼šè®¤è¯ç®¡ç†ã€é”™è¯¯å¤„ç†ã€æ•°æ®åŠ å¯†
- ğŸ“Š **å¯è§‚æµ‹**ï¼šå®Œæ•´çš„ç›‘æ§æŒ‡æ ‡ä¸æ—¥å¿—ç³»ç»Ÿ
- ğŸ¯ **ç”¨æˆ·å‹å¥½**ï¼šæ™ºèƒ½çš„ç”¨æˆ·ä½“éªŒä¼˜åŒ–

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åº”ç”¨å±‚ (Pages/Components)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     APIæ¥å£å±‚ (api/*)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 å¢å¼ºç‰ˆAPIå®¢æˆ·ç«¯ (EnhancedApiClient)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ç½‘ç»œç›‘æ§   â”‚ â”‚  ç¼“å­˜ç®¡ç†   â”‚ â”‚  é˜Ÿåˆ—ç®¡ç†   â”‚ â”‚ é”™è¯¯å¤„ç†â”‚ â”‚
â”‚  â”‚ NetworkMon  â”‚ â”‚ CacheMan    â”‚ â”‚ RequestQ    â”‚ â”‚ErrorHan â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    è®¤è¯ç®¡ç† (AuthManager)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å­˜å‚¨ç®¡ç† (StorageManager)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  å¾®ä¿¡å°ç¨‹åºç½‘ç»œAPI (wx.request)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµå‘

```
ç”¨æˆ·æ“ä½œ â†’ APIè°ƒç”¨ â†’ è¯·æ±‚é¢„å¤„ç† â†’ ç¼“å­˜æ£€æŸ¥ â†’ é˜Ÿåˆ—è°ƒåº¦ â†’ ç½‘ç»œè¯·æ±‚ â†’ å“åº”å¤„ç† â†’ ç¼“å­˜æ›´æ–° â†’ UIæ›´æ–°
                        â†“              â†“           â†“           â†“
                   é”™è¯¯å¤„ç† â†â”€â”€ ç½‘ç»œç›‘æ§ â†â”€â”€ æ€§èƒ½ç›‘æ§ â†â”€â”€ ç»Ÿè®¡ä¸ŠæŠ¥
```

## 3. æ ¸å¿ƒç»„ä»¶

### 3.1 å¢å¼ºç‰ˆAPIå®¢æˆ·ç«¯ (EnhancedApiClient)

**ä½ç½®**: `utils/api.js`

**åŠŸèƒ½ç‰¹æ€§**:
- ç»Ÿä¸€çš„HTTPè¯·æ±‚å°è£…
- è¯·æ±‚/å“åº”æ‹¦æˆªå™¨æœºåˆ¶
- è‡ªåŠ¨è®¤è¯å¤´æ³¨å…¥
- è¯·æ±‚å»é‡ä¸ç¼“å­˜é›†æˆ
- é‡è¯•æœºåˆ¶ä¸é”™è¯¯å¤„ç†

**æ ¸å¿ƒæ–¹æ³•**:

```javascript
// åŸºç¡€è¯·æ±‚æ–¹æ³•
apiClient.request(config)
apiClient.get(url, params, options)
apiClient.post(url, data, options)
apiClient.put(url, data, options)
apiClient.delete(url, options)
apiClient.patch(url, data, options)

// æ–‡ä»¶æ“ä½œ
apiClient.upload(url, filePath, options)
apiClient.download(url, options)

// æ‹¦æˆªå™¨ç®¡ç†
apiClient.addRequestInterceptor(fulfilled, rejected)
apiClient.addResponseInterceptor(fulfilled, rejected)

// é…ç½®ä¸ç»Ÿè®¡
apiClient.setDefaults(config)
apiClient.getStats()
apiClient.resetStats()
```

### 3.2 ç½‘ç»œçŠ¶æ€ç›‘æ§å™¨ (NetworkMonitor)

**ä½ç½®**: `utils/network-monitor.js`

**åŠŸèƒ½ç‰¹æ€§**:
- å®æ—¶ç½‘ç»œçŠ¶æ€ç›‘æµ‹
- ç½‘ç»œè´¨é‡è¯„ä¼°
- ç½‘ç»œåˆ‡æ¢äº‹ä»¶ç›‘å¬
- ç½‘ç»œé€‚é…å»ºè®®

**ä½¿ç”¨ç¤ºä¾‹**:

```javascript
import { networkMonitor } from './utils/network-monitor.js';

// è·å–å½“å‰ç½‘ç»œçŠ¶æ€
const status = networkMonitor.getCurrentStatus();
console.log('ç½‘ç»œçŠ¶æ€:', status);

// ç›‘å¬ç½‘ç»œå˜åŒ–
const unsubscribe = networkMonitor.addListener((current, previous) => {
  console.log('ç½‘ç»œçŠ¶æ€å˜åŒ–:', current);
});

// æ£€æŸ¥ç½‘ç»œè´¨é‡
const quality = networkMonitor.getNetworkQuality();
console.log('ç½‘ç»œè´¨é‡:', quality.grade, quality.description);

// æ£€æŸ¥æ˜¯å¦é€‚åˆæŸç§æ“ä½œ
const suitable = networkMonitor.isNetworkSuitableFor('file_upload');
if (!suitable.suitable) {
  console.warn('å½“å‰ç½‘ç»œä¸é€‚åˆæ–‡ä»¶ä¸Šä¼ :', suitable.reason);
}
```

### 3.3 ç¼“å­˜ç®¡ç†å™¨ (CacheManager)

**ä½ç½®**: `utils/cache-manager.js`

**åŠŸèƒ½ç‰¹æ€§**:
- å¤šå±‚ç¼“å­˜ç­–ç•¥ (å†…å­˜/å­˜å‚¨)
- è‡ªåŠ¨è¿‡æœŸä¸æ¸…ç†
- ç¼“å­˜å‹ç¼©ä¸åŠ å¯†
- æ ‡ç­¾åŒ–ç¼“å­˜ç®¡ç†

**ç¼“å­˜ç­–ç•¥**:

```javascript
const CacheStrategy = {
  NO_CACHE: 'NO_CACHE',           // ä¸ç¼“å­˜
  MEMORY_CACHE: 'MEMORY_CACHE',   // å†…å­˜ç¼“å­˜
  STORAGE_CACHE: 'STORAGE_CACHE', // å­˜å‚¨ç¼“å­˜
  NETWORK_FIRST: 'NETWORK_FIRST', // ç½‘ç»œä¼˜å…ˆ
  CACHE_FIRST: 'CACHE_FIRST',     // ç¼“å­˜ä¼˜å…ˆ
  CACHE_ONLY: 'CACHE_ONLY',       // ä»…ç¼“å­˜
  NETWORK_ONLY: 'NETWORK_ONLY'    // ä»…ç½‘ç»œ
};
```

**ä½¿ç”¨ç¤ºä¾‹**:

```javascript
import { cacheManager, CacheStrategy } from './utils/cache-manager.js';

// è®¾ç½®ç¼“å­˜
await cacheManager.set('user_profile', userData, {
  strategy: CacheStrategy.STORAGE_CACHE,
  ttl: 24 * 60 * 60 * 1000, // 24å°æ—¶
  tags: ['user', 'profile'],
  encrypt: true
});

// è·å–ç¼“å­˜
const userData = await cacheManager.get('user_profile');

// æŒ‰æ ‡ç­¾æ¸…ç†ç¼“å­˜
await cacheManager.deleteByTags(['user']);
```

### 3.4 è¯·æ±‚é˜Ÿåˆ—ç®¡ç†å™¨ (RequestQueue)

**ä½ç½®**: `utils/request-queue.js`

**åŠŸèƒ½ç‰¹æ€§**:
- å¹¶å‘æ•°æ§åˆ¶
- ä¼˜å…ˆçº§é˜Ÿåˆ—
- è¯·æ±‚å»é‡
- è‡ªåŠ¨é‡è¯•æœºåˆ¶

**ä¼˜å…ˆçº§å®šä¹‰**:

```javascript
const Priority = {
  HIGH: 3,    // é«˜ä¼˜å…ˆçº§ (ç”¨æˆ·äº¤äº’ã€è®¤è¯ç­‰)
  NORMAL: 2,  // æ™®é€šä¼˜å…ˆçº§ (æ•°æ®è·å–ç­‰)
  LOW: 1      // ä½ä¼˜å…ˆçº§ (ç»Ÿè®¡ä¸ŠæŠ¥ã€æ—¥å¿—ç­‰)
};
```

**ä½¿ç”¨ç¤ºä¾‹**:

```javascript
import { requestQueue, Priority } from './utils/request-queue.js';

// æ·»åŠ é«˜ä¼˜å…ˆçº§è¯·æ±‚
const result = await requestQueue.enqueue(() => {
  return wx.request({
    url: 'https://api.example.com/urgent',
    method: 'POST',
    data: { urgent: true }
  });
}, {
  priority: Priority.HIGH,
  timeout: 5000,
  retryCount: 2
});

// è·å–é˜Ÿåˆ—çŠ¶æ€
const status = requestQueue.getStatus();
console.log('é˜Ÿåˆ—çŠ¶æ€:', status);
```

### 3.5 é”™è¯¯å¤„ç†å™¨ (ErrorHandler)

**ä½ç½®**: `utils/error-handler.js`

**åŠŸèƒ½ç‰¹æ€§**:
- åˆ†ç±»é”™è¯¯å¤„ç†
- è‡ªå®šä¹‰å¤„ç†ç­–ç•¥
- é”™è¯¯ä¸ŠæŠ¥æœºåˆ¶
- ç”¨æˆ·å‹å¥½æç¤º

**é”™è¯¯åˆ†ç±»**:

```javascript
const ErrorCategory = {
  NETWORK: 'NETWORK',         // ç½‘ç»œé”™è¯¯
  AUTH: 'AUTH',               // è®¤è¯é”™è¯¯
  VALIDATION: 'VALIDATION',   // éªŒè¯é”™è¯¯
  BUSINESS: 'BUSINESS',       // ä¸šåŠ¡é”™è¯¯
  SYSTEM: 'SYSTEM',           // ç³»ç»Ÿé”™è¯¯
  PERMISSION: 'PERMISSION',   // æƒé™é”™è¯¯
  TIMEOUT: 'TIMEOUT',         // è¶…æ—¶é”™è¯¯
  UNKNOWN: 'UNKNOWN'          // æœªçŸ¥é”™è¯¯
};
```

**å¤„ç†ç­–ç•¥**:

```javascript
const ErrorStrategy = {
  SILENT: 'SILENT',       // é™é»˜å¤„ç†
  TOAST: 'TOAST',         // æ˜¾ç¤ºToast
  MODAL: 'MODAL',         // æ˜¾ç¤ºæ¨¡æ€æ¡†
  PAGE: 'PAGE',           // è·³è½¬é”™è¯¯é¡µ
  RETRY: 'RETRY',         // è‡ªåŠ¨é‡è¯•
  REPORT: 'REPORT',       // ä¸ŠæŠ¥é”™è¯¯
  FALLBACK: 'FALLBACK'    // é™çº§å¤„ç†
};
```

## 4. ä½¿ç”¨æŒ‡å—

### 4.1 åŸºç¡€APIè°ƒç”¨

```javascript
import { api } from '../utils/api.js';

// è·å–ä½œä¸šåˆ—è¡¨ (è‡ªåŠ¨ç¼“å­˜)
const homeworkList = await api.homework.getList({
  page: 1,
  size: 20,
  status: 'pending'
});

// æäº¤ä½œä¸š (é«˜ä¼˜å…ˆçº§)
const submitResult = await api.homework.submit(homeworkId, {
  answers: userAnswers,
  attachments: uploadedFiles
});

// å‘é€AIæ¶ˆæ¯ (å¸¦é‡è¯•)
const chatResponse = await api.chat.sendMessage({
  sessionId: currentSessionId,
  message: userInput,
  type: 'text'
});
```

### 4.2 è‡ªå®šä¹‰è¯·æ±‚é…ç½®

```javascript
import { apiClient, Priority, CacheStrategy } from '../utils/api.js';

// è‡ªå®šä¹‰è¯·æ±‚é…ç½®
const customRequest = await apiClient.post('/custom/endpoint', data, {
  // ä¼˜å…ˆçº§é…ç½®
  priority: Priority.HIGH,

  // ç¼“å­˜é…ç½®
  enableCache: true,
  cache: {
    strategy: CacheStrategy.CACHE_FIRST,
    ttl: 10 * 60 * 1000, // 10åˆ†é’Ÿ
    tags: ['custom', 'endpoint']
  },

  // é‡è¯•é…ç½®
  retry: {
    maxRetries: 2,
    baseDelay: 1000,
    strategy: 'EXPONENTIAL_BACKOFF'
  },

  // è¶…æ—¶é…ç½®
  timeout: 15000,

  // å…¶ä»–é€‰é¡¹
  skipAuth: false,
  enableQueue: true,
  enableDeduplication: true
});
```

### 4.3 é”™è¯¯å¤„ç†é›†æˆ

```javascript
import { errorHandler, ErrorCategory, ErrorStrategy } from '../utils/error-handler.js';

// è‡ªå®šä¹‰é”™è¯¯å¤„ç†è§„åˆ™
errorHandler.addRule({
  category: ErrorCategory.BUSINESS,
  condition: (error) => error.statusCode === 400 && error.data?.code === 'HOMEWORK_EXPIRED',
  strategy: ErrorStrategy.MODAL,
  message: 'ä½œä¸šå·²è¿‡æœŸï¼Œæ— æ³•æäº¤',
  action: 'goBack'
});

// æ‰‹åŠ¨å¤„ç†é”™è¯¯
try {
  const result = await api.homework.submit(id, data);
} catch (error) {
  errorHandler.handleError(error, {
    operation: 'homework_submit',
    homeworkId: id,
    timestamp: Date.now()
  });
}
```

### 4.4 ç½‘ç»œçŠ¶æ€é€‚é…

```javascript
import { networkMonitor } from '../utils/network-monitor.js';

// æ ¹æ®ç½‘ç»œçŠ¶æ€è°ƒæ•´è¡Œä¸º
const performUpload = async (files) => {
  const networkStatus = networkMonitor.getCurrentStatus();

  if (!networkStatus.isConnected) {
    throw new Error('ç½‘ç»œæœªè¿æ¥ï¼Œæ— æ³•ä¸Šä¼ æ–‡ä»¶');
  }

  // æ£€æŸ¥ç½‘ç»œæ˜¯å¦é€‚åˆå¤§æ–‡ä»¶ä¸Šä¼ 
  const suitable = networkMonitor.isNetworkSuitableFor('large_download');

  if (!suitable.suitable && files.some(f => f.size > 5 * 1024 * 1024)) {
    // ç½‘ç»œè¾ƒå·®æ—¶ï¼Œå‹ç¼©å›¾ç‰‡æˆ–æç¤ºç”¨æˆ·
    wx.showModal({
      title: 'ç½‘ç»œæç¤º',
      content: 'å½“å‰ç½‘ç»œçŠ¶å†µä¸ä½³ï¼Œå»ºè®®åœ¨WiFiç¯å¢ƒä¸‹ä¸Šä¼ å¤§æ–‡ä»¶',
      showCancel: true,
      confirmText: 'ç»§ç»­ä¸Šä¼ ',
      cancelText: 'ç¨åä¸Šä¼ '
    });
  }

  // æ‰§è¡Œä¸Šä¼ 
  return api.upload.file(files[0].path, {
    onProgress: (progress) => {
      console.log(`ä¸Šä¼ è¿›åº¦: ${progress.progress}%`);
    }
  });
};
```

## 5. é…ç½®è¯´æ˜

### 5.1 ç¯å¢ƒé…ç½®

**å¼€å‘ç¯å¢ƒ** (`config/environments/development.js`):

```javascript
module.exports = {
  api: {
    baseUrl: 'https://dev-api.wuhao-tutor.com',
    timeout: 10000,
    retryCount: 3,
    retryDelay: 1000
  },
  cache: {
    defaultTTL: 5 * 60 * 1000,
    maxMemoryItems: 50
  },
  error: {
    showDetails: true,
    autoReport: false
  },
  performance: {
    enabled: true,
    sampleRate: 1.0
  }
};
```

**ç”Ÿäº§ç¯å¢ƒ** (`config/environments/production.js`):

```javascript
module.exports = {
  api: {
    baseUrl: 'https://api.wuhao-tutor.com',
    timeout: 15000,
    retryCount: 2,
    retryDelay: 2000
  },
  cache: {
    defaultTTL: 10 * 60 * 1000,
    maxMemoryItems: 100
  },
  error: {
    showDetails: false,
    autoReport: true
  },
  performance: {
    enabled: true,
    sampleRate: 0.1
  }
};
```

### 5.2 ç½‘ç»œå±‚é…ç½®

```javascript
// é…ç½®APIå®¢æˆ·ç«¯
apiClient.setDefaults({
  retry: {
    strategy: 'EXPONENTIAL_BACKOFF',
    maxRetries: 3,
    baseDelay: 1000,
    maxDelay: 10000,
    multiplier: 2,
    jitter: 0.1
  },
  cache: {
    strategy: CacheStrategy.MEMORY_CACHE,
    ttl: 5 * 60 * 1000,
    enableCache: false
  },
  queue: {
    enableQueue: true,
    priority: Priority.NORMAL,
    enableDeduplication: true
  }
});

// é…ç½®é”™è¯¯å¤„ç†å™¨
errorHandler.setConfig({
  enabled: true,
  showDetails: __DEV__,
  autoReport: !__DEV__,
  maxErrorLogs: 1000,
  reportInterval: 60000,
  reportBatchSize: 20
});

// é…ç½®ç¼“å­˜ç®¡ç†å™¨
cacheManager.setConfig({
  defaultTTL: 10 * 60 * 1000,
  maxMemoryItems: 100,
  compressionThreshold: 2048,
  encryptionEnabled: true
});
```

## 6. é”™è¯¯å¤„ç†

### 6.1 é”™è¯¯åˆ†ç±»ä¸å¤„ç†

| é”™è¯¯ç±»å‹ | HTTPçŠ¶æ€ç  | å¤„ç†ç­–ç•¥ | ç”¨æˆ·ä½“éªŒ |
|---------|-----------|---------|---------|
| ç½‘ç»œé”™è¯¯ | 0 | Toast + é‡è¯• | "ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®" |
| è®¤è¯è¿‡æœŸ | 401 | Modal + é‡å®šå‘ | "ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•" |
| æƒé™ä¸è¶³ | 403 | Toast | "æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ" |
| å‚æ•°é”™è¯¯ | 422 | Toast | æ˜¾ç¤ºå…·ä½“éªŒè¯é”™è¯¯ä¿¡æ¯ |
| ä¸šåŠ¡é”™è¯¯ | 400 | Toast/Modal | æ˜¾ç¤ºä¸šåŠ¡é”™è¯¯ä¿¡æ¯ |
| æœåŠ¡å™¨é”™è¯¯ | 500+ | Modal + é‡è¯• | "æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•" |

### 6.2 é”™è¯¯æ¢å¤æœºåˆ¶

```javascript
// ç½‘ç»œé‡è¿æ¢å¤
networkMonitor.addListener((current, previous) => {
  if (!previous.isConnected && current.isConnected) {
    // ç½‘ç»œæ¢å¤ï¼Œé‡è¯•å¤±è´¥çš„è¯·æ±‚
    requestQueue.resume();
    console.log('ç½‘ç»œå·²æ¢å¤ï¼Œå¼€å§‹é‡è¯•å¤±è´¥çš„è¯·æ±‚');
  }
});

// è®¤è¯è¿‡æœŸæ¢å¤
apiClient.addResponseInterceptor(null, async (error) => {
  if (error.statusCode === 401) {
    try {
      // è‡ªåŠ¨åˆ·æ–°Token
      await auth.refreshToken();
      // é‡è¯•åŸè¯·æ±‚
      return apiClient.request(error.config);
    } catch (refreshError) {
      // åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬ç™»å½•
      wx.redirectTo({ url: '/pages/login/index' });
      throw refreshError;
    }
  }
  throw error;
});
```

## 7. æ€§èƒ½ä¼˜åŒ–

### 7.1 ç¼“å­˜ç­–ç•¥ä¼˜åŒ–

```javascript
// ä¸åŒæ•°æ®çš„ç¼“å­˜ç­–ç•¥
const cacheStrategies = {
  // ç”¨æˆ·ä¿¡æ¯ - é•¿æœŸç¼“å­˜
  userProfile: {
    strategy: CacheStrategy.STORAGE_CACHE,
    ttl: 24 * 60 * 60 * 1000, // 24å°æ—¶
    tags: ['user']
  },

  // ä½œä¸šåˆ—è¡¨ - çŸ­æœŸç¼“å­˜
  homeworkList: {
    strategy: CacheStrategy.MEMORY_CACHE,
    ttl: 5 * 60 * 1000, // 5åˆ†é’Ÿ
    tags: ['homework']
  },

  // ç³»ç»Ÿé…ç½® - é•¿æœŸç¼“å­˜
  systemConfig: {
    strategy: CacheStrategy.STORAGE_CACHE,
    ttl: 60 * 60 * 1000, // 1å°æ—¶
    tags: ['system']
  },

  // èŠå¤©å†å² - æ··åˆç­–ç•¥
  chatHistory: {
    strategy: CacheStrategy.CACHE_FIRST,
    ttl: 10 * 60 * 1000, // 10åˆ†é’Ÿ
    tags: ['chat']
  }
};
```

### 7.2 è¯·æ±‚ä¼˜åŒ–

```javascript
// è¯·æ±‚ä¼˜å…ˆçº§ç®¡ç†
const priorityMap = {
  // ç”¨æˆ·äº¤äº’ - æœ€é«˜ä¼˜å…ˆçº§
  userInteraction: Priority.HIGH,
  // æ•°æ®è·å– - æ™®é€šä¼˜å…ˆçº§
  dataFetch: Priority.NORMAL,
  // åå°ä»»åŠ¡ - æœ€ä½ä¼˜å…ˆçº§
  background: Priority.LOW
};

// è¯·æ±‚å»é‡
const deduplicationConfig = {
  // GETè¯·æ±‚é»˜è®¤å»é‡
  enableDeduplication: true,
  // å»é‡æ—¶é—´çª—å£
  deduplicationWindow: 1000
};

// å¹¶å‘æ§åˆ¶
requestQueue.setConfig({
  maxConcurrency: 6,      // æœ€å¤§å¹¶å‘æ•°
  maxQueueSize: 100,      // é˜Ÿåˆ—æœ€å¤§é•¿åº¦
  enablePriority: true,   // å¯ç”¨ä¼˜å…ˆçº§
  highPriorityRatio: 0.3  // é«˜ä¼˜å…ˆçº§æ¯”ä¾‹é™åˆ¶
});
```

### 7.3 ç½‘ç»œé€‚é…ä¼˜åŒ–

```javascript
// æ ¹æ®ç½‘ç»œçŠ¶æ€è°ƒæ•´ç­–ç•¥
const adaptToNetwork = () => {
  const networkStatus = networkMonitor.getCurrentStatus();
  const quality = networkMonitor.getNetworkQuality();

  if (quality.score < 60) {
    // ç½‘ç»œè´¨é‡è¾ƒå·®æ—¶çš„ä¼˜åŒ–ç­–ç•¥
    apiClient.setDefaults({
      timeout: 20000,           // å¢åŠ è¶…æ—¶æ—¶é—´
      retry: { maxRetries: 1 }, // å‡å°‘é‡è¯•æ¬¡æ•°
      cache: {
        strategy: CacheStrategy.CACHE_FIRST,  // ä¼˜å…ˆä½¿ç”¨ç¼“å­˜
        ttl: 30 * 60 * 1000    // å»¶é•¿ç¼“å­˜æ—¶é—´
      }
    });

    // æš‚åœä½ä¼˜å…ˆçº§è¯·æ±‚
    requestQueue.setConfig({ maxConcurrency: 3 });
  } else {
    // ç½‘ç»œè´¨é‡è‰¯å¥½æ—¶æ¢å¤é»˜è®¤é…ç½®
    apiClient.setDefaults(defaultApiConfig);
    requestQueue.setConfig({ maxConcurrency: 6 });
  }
};

// ç›‘å¬ç½‘ç»œå˜åŒ–ï¼ŒåŠ¨æ€è°ƒæ•´
networkMonitor.addListener(adaptToNetwork);
```

## 8. ç›‘æ§ä¸è°ƒè¯•

### 8.1 æ€§èƒ½ç›‘æ§

```javascript
// è·å–APIå®¢æˆ·ç«¯ç»Ÿè®¡
const apiStats = apiClient.getStats();
console.log('APIç»Ÿè®¡:', {
  æ€»è¯·æ±‚æ•°: apiStats.totalRequests,
  æˆåŠŸç‡: apiStats.successRate + '%',
  å¹³å‡å“åº”æ—¶é—´: apiStats.averageResponseTime + 'ms',
  ç¼“å­˜å‘½ä¸­ç‡: apiStats.cacheHitRate + '%'
});

// è·å–é˜Ÿåˆ—çŠ¶æ€
const queueStatus = requestQueue.getStatus();
console.log('é˜Ÿåˆ—çŠ¶æ€:', {
  é˜Ÿåˆ—é•¿åº¦: queueStatus.queueLength,
  æ´»è·ƒè¯·æ±‚: queueStatus.activeRequests,
  å¹³å‡ç­‰å¾…æ—¶é—´: queueStatus.stats.averageWaitTime + 'ms'
});

// è·å–ç½‘ç»œç»Ÿè®¡
const networkStats = networkMonitor.getStatistics();
console.log('ç½‘ç»œç»Ÿè®¡:', {
  å¹³å‡å»¶è¿Ÿ: networkStats.latency.avg + 'ms',
  å¹³å‡å¸¦å®½: networkStats.bandwidth.avg + 'Mbps',
  ä¿¡å·å¼ºåº¦: networkStats.signalStrength.avg
});
```

### 8.2 é”™è¯¯ç›‘æ§

```javascript
// è·å–é”™è¯¯ç»Ÿè®¡
const errorStats = errorHandler.getStats();
console.log('é”™è¯¯ç»Ÿè®¡:', {
  æ€»é”™è¯¯æ•°: errorStats.totalErrors,
  ç½‘ç»œé”™è¯¯: errorStats.networkErrors,
  è®¤è¯é”™è¯¯: errorStats.authErrors,
  é”™è¯¯ç‡: errorStats.errorRate + 'æ¬¡/åˆ†é’Ÿ'
});

// è·å–é”™è¯¯æ—¥å¿—
const recentErrors = errorHandler.getErrorLogs(10);
console.log('æœ€è¿‘é”™è¯¯:', recentErrors);
```

### 8.3 è°ƒè¯•å·¥å…·

```javascript
// å¼€å‘ç¯å¢ƒè°ƒè¯•é¢æ¿
if (__DEV__) {
  const debugPanel = {
    showStats() {
      const stats = {
        api: apiClient.getStats(),
        queue: requestQueue.getStatus(),
        cache: cacheManager.getStats(),
        network: networkMonitor.getCurrentStatus(),
        errors: errorHandler.getStats()
      };
      console.table(stats);
    },

    clearCache() {
      cacheManager.clear();
      console.log('ç¼“å­˜å·²æ¸…ç©º');
    },

    clearQueue() {
      requestQueue.clear();
      console.log('è¯·æ±‚é˜Ÿåˆ—å·²æ¸…ç©º');
    },

    simulateError(type) {
      errorHandler.handleError({
        type: type,
        message: `æ¨¡æ‹Ÿ${type}é”™è¯¯`,
        statusCode: 500
      });
    }
  };

  // æŒ‚è½½åˆ°å…¨å±€ï¼Œæ–¹ä¾¿è°ƒè¯•
  wx.debugPanel = debugPanel;
}
```

## 9. æœ€ä½³å®è·µ

### 9.1 APIè®¾è®¡è§„èŒƒ

```javascript
// âœ… æ¨èï¼šä½¿ç”¨è¯­ä¹‰åŒ–çš„APIè°ƒç”¨
const homework = await api.homework.getDetail(homeworkId);
const submitResult = await api.homework.submit(homeworkId, answerData);

// âŒ ä¸æ¨èï¼šç›´æ¥ä½¿ç”¨åº•å±‚è¯·æ±‚
const homework = await apiClient.get(`/homework/${homeworkId}`);
```

### 9.2 é”™è¯¯å¤„ç†è§„èŒƒ

```javascript
// âœ… æ¨èï¼šä½¿ç”¨try-catchåŒ…è£…å¯èƒ½å¤±è´¥çš„æ“ä½œ
const handleSubmitHomework = async (homeworkId, data) => {
  try {
    const result = await api.homework.submit(homeworkId, data);
    wx.showToast({ title: 'æäº¤æˆåŠŸ', icon: 'success' });
    return result;
  } catch (error) {
    // é”™è¯¯ä¼šè¢«è‡ªåŠ¨å¤„ç†ï¼Œè¿™é‡Œåªéœ€è¦å¤„ç†ç‰¹æ®Šé€»è¾‘
    if (error.statusCode === 400 && error.data?.code === 'HOMEWORK_EXPIRED') {
      // ç‰¹æ®Šä¸šåŠ¡é€»è¾‘
      this.redirectToHomeworkList();
    }
    throw error;
  }
};

// âŒ ä¸æ¨èï¼šå¿½ç•¥é”™è¯¯æˆ–ä¸å½“å¤„ç†
const badSubmitHomework = async (homeworkId, data) => {
  api.homework.submit(homeworkId, data); // æ²¡æœ‰é”™è¯¯å¤„ç†
};
```

### 9.3 ç¼“å­˜ä½¿ç”¨è§„èŒƒ

```javascript
// âœ… æ¨èï¼šä¸ºä¸åŒç±»å‹çš„æ•°æ®é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç­–ç•¥
const getCachedUserProfile = () => {
  return api.auth.getUserInfo(); // è‡ªåŠ¨ä½¿ç”¨é•¿æœŸç¼“å­˜
};

const getLatestHomeworkList = () => {
  return api.homework.getList(params, {
    enableCache: true,
    cache: { ttl: 2 * 60 * 1000 } // çŸ­æœŸç¼“å­˜
  });
};

// âœ… æ¨èï¼šåŠæ—¶æ¸…ç†ç›¸å…³ç¼“å­˜
const updateUserProfile = async (data) => {
  const result = await api.auth.updateUserInfo(data);
  // æ¸…ç†ç›¸å…³ç¼“å­˜
  cacheManager.deleteByTags(['user']);
  return result;
};
```

### 9.4 ç½‘ç»œé€‚é…è§„èŒƒ

```javascript
// âœ… æ¨èï¼šåœ¨æ‰§è¡Œç½‘ç»œæ•æ„Ÿæ“ä½œå‰æ£€æŸ¥ç½‘ç»œçŠ¶æ€
const performLargeFileUpload = async (filePath) => {
  const suitable = networkMonitor.isNetworkSuitableFor('large_download');

  if (!suitable.suitable) {
    const confirm = await wx.showModal({
      title: 'ç½‘ç»œæç¤º',
      content: suitable.reason + 'ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ'
    });

    if (!confirm.confirm) {
      return;
    }
  }

  return api.upload.file(filePath, {
    onProgress: (progress) => {
      this.setData({ uploadProgress: progress.progress });
    }
  });
};
```

## 10. æ•…éšœæ’æŸ¥

### 10.1 å¸¸è§é—®é¢˜

#### é—®é¢˜1ï¼šè¯·æ±‚å¤±è´¥ï¼Œç½‘ç»œæ­£å¸¸
**ç—‡çŠ¶**ï¼šç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œä½†APIè¯·æ±‚å¤±è´¥
**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥APIåœ°å€é…ç½®æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥è¯·æ±‚å¤´æ˜¯å¦åŒ…å«å¿…è¦ä¿¡æ¯
3. æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸ
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯

```javascript
// è°ƒè¯•ä»£ç 
console.log('APIé…ç½®:', config.api);
console.log('å½“å‰Token:', await auth.getToken());
console.log('æœ€è¿‘é”™è¯¯:', errorHandler.getErrorLogs(5));
```

#### é—®é¢˜2ï¼šç¼“å­˜æœªç”Ÿæ•ˆ
**ç—‡çŠ¶**ï¼šç›¸åŒè¯·æ±‚æ¯æ¬¡éƒ½å‘é€ç½‘ç»œè¯·æ±‚
**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥ç¼“å­˜æ˜¯å¦å¯ç”¨
2. æ£€æŸ¥ç¼“å­˜é…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥ç¼“å­˜é”®æ˜¯å¦å†²çª

```javascript
// è°ƒè¯•ä»£ç 
console.log('ç¼“å­˜ç»Ÿè®¡:', cacheManager.getStats());
console.log('ç¼“å­˜å¤§å°:', await cacheManager.size());
```

#### é—®é¢˜3ï¼šè¯·æ±‚é˜Ÿåˆ—é˜»å¡
**ç—‡çŠ¶**ï¼šæ–°è¯·æ±‚é•¿æ—¶é—´ç­‰å¾…ï¼Œæ— æ³•å‘é€
**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€
2. æ£€æŸ¥æ˜¯å¦æœ‰è¯·æ±‚å¡æ­»
3. æ£€æŸ¥å¹¶å‘é…ç½®æ˜¯å¦åˆç†

```javascript
// è°ƒè¯•ä»£ç 
console.log('é˜Ÿåˆ—çŠ¶æ€:', requestQueue.getStatus());
console.log('æ´»è·ƒè¯·æ±‚:', requestQueue.getActiveRequests());
console.log('æ’é˜Ÿè¯·æ±‚:', requestQueue.getQueuedRequests());
```

### 10.2 æ€§èƒ½é—®é¢˜æ’æŸ¥

#### é—®é¢˜1ï¼šè¯·æ±‚å“åº”ç¼“æ…¢
**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥ç½‘ç»œè´¨é‡
2. æ£€æŸ¥æœåŠ¡å™¨å“åº”æ—¶é—´
3. æ£€æŸ¥è¯·æ±‚å¤§å°
4. æ£€æŸ¥å¹¶å‘æ•°è®¾ç½®

```javascript
// æ€§èƒ½åˆ†æ
const stats = apiClient.getStats();
console.log('å¹³å‡å“åº”æ—¶é—´:', stats.averageResponseTime);

const networkQuality = networkMonitor.getNetworkQuality();
console.log('ç½‘ç»œè´¨é‡:', networkQuality.grade, networkQuality.score);
```

#### é—®é¢˜2ï¼šå†…å­˜å ç”¨è¿‡é«˜
**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥ç¼“å­˜å¤§å°
2. æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼
3. è°ƒæ•´ç¼“å­˜é…ç½®

```javascript
// å†…å­˜ä½¿ç”¨åˆ†æ
const cacheStats = cacheManager.getStats();
console.log('ç¼“å­˜å‘½ä¸­ç‡:', cacheStats.hitRate);
console.log('å†…å­˜ç¼“å­˜å¤§å°:', cacheStats.memorySize);

// æ¸…ç†ç¼“å­˜
cacheManager.cleanup();
```

### 10.3 è°ƒè¯•æŠ€å·§

#### å¯ç”¨è¯¦ç»†æ—¥å¿—
```javascript
// å¼€å‘ç¯å¢ƒå¯ç”¨è¯¦ç»†æ—¥å¿—
if (__DEV__) {
  errorHandler.setConfig({ showDetails: true });

  // ç›‘å¬æ‰€æœ‰ç½‘ç»œäº‹ä»¶
  apiClient.on('request:start', (data) => {
    console.log('ğŸš€ è¯·æ±‚å¼€å§‹:', data.config.url);
  });

  apiClient.on('request:success', (data) => {
    console.log('âœ… è¯·æ±‚æˆåŠŸ:', data.config.url, data.duration + 'ms');
  });

  apiClient.on('request:error', (error) => {
    console.log('âŒ è¯·æ±‚å¤±è´¥:', error.config?.url, error.message);
  });
}
```

#### æ€§èƒ½ç›‘æ§é¢æ¿
```javascript
// åœ¨é¡µé¢ä¸­æ·»åŠ æ€§èƒ½ç›‘æ§é¢æ¿
Page({
  data: {
    showDebugPanel: __DEV__
  },

  onShow() {
    if (__DEV__) {
      this.updateDebugInfo();
      this.debugTimer = setInterval(() => {
        this.updateDebugInfo();
      }, 5000);
    }
  },

  onHide() {
    if (this.debugTimer) {
      clearInterval(this.debugTimer);
    }
  },

  updateDebugInfo() {
    const debugInfo = {
      api: apiClient.getStats(),
      network: networkMonitor.getCurrentStatus(),
      queue: requestQueue.getStatus()
    };

    this.setData({ debugInfo });
  }
});
```

---

## æ€»ç»“

äº”å¥½ä¼´å­¦å¾®ä¿¡å°ç¨‹åºç½‘ç»œå±‚æ¶æ„æä¾›äº†å®Œæ•´çš„ç½‘ç»œè¯·æ±‚è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š

- **ç»Ÿä¸€çš„APIç®¡ç†**ï¼šæ ‡å‡†åŒ–çš„è¯·æ±‚å¤„ç†æµç¨‹
- **æ™ºèƒ½ç¼“å­˜æœºåˆ¶**ï¼šæå‡åº”ç”¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ
- **å¥å£®çš„é”™è¯¯å¤„ç†**ï¼šå…¨é¢çš„é”™è¯¯æ•è·å’Œæ¢å¤æœºåˆ¶
- **ç½‘ç»œçŠ¶æ€é€‚é…**ï¼šæ ¹æ®ç½‘ç»œæ¡ä»¶æ™ºèƒ½è°ƒæ•´ç­–ç•¥
- **æ€§èƒ½ç›‘æ§ä½“ç³»**ï¼šå…¨æ–¹ä½çš„æ€§èƒ½è·Ÿè¸ªå’Œä¼˜åŒ–

é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›ç»„ä»¶å’Œéµå¾ªæœ€ä½³å®è·µï¼Œå¯ä»¥æ„å»ºå‡ºé«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„å¾®ä¿¡å°ç¨‹åºç½‘ç»œå±‚ã€‚

å¦‚éœ€æ›´å¤šæŠ€æœ¯æ”¯æŒï¼Œè¯·å‚è€ƒé¡¹ç›®æºç æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
