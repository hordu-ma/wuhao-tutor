# æ—¥å¿—ç®¡ç†è¯´æ˜

## ğŸ“‹ æ—¥å¿—ç­–ç•¥

æœ¬é¡¹ç›®é‡‡ç”¨**é›†ä¸­å¼æ—¥å¿—ç®¡ç†**ç­–ç•¥ï¼Œæ‰€æœ‰æ—¥å¿—è¾“å‡ºåº”éµå¾ªä»¥ä¸‹è§„èŒƒã€‚

### æ—¥å¿—è¾“å‡ºä½ç½®

#### å¼€å‘ç¯å¢ƒ

```
å¼€å‘æ—¥å¿—ä½ç½®ï¼š/var/log/wuhao-tutor/
â”œâ”€â”€ app.log              # åº”ç”¨ç¨‹åºæ—¥å¿—
â”œâ”€â”€ access.log           # HTTP è®¿é—®æ—¥å¿—
â”œâ”€â”€ error.log            # é”™è¯¯æ—¥å¿—
â”œâ”€â”€ database.log         # æ•°æ®åº“æ“ä½œæ—¥å¿—
â””â”€â”€ performance.log      # æ€§èƒ½ç›‘æ§æ—¥å¿—
```

#### ç”Ÿäº§ç¯å¢ƒ

```
ç”Ÿäº§æ—¥å¿—ä½ç½®ï¼š/var/log/wuhao-tutor/
â”œâ”€â”€ app.log              # åº”ç”¨ç¨‹åºæ—¥å¿— (rotation)
â”œâ”€â”€ access.log           # HTTP è®¿é—®æ—¥å¿— (rotation)
â”œâ”€â”€ error.log            # é”™è¯¯æ—¥å¿— (rotation)
â””â”€â”€ [å…¶ä»–æ—¥å¿—æ–‡ä»¶]
```

### æ—¥å¿—çº§åˆ«

| çº§åˆ«         | ç”¨é€”     | ç¤ºä¾‹                       |
| ------------ | -------- | -------------------------- |
| **DEBUG**    | å¼€å‘è°ƒè¯• | å˜é‡å€¼ã€æ‰§è¡Œæµ             |
| **INFO**     | é‡è¦äº‹ä»¶ | åº”ç”¨å¯åŠ¨ã€ç”¨æˆ·æ“ä½œ         |
| **WARNING**  | è­¦å‘Šä¿¡æ¯ | å³å°†è¿‡æœŸçš„ tokenã€èµ„æºä¸è¶³ |
| **ERROR**    | é”™è¯¯ä¿¡æ¯ | æ•°æ®åº“è¿æ¥å¤±è´¥ã€API é”™è¯¯   |
| **CRITICAL** | ä¸¥é‡é”™è¯¯ | ç³»ç»Ÿå´©æºƒã€å®‰å…¨æ¼æ´         |

### æ—¥å¿—é…ç½®

åœ¨ `src/core/logging.py` ä¸­é…ç½®æ—¥å¿—ï¼š

```python
import logging
from logging.handlers import RotatingFileHandler

# å¼€å‘ç¯å¢ƒï¼šè¾“å‡ºåˆ°æ§åˆ¶å° + æ–‡ä»¶
# ç”Ÿäº§ç¯å¢ƒï¼šè¾“å‡ºåˆ°æ–‡ä»¶ + è¿œç¨‹æ—¥å¿—æœåŠ¡

logger = logging.getLogger(__name__)
```

---

## ğŸ”„ æ—¥å¿—è½®è½¬

**æ—¥å¿—è½®è½¬é…ç½®**ï¼ˆé˜²æ­¢æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼‰ï¼š

```
æœ€å¤§å•ä¸ªæ—¥å¿—æ–‡ä»¶ï¼š100 MB
å¤‡ä»½æ–‡ä»¶æ•°é‡ï¼š10 ä¸ª
å‹ç¼©æ–¹å¼ï¼šgzip
ä¿ç•™æ—¶é—´ï¼š30 å¤©ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```

### æ—¥å¿—æ¸…ç†

```bash
# æŸ¥çœ‹æ—¥å¿—å¤§å°
du -sh /var/log/wuhao-tutor/

# æ¸…ç†æ—§æ—¥å¿—
find /var/log/wuhao-tutor/ -name "*.log.*" -mtime +30 -delete

# æ‰‹åŠ¨å‹ç¼©
gzip /var/log/wuhao-tutor/app.log
```

---

## ğŸ“ æ—¥å¿—æ ¼å¼

æ ‡å‡†æ—¥å¿—æ ¼å¼ï¼ˆJSON æ ¼å¼ä¾¿äºè§£æï¼‰ï¼š

```json
{
  "timestamp": "2025-11-13T10:30:45.123Z",
  "level": "INFO",
  "logger": "src.services.learning_service",
  "message": "Question answered successfully",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "duration_ms": 245,
  "trace_id": "abc123def456"
}
```

---

## ğŸ› ï¸ Makefile ä¸­çš„æ—¥å¿—

é¡¹ç›® Makefile ä¸åº”äº§ç”Ÿæ—¥å¿—æ–‡ä»¶åœ¨æ ¹ç›®å½•ï¼Œæ—¥å¿—åº”ï¼š

```bash
# âŒ é”™è¯¯
make dev > backend.log 2>&1

# âœ… æ­£ç¡®
make dev
# æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œç”±è¿è¡Œç¯å¢ƒå†³å®šæ˜¯å¦é‡å®šå‘
```

---

## ğŸ“Š æ—¥å¿—ç›‘æ§

### å…³é”®æ—¥å¿—æŒ‡æ ‡

ç›‘æ§ä»¥ä¸‹æ—¥å¿—ï¼š

1. **é”™è¯¯ç‡**ï¼šERROR å’Œ CRITICAL æ—¥å¿—æ•°é‡/å°æ—¶
2. **æ€§èƒ½æ—¥å¿—**ï¼šå“åº”æ—¶é—´ > 1000ms çš„è¯·æ±‚
3. **è®¿é—®æ—¥å¿—**ï¼šHTTP è¯·æ±‚çš„çŠ¶æ€ç åˆ†å¸ƒ
4. **æ•°æ®åº“æ—¥å¿—**ï¼šæ…¢æŸ¥è¯¢ï¼ˆ>1 ç§’ï¼‰

### å‘Šè­¦æ¡ä»¶

| æ¡ä»¶                       | å‘Šè­¦çº§åˆ«    | åŠ¨ä½œ     |
| -------------------------- | ----------- | -------- |
| 5 åˆ†é’Ÿå†… ERROR æ¬¡æ•° > 10   | ğŸŸ¡ Warning  | å‘é€é€šçŸ¥ |
| 5 åˆ†é’Ÿå†… CRITICAL æ¬¡æ•° > 1 | ğŸ”´ Critical | ç«‹å³å‘Šè­¦ |
| å“åº”æ—¶é—´ > 5s å‡ºç° 5 æ¬¡    | ğŸŸ¡ Warning  | å‘é€é€šçŸ¥ |

---

## ğŸ” æ—¥å¿—æŸ¥çœ‹å’Œåˆ†æ

### æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/log/wuhao-tutor/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/wuhao-tutor/error.log

# æŸ¥çœ‹æœ€å 100 è¡Œ
tail -100 /var/log/wuhao-tutor/app.log
```

### æœç´¢æ—¥å¿—

```bash
# æœç´¢ç‰¹å®šç”¨æˆ·çš„æ“ä½œ
grep "user_id=123" /var/log/wuhao-tutor/app.log

# æœç´¢é”™è¯¯
grep "ERROR" /var/log/wuhao-tutor/app.log

# ç»Ÿè®¡é”™è¯¯æ•°é‡
grep "ERROR" /var/log/wuhao-tutor/app.log | wc -l

# æŸ¥çœ‹é”™è¯¯åˆ†å¸ƒ
grep "ERROR" /var/log/wuhao-tutor/app.log | awk '{print $NF}' | sort | uniq -c
```

### æ—¥å¿—åˆ†æå·¥å…·

å»ºè®®ä½¿ç”¨ï¼š

- **ELK Stack**ï¼šElasticsearch + Logstash + Kibana
- **Splunk**ï¼šä¼ä¸šçº§æ—¥å¿—åˆ†æ
- **Datadog**ï¼šäº‘ç«¯æ—¥å¿—èšåˆ
- **CloudWatch**ï¼šAWS æ—¥å¿—æœåŠ¡

---

## ğŸ“ æœ€ä½³å®è·µ

- âœ… åŒ…å«å…³é”®ä¸Šä¸‹æ–‡ï¼ˆç”¨æˆ· IDã€è¯·æ±‚ IDï¼‰
- âœ… ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—ï¼ˆJSON æ ¼å¼ï¼‰
- âœ… å®šæœŸè½®è½¬å’Œæ¸…ç†æ—¥å¿—
- âœ… ç›‘æ§å…³é”®é”™è¯¯å’Œæ€§èƒ½æŒ‡æ ‡
- âŒ ä¸è¦è®°å½•æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€Tokenï¼‰
- âŒ ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ DEBUG çº§åˆ«
- ğŸ“Š å®šæœŸåˆ†ææ—¥å¿—æ‰¾å‡ºé—®é¢˜

---

## ğŸš€ å¿«é€Ÿå‘½ä»¤

```bash
# æŸ¥çœ‹æ—¥å¿—é…ç½®
cat src/core/logging.py

# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
ls -lh /var/log/wuhao-tutor/

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /var/log/

# æ¸…ç†æ—§æ—¥å¿—
./scripts/clean-logs.sh

# æŸ¥çœ‹æ—¥å¿—ç»Ÿè®¡
cat /var/log/wuhao-tutor/app.log | wc -l
```

---

**æ›´æ–°**ï¼š2025-11-13

**ç›¸å…³æ–‡ä»¶**ï¼š

- `src/core/logging.py` - æ—¥å¿—é…ç½®
- `.env.example` - æ—¥å¿—çº§åˆ«é…ç½®
- `monitoring/` - ç›‘æ§å’Œå‘Šè­¦
