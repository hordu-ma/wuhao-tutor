<!--components/homework-card/index.wxml-->
<view class="homework-card {{homework.status}}"
      bindtap="onCardTap"
      data-homework="{{homework}}">

  <!-- 卡片头部 -->
  <view class="card-header">
    <view class="subject-info">
      <view class="subject-tag" data-subject="{{homework.subject}}">
        {{homework.subject}}
      </view>
      <view class="difficulty-tag {{homework.difficulty}}">
        <van-icon name="{{getDifficultyIcon(homework.difficulty)}}" size="12" />
        <text>{{getDifficultyText(homework.difficulty)}}</text>
      </view>
    </view>

    <view class="status-info">
      <view class="status-tag {{homework.status}}">
        {{getStatusText(homework.status)}}
      </view>
      <view class="priority-indicator" wx:if="{{homework.priority === 'high'}}">
        <van-icon name="fire" size="14" color="#ff4d4f" />
      </view>
    </view>
  </view>

  <!-- 卡片内容 -->
  <view class="card-content">
    <view class="homework-title">
      {{homework.title}}
    </view>

    <view class="homework-description" wx:if="{{homework.description}}">
      {{homework.description}}
    </view>

    <!-- 题目预览 -->
    <view class="questions-preview" wx:if="{{homework.questions && homework.questions.length > 0}}">
      <view class="question-count">
        <van-icon name="edit" size="14" />
        <text>共 {{homework.questions.length}} 题</text>
      </view>
      <view class="question-types">
        <view class="type-item"
              wx:for="{{homework.questionTypes}}"
              wx:key="*this">
          {{item}}
        </view>
      </view>
    </view>

    <!-- 附件信息 -->
    <view class="attachments" wx:if="{{homework.attachments && homework.attachments.length > 0}}">
      <van-icon name="attachment" size="14" />
      <text>{{homework.attachments.length}} 个附件</text>
    </view>
  </view>

  <!-- 时间信息 -->
  <view class="time-info">
    <view class="create-time">
      <van-icon name="clock-o" size="12" />
      <text>发布：{{formatTime(homework.createTime)}}</text>
    </view>

    <view class="deadline {{getDeadlineStatus(homework.deadline)}}">
      <van-icon name="{{getDeadlineIcon(homework.deadline)}}" size="12" />
      <text>截止：{{formatTime(homework.deadline)}}</text>
    </view>
  </view>

  <!-- 进度信息 -->
  <view class="progress-info" wx:if="{{homework.status === 'in_progress' || homework.status === 'completed'}}">
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{homework.progress || 0}}%"></view>
    </view>
    <view class="progress-text">
      <text>完成进度：{{homework.progress || 0}}%</text>
      <text wx:if="{{homework.completedQuestions}}">
        ({{homework.completedQuestions}}/{{homework.totalQuestions}})
      </text>
    </view>
  </view>

  <!-- 成绩信息 -->
  <view class="grade-info" wx:if="{{homework.status === 'graded' && homework.grade}}">
    <view class="grade-score">
      <text class="score">{{homework.grade.score}}</text>
      <text class="total">/ {{homework.grade.total}}</text>
    </view>
    <view class="grade-level {{homework.grade.level}}">
      {{getGradeText(homework.grade.level)}}
    </view>
  </view>

  <!-- 操作按钮区域 -->
  <view class="card-actions">
    <!-- 学生操作按钮 -->
    <view class="student-actions" wx:if="{{userRole === 'student'}}">
      <!-- 开始做作业 -->
      <van-button size="small"
                  type="primary"
                  wx:if="{{homework.status === 'pending'}}"
                  bindtap="onStartHomework"
                  data-homework="{{homework}}">
        开始做题
      </van-button>

      <!-- 继续做作业 -->
      <van-button size="small"
                  type="info"
                  wx:if="{{homework.status === 'in_progress'}}"
                  bindtap="onContinueHomework"
                  data-homework="{{homework}}">
        继续完成
      </van-button>

      <!-- 查看结果 -->
      <van-button size="small"
                  plain
                  wx:if="{{homework.status === 'completed' || homework.status === 'graded'}}"
                  bindtap="onViewResult"
                  data-homework="{{homework}}">
        查看结果
      </van-button>

      <!-- 重做作业 -->
      <van-button size="small"
                  plain
                  wx:if="{{homework.allowRetry && homework.status === 'graded'}}"
                  bindtap="onRetryHomework"
                  data-homework="{{homework}}">
        重新作答
      </van-button>
    </view>

    <!-- 教师操作按钮 -->
    <view class="teacher-actions" wx:if="{{userRole === 'teacher'}}">
      <!-- 查看详情 -->
      <van-button size="small"
                  plain
                  bindtap="onViewDetail"
                  data-homework="{{homework}}">
        查看详情
      </van-button>

      <!-- 批改作业 -->
      <van-button size="small"
                  type="warning"
                  wx:if="{{homework.status === 'submitted'}}"
                  bindtap="onGradeHomework"
                  data-homework="{{homework}}">
        批改作业
      </van-button>

      <!-- 查看统计 -->
      <van-button size="small"
                  type="info"
                  bindtap="onViewStatistics"
                  data-homework="{{homework}}">
        查看统计
      </van-button>

      <!-- 更多操作 -->
      <van-button size="small"
                  plain
                  bindtap="onMoreActions"
                  data-homework="{{homework}}">
        更多
      </van-button>
    </view>

    <!-- 家长操作按钮 -->
    <view class="parent-actions" wx:if="{{userRole === 'parent'}}">
      <!-- 查看详情 -->
      <van-button size="small"
                  plain
                  bindtap="onViewDetail"
                  data-homework="{{homework}}">
        查看详情
      </van-button>

      <!-- 查看孩子完成情况 -->
      <van-button size="small"
                  type="info"
                  bindtap="onViewChildProgress"
                  data-homework="{{homework}}">
        完成情况
      </van-button>
    </view>
  </view>

  <!-- 提交状态指示器 -->
  <view class="submit-indicator" wx:if="{{homework.isSubmitting}}">
    <van-loading size="14" />
    <text>提交中...</text>
  </view>

  <!-- 收藏按钮 -->
  <view class="favorite-btn"
        bindtap="onToggleFavorite"
        data-homework="{{homework}}">
    <van-icon name="{{homework.isFavorite ? 'star' : 'star-o'}}"
              size="16"
              color="{{homework.isFavorite ? '#ffd700' : '#ccc'}}" />
  </view>

  <!-- 新作业标识 -->
  <view class="new-badge" wx:if="{{homework.isNew}}">
    <text>新</text>
  </view>

  <!-- 逾期标识 -->
  <view class="overdue-badge" wx:if="{{homework.isOverdue}}">
    <van-icon name="warning-o" size="12" />
    <text>已逾期</text>
  </view>

  <!-- AI推荐标识 -->
  <view class="ai-recommended" wx:if="{{homework.isAIRecommended}}">
    <van-icon name="lightning-o" size="12" />
    <text>AI推荐</text>
  </view>
</view>
