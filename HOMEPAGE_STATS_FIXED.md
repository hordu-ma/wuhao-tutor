# é˜¶æ®µ 2 å®Œæˆï¼šç”¨æˆ·ç»Ÿè®¡æ•°æ®ä¿®å¤

**å®Œæˆæ—¶é—´**: 2025-11-05  
**ä¿®å¤å†…å®¹**: å¯¹æ¥åç«¯çœŸå® APIï¼Œæ˜¾ç¤ºç”¨æˆ·çœŸå®ç»Ÿè®¡æ•°æ®

---

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. **API æ¥å£æ·»åŠ ** - `miniprogram/utils/api.js`

åœ¨ `analysis` æ¨¡å—ä¸­æ–°å¢ç”¨æˆ·ç»Ÿè®¡æ¥å£ï¼š

```javascript
analysis: {
  // è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ® (æ–°å¢)
  getUserStats: () =>
    apiClient.get('/analytics/user/stats', {}, {
      enableCache: true,
      cache: { ttl: 5 * 60 * 1000, tags: ['analytics', 'user-stats'] },
    }),
  // ... å…¶ä»–ç°æœ‰æ¥å£
}
```

**ç‰¹æ€§**:

- âœ… ç¼“å­˜ 5 åˆ†é’Ÿï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ›
- âœ… æ ‡ç­¾åŒ–ç¼“å­˜ï¼Œå¯æŒ‰éœ€æ¸…é™¤
- âœ… è‡ªåŠ¨ Token è®¤è¯

---

### 2. **é¦–é¡µæ•°æ®åŠ è½½é€»è¾‘** - `miniprogram/pages/index/index.js`

ä¿®æ”¹ `loadUserStats()` æ–¹æ³•ï¼š

**ä¹‹å‰ï¼ˆMock æ•°æ®ï¼‰**:

```javascript
const stats = {
  questionCount: 23, // ç¡¬ç¼–ç 
  reportCount: 3, // ç¡¬ç¼–ç 
  todayStudyTime: 0,
}
```

**ç°åœ¨ï¼ˆçœŸå® APIï¼‰**:

```javascript
const api = require('../../utils/api.js')
const response = await api.analysis.getUserStats()

if (response && response.success && response.data) {
  const backendData = response.data
  const stats = {
    questionCount: backendData.question_count || 0,
    reportCount: backendData.homework_count || 0,
    todayStudyTime: backendData.study_hours || 0,
  }
  this.setData({ stats })
}
```

**å­—æ®µæ˜ å°„å…³ç³»**:
| å‰ç«¯å­—æ®µ | åç«¯å­—æ®µ | è¯´æ˜ |
|---------|---------|------|
| `questionCount` | `question_count` | æé—®æ€»æ•° |
| `reportCount` | `homework_count` | ä½œä¸šæ€»æ•° |
| `todayStudyTime` | `study_hours` | å­¦ä¹ æ—¶é•¿ï¼ˆå°æ—¶ï¼‰ |

**é”™è¯¯å¤„ç†**:

- âœ… API è°ƒç”¨å¤±è´¥æ—¶æ˜¾ç¤º 0ï¼Œé¿å…å‡æ•°æ®
- âœ… é™çº§ç­–ç•¥ï¼šç½‘ç»œå¼‚å¸¸æ—¶ä¸æ‰“æ–­ç”¨æˆ·
- âœ… è¯¦ç»†æ—¥å¿—è®°å½•ï¼Œæ–¹ä¾¿è°ƒè¯•

---

### 3. **UI æ˜¾ç¤ºä¼˜åŒ–** - `miniprogram/pages/index/index.wxml`

ä¼˜åŒ–"ä»Šæ—¥å­¦ä¹ "ç»Ÿè®¡é¡¹çš„æ˜¾ç¤ºé€»è¾‘ï¼š

**ä¹‹å‰**:

```xml
<text class="stat-placeholder">å¾…å¼€å§‹</text>
<text class="stat-label">ä»Šæ—¥å­¦ä¹ </text>
```

**ç°åœ¨**:

```xml
<!-- æœ‰å­¦ä¹ æ—¶é•¿æ—¶æ˜¾ç¤ºæ•°å­— -->
<text class="stat-number" wx:if="{{stats.todayStudyTime > 0}}">
  {{stats.todayStudyTime}}
</text>
<!-- æ— å­¦ä¹ æ—¶é•¿æ—¶æ˜¾ç¤º"å¾…å¼€å§‹" -->
<text class="stat-placeholder" wx:else>å¾…å¼€å§‹</text>
<text class="stat-label">ä»Šæ—¥å­¦ä¹ (å°æ—¶)</text>
```

**æ”¹è¿›**:

- âœ… åŠ¨æ€æ˜¾ç¤ºï¼šæœ‰æ•°æ®æ—¶æ˜¾ç¤ºå…·ä½“å°æ—¶æ•°
- âœ… å ä½æ–‡æœ¬ï¼šæ— æ•°æ®æ—¶æ˜¾ç¤º"å¾…å¼€å§‹"
- âœ… å•ä½è¯´æ˜ï¼šæ ‡ç­¾æ”¹ä¸º"ä»Šæ—¥å­¦ä¹ (å°æ—¶)"

---

## ğŸ“Š åç«¯ API è¯¦æƒ…

### ç«¯ç‚¹ä¿¡æ¯

- **URL**: `GET /api/v1/analytics/user/stats`
- **è®¤è¯**: éœ€è¦ Bearer Token
- **æ–‡ä»¶**: `src/api/v1/endpoints/analytics.py:78-118`

### è¿”å›æ•°æ®ç»“æ„

```json
{
  "success": true,
  "data": {
    "join_date": "2025-01-01",
    "last_login": "2025-11-05T10:30:00",
    "homework_count": 15, // ä½œä¸šæ€»æ•°
    "question_count": 45, // æé—®æ€»æ•°
    "study_days": 30, // å­¦ä¹ å¤©æ•°
    "avg_score": 85.5, // å¹³å‡åˆ†
    "error_count": 12, // é”™é¢˜æ•°
    "study_hours": 25.5 // å­¦ä¹ æ—¶é•¿(å°æ—¶)
  },
  "message": "è·å–ç”¨æˆ·ç»Ÿè®¡æˆåŠŸ"
}
```

### å½“å‰ä½¿ç”¨å­—æ®µ

- âœ… `question_count` â†’ ä»Šæ—¥é—®ç­”
- âœ… `homework_count` â†’ å­¦ä¹ æŠ¥å‘Š
- âœ… `study_hours` â†’ ä»Šæ—¥å­¦ä¹ 

### æœªä½¿ç”¨å­—æ®µï¼ˆå¯æ‰©å±•ï¼‰

- â¸ï¸ `study_days` - å­¦ä¹ å¤©æ•°
- â¸ï¸ `avg_score` - å¹³å‡åˆ†
- â¸ï¸ `error_count` - é”™é¢˜æ•°
- â¸ï¸ `join_date` - æ³¨å†Œæ—¥æœŸ
- â¸ï¸ `last_login` - æœ€åç™»å½•

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### æµ‹è¯•åœºæ™¯ 1: æ­£å¸¸æ•°æ®æ˜¾ç¤º

**æ“ä½œæ­¥éª¤**:

1. æ‰“å¼€å°ç¨‹åºé¦–é¡µ
2. è§‚å¯Ÿé¡¶éƒ¨ç»Ÿè®¡åŒºåŸŸ

**é¢„æœŸç»“æœ**:

- âœ… "ä»Šæ—¥é—®ç­”"æ˜¾ç¤ºçœŸå®æ•°å­—ï¼ˆæ¥è‡ªåç«¯ï¼‰
- âœ… "å­¦ä¹ æŠ¥å‘Š"æ˜¾ç¤ºçœŸå®æ•°å­—ï¼ˆæ¥è‡ªåç«¯ï¼‰
- âœ… "ä»Šæ—¥å­¦ä¹ "æ˜¾ç¤ºå°æ—¶æ•°æˆ–"å¾…å¼€å§‹"

**éªŒè¯æ–¹å¼**:

- æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—ï¼š`ğŸ“Š [ç»Ÿè®¡æ•°æ®] APIå“åº”:`
- æ•°æ®åº”ä¸åç«¯æ•°æ®åº“ä¸€è‡´

---

### æµ‹è¯•åœºæ™¯ 2: ç½‘ç»œå¼‚å¸¸å¤„ç†

**æ“ä½œæ­¥éª¤**:

1. å…³é—­ç½‘ç»œæˆ–åç«¯æœåŠ¡
2. æ‰“å¼€é¦–é¡µæˆ–ä¸‹æ‹‰åˆ·æ–°

**é¢„æœŸç»“æœ**:

- âœ… ç»Ÿè®¡æ•°æ®æ˜¾ç¤ºä¸º 0ï¼ˆä¸æ˜¾ç¤ºå‡æ•°æ®ï¼‰
- âœ… é¡µé¢ä¸å´©æºƒï¼Œæ— é”™è¯¯å¼¹çª—
- âœ… æ§åˆ¶å°æœ‰é”™è¯¯æ—¥å¿—ï¼š`âŒ [ç»Ÿè®¡æ•°æ®] åŠ è½½ç”¨æˆ·ç»Ÿè®¡å¤±è´¥`

---

### æµ‹è¯•åœºæ™¯ 3: ç¼“å­˜æœºåˆ¶

**æ“ä½œæ­¥éª¤**:

1. é¦–æ¬¡æ‰“å¼€é¦–é¡µï¼ˆè§‚å¯Ÿç½‘ç»œè¯·æ±‚ï¼‰
2. å…³é—­é¦–é¡µ
3. 5 åˆ†é’Ÿå†…é‡æ–°æ‰“å¼€é¦–é¡µ

**é¢„æœŸç»“æœ**:

- âœ… ç¬¬ 1 æ¬¡ï¼šå‘é€ç½‘ç»œè¯·æ±‚
- âœ… ç¬¬ 2 æ¬¡ï¼šä½¿ç”¨ç¼“å­˜ï¼Œæ— ç½‘ç»œè¯·æ±‚
- âœ… 5 åˆ†é’Ÿåï¼šç¼“å­˜è¿‡æœŸï¼Œé‡æ–°è¯·æ±‚

---

### æµ‹è¯•åœºæ™¯ 4: ä¸‹æ‹‰åˆ·æ–°

**æ“ä½œæ­¥éª¤**:

1. åœ¨é¦–é¡µä¸‹æ‹‰åˆ·æ–°
2. è§‚å¯Ÿç»Ÿè®¡æ•°æ®å˜åŒ–

**é¢„æœŸç»“æœ**:

- âœ… æ˜¾ç¤ºåˆ·æ–°åŠ¨ç”»
- âœ… é‡æ–°è¯·æ±‚ APIï¼ˆå¿½ç•¥ç¼“å­˜ï¼‰
- âœ… æ•°æ®æ›´æ–°ä¸ºæœ€æ–°å€¼
- âœ… æ˜¾ç¤º"åˆ·æ–°æˆåŠŸ"æç¤º

---

### æµ‹è¯•åœºæ™¯ 5: ä¸åŒè§’è‰²æ˜¾ç¤º

**æ“ä½œæ­¥éª¤**:

1. å­¦ç”Ÿè´¦å·ç™»å½•ï¼šåº”æ˜¾ç¤º 3 ä¸ªç»Ÿè®¡é¡¹
2. å®¶é•¿è´¦å·ç™»å½•ï¼šåº”æ˜¾ç¤º 2 ä¸ªç»Ÿè®¡é¡¹ï¼ˆæ— "ä»Šæ—¥é—®ç­”"ï¼‰
3. æ•™å¸ˆè´¦å·ç™»å½•ï¼šåº”æ˜¾ç¤º 2 ä¸ªç»Ÿè®¡é¡¹

**é¢„æœŸç»“æœ**:

- âœ… å­¦ç”Ÿï¼šä»Šæ—¥é—®ç­” + å­¦ä¹ æŠ¥å‘Š + ä»Šæ—¥å­¦ä¹ 
- âœ… å®¶é•¿ï¼šå­¦ä¹ æŠ¥å‘Š + å…¶ä»–ï¼ˆ"ä»Šæ—¥é—®ç­”"éšè—ï¼‰
- âœ… æ•™å¸ˆï¼šå­¦ä¹ æŠ¥å‘Š + å…¶ä»–

---

## ğŸ› å¯èƒ½çš„é—®é¢˜ä¸è§£å†³

### é—®é¢˜ 1: æ•°æ®å§‹ç»ˆä¸º 0

**å¯èƒ½åŸå› **:

- åç«¯æ•°æ®åº“æ— æ•°æ®
- ç”¨æˆ·æœªè¿›è¡Œè¿‡å­¦ä¹ æ´»åŠ¨

**è§£å†³æ–¹å¼**:

- æ­£å¸¸ç°è±¡ï¼Œæ–°ç”¨æˆ·æˆ–æ— æ´»åŠ¨ç”¨æˆ·æ˜¾ç¤º 0
- å¯é€šè¿‡ä½œä¸šæ‰¹æ”¹ã€AI é—®ç­”ç­‰åŠŸèƒ½äº§ç”Ÿæ•°æ®

---

### é—®é¢˜ 2: API è°ƒç”¨å¤±è´¥

**å¯èƒ½åŸå› **:

- Token è¿‡æœŸ
- åç«¯æœåŠ¡æœªå¯åŠ¨
- ç½‘ç»œé—®é¢˜

**æ’æŸ¥æ­¥éª¤**:

1. æ£€æŸ¥æ§åˆ¶å°é”™è¯¯æ—¥å¿—
2. éªŒè¯åç«¯æœåŠ¡è¿è¡ŒçŠ¶æ€ï¼š`https://www.horsduroot.com/api/v1/health`
3. æ£€æŸ¥ Token æ˜¯å¦æœ‰æ•ˆ

---

### é—®é¢˜ 3: ç»Ÿè®¡æ•°æ®ä¸å‡†ç¡®

**å¯èƒ½åŸå› **:

- åç«¯ç»Ÿè®¡é€»è¾‘é—®é¢˜
- æ•°æ®åº“æ•°æ®å¼‚å¸¸

**æ’æŸ¥æ­¥éª¤**:

1. æŸ¥çœ‹åç«¯ API å“åº”åŸå§‹æ•°æ®ï¼ˆæ§åˆ¶å°æ—¥å¿—ï¼‰
2. å¯¹æ¯”æ•°æ®åº“å®é™…è®°å½•
3. æ£€æŸ¥åç«¯ `analytics_service.py` è®¡ç®—é€»è¾‘

---

## ğŸ“ ä»£ç å®¡æŸ¥æ¸…å•

è¯·éªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

- [ ] API æ¥å£è·¯å¾„æ­£ç¡®ï¼š`/analytics/user/stats`
- [ ] å­—æ®µæ˜ å°„æ­£ç¡®ï¼š`question_count` â†’ `questionCount`
- [ ] é”™è¯¯å¤„ç†å®Œå–„ï¼šAPI å¤±è´¥æ—¶ä¸å´©æºƒ
- [ ] ç¼“å­˜é…ç½®åˆç†ï¼š5 åˆ†é’Ÿ TTL
- [ ] æ—¥å¿—è¾“å‡ºæ¸…æ™°ï¼šæˆåŠŸå’Œå¤±è´¥éƒ½æœ‰è®°å½•
- [ ] UI æ¡ä»¶æ¸²æŸ“æ­£ç¡®ï¼š`todayStudyTime > 0` æ—¶æ˜¾ç¤ºæ•°å­—
- [ ] æ— ç¡¬ç¼–ç å‡æ•°æ®

---

## ğŸ¯ ä¸‹ä¸€æ­¥ï¼šé˜¶æ®µ 3

ç¡®è®¤æœ¬é˜¶æ®µæµ‹è¯•é€šè¿‡åï¼Œå°†è¿›å…¥ï¼š

**é˜¶æ®µ 3ï¼šä¿®å¤æ¨èæ¨¡å—**

- å¯¹æ¥åç«¯æ¨è API
- æ˜¾ç¤º 3 æ¡çœŸå®æ¨è
- å¤„ç†æ— æ¨èæ—¶çš„å±•ç¤º

---

## ğŸ“Œ æŠ€æœ¯äº®ç‚¹

1. **ä¼˜é›…é™çº§**: API å¤±è´¥æ—¶æ˜¾ç¤º 0 è€Œéå‡æ•°æ®
2. **æ™ºèƒ½ç¼“å­˜**: 5 åˆ†é’Ÿç¼“å­˜å‡å°‘æœåŠ¡å™¨å‹åŠ›
3. **è¯¦ç»†æ—¥å¿—**: æ–¹ä¾¿çº¿ä¸Šé—®é¢˜æ’æŸ¥
4. **åŠ¨æ€ UI**: æ ¹æ®æ•°æ®åŠ¨æ€æ˜¾ç¤ºå ä½ç¬¦æˆ–å®é™…å€¼
5. **ç±»å‹å®‰å…¨**: æ‰€æœ‰å­—æ®µæä¾›é»˜è®¤å€¼ï¼ˆ`|| 0`ï¼‰

---

**æµ‹è¯•å®Œæˆåè¯·åé¦ˆ**:

- âœ… æ•°æ®æ˜¾ç¤ºæ˜¯å¦æ­£ç¡®
- âœ… æ˜¯å¦æœ‰é”™è¯¯æç¤º
- âœ… æ§åˆ¶å°æ—¥å¿—å†…å®¹

å‡†å¤‡å¥½åå¼€å§‹é˜¶æ®µ 3ï¼ ğŸš€
