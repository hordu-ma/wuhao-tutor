# 变更日志 (Changelog)

本文档记录五好伴学项目的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [Unreleased]

### 计划中
- 微信认证集成
- 知识图谱可视化
- 家长端功能
- 学习报告导出

---

## [0.2.0] - 2025-10-12

### ✨ 新增功能

#### 错题手册（完整实现）
- **错题记录**: 手动添加错题，支持多学科分类
- **智能复习**: 基于艾宾浩斯遗忘曲线的复习提醒
- **今日复习**: 自动生成每日待复习错题清单
- **掌握度跟踪**: 4 级掌握度评估（未掌握、学习中、已掌握、精通）
- **统计分析**: 错题分布、知识点分析、复习效果追踪
- **AI 分析**: 自动分析错因和提供学习建议

#### 微信小程序
- **完整端到端实现**: TabBar 导航、页面路由、API 集成
- **错题本**: 错题列表、详情查看、今日复习
- **作业问答**: AI 学习助手、对话历史
- **学习记录**: 学习时长统计、知识点分析
- **个人中心**: 用户信息、学习统计

#### 学习目标
- **目标设置**: 创建学习目标，设置截止日期
- **进度追踪**: 实时计算完成进度
- **里程碑**: 支持多个里程碑节点

### 🔧 修复

#### 头像上传优化 (2025-10-12)
- 修复 Pinia 响应式更新问题
- 优化 Nginx location 配置优先级
- 添加文件类型和大小验证
- 改进错误提示用户体验

#### 移动端兼容性 (2025-10-13)
- 修复移动浏览器图片上传超时问题
- 解决 iOS Safari 缓存导致的白屏问题
- 优化移动端触摸事件响应
- 修复图片预览在移动端的显示问题

#### 枚举类型序列化 (2025-10-11)
- 修复 SQLAlchemy Enum 返回对象而非字符串
- 统一 API 响应中的枚举值格式
- 更新所有 Pydantic 模型的枚举字段

#### 微信小程序字体加载 (2025-10-XX)
- 修复 Vant Weapp 图标字体 404 错误
- 配置正确的字体文件路径
- 优化字体加载性能

### 📝 文档

#### 文档重组 (2025-10-12)
- **重写 API 文档**: `docs/api/models.md` 和 `docs/api/errors.md`
- **更新文档中心**: 添加角色导航和学习路径
- **归档历史文档**: 移动临时文档到 `docs/archive/`
- **创建更新摘要**: 详细的文档变更报告

#### 新增文档
- 错题手册数据库设计文档
- 移动端兼容性实现指南
- 图片识别解决方案文档

### 🏗️ 架构优化

#### 数据库
- 新增 `mistake_records` 表：错题记录
- 新增 `mistake_reviews` 表：复习记录
- 新增 `learning_goals` 表：学习目标
- 优化索引：提升查询性能

#### API 端点
- 新增错题模块：7 个端点（CRUD + 统计 + 今日复习）
- 新增学习目标模块：6 个端点
- 优化学习模块：支持多模态输入（文本 + 图片）

#### 性能优化
- 实现 N+1 查询检测和优化
- 添加慢查询监听（>1s 记录）
- 优化文件上传性能（分块上传）

### 🔒 安全性

- 完善 JWT 双 Token 机制（Access + Refresh）
- 增强限流策略：IP、用户、AI 服务多维度
- 添加安全响应头配置
- 优化密码强度验证

### 🚀 部署

#### 生产环境
- 部署地址：https://121.199.173.244
- 数据库：PostgreSQL 16
- 缓存：Redis 7.x
- Web 服务器：Nginx + Systemd

#### 配置优化
- 精简环境变量配置文件（10→2）
- 统一密钥管理策略
- 优化 Nginx 反向代理配置

---

## [0.1.0] - 2025-09-29

### ✨ 初始功能

#### 作业问答
- AI 驱动的学习助手
- 支持多轮对话
- 实时流式响应
- Markdown 渲染 + 代码高亮

#### 学习进度
- 学习时长统计
- 知识点掌握度分析
- 学科分布统计
- 学习趋势可视化

#### 用户管理
- 手机号注册登录
- JWT 认证
- 用户信息管理
- 角色权限控制

#### 技术架构
- **后端**: FastAPI + SQLAlchemy 2.x + Pydantic v2
- **前端**: Vue3 + TypeScript + Vite + Pinia
- **AI**: 阿里云百炼智能体
- **数据库**: SQLite (开发) / PostgreSQL (生产)

---

## 版本说明

### 版本号规则
- **主版本号（Major）**: 不兼容的 API 变更
- **次版本号（Minor）**: 向下兼容的功能新增
- **修订号（Patch）**: 向下兼容的问题修复

### 变更类型
- `新增` - 新功能
- `修复` - Bug 修复
- `变更` - 现有功能的变更
- `弃用` - 即将移除的功能
- `移除` - 已移除的功能
- `安全` - 安全性修复

---

## 贡献指南

提交变更时，请在对应版本下添加条目：

1. 按类型分组（新增/修复/变更等）
2. 使用清晰的描述
3. 包含 Issue/PR 链接（如果有）
4. 标注破坏性变更（如果有）

示例：
```markdown
### 新增
- **功能名称**: 功能描述 (#PR号)
```

---

**维护者**: 五好伴学开发团队
**最后更新**: 2025-10-12
