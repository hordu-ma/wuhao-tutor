# 五好伴学 - 开发路线图

> **版本**: v1.1  
> **创建日期**: 2025-10-12  
> **最后更新**: 2025-10-12  
> **适用阶段**: 当前至未来 12 个月  
> **⚡ 重要调整**: 优先实现基础推荐系统,RAG 作为后续增强项

---

## 📋 总体规划

### 当前状态 (2025-10)

**已完成的核心功能**:

- ✅ 作业问答 - AI 驱动的学习助手 (含 MCP 上下文服务)
- ✅ 学习进度 - 数据分析和可视化
- ✅ 个人中心 - 用户管理和配置
- ✅ MCP 上下文服务 - 个性化学情分析 (薄弱知识点、学习偏好)
- ✅ 生产环境部署 - systemd + Nginx + HTTPS

**技术债务状态**: 低 (已完成代码重构和性能优化)

### 🔄 开发策略调整说明

**为什么调整 Phase 顺序？**

- ✅ **快速验证价值**: 2-3 个月内用户就能看到推荐功能
- ✅ **降低技术风险**: 基础推荐技术成熟,RAG 是锦上添花
- ✅ **数据驱动**: 先积累用户行为数据,为 RAG 提供高质量训练语料
- ✅ **渐进式升级**: 基础推荐(60%) → RAG 增强(80%),用户能明显感知提升

**调整前后对比**:

```
原计划: Phase 1 错题手册 → Phase 2 RAG → ... → Phase 5 智能推荐
调整后: Phase 1 错题手册 → Phase 2 基础推荐 → ... → Phase 5 RAG增强
```

---

## 🎯 Phase 1: 错题手册功能完善 (当前)

**时间规划**: 2025-10 ~ 2025-11 (4 周)  
**优先级**: 🔥 最高

### 1.1 核心功能实现

#### 1.1.1 MistakeService 业务逻辑 (Week 1-2)

- [ ] 实现错题记录的 CRUD 操作
- [ ] 设计遗忘曲线算法,计算复习时间
- [ ] 实现智能复习计划生成逻辑
- [ ] 集成知识图谱,分析知识点关联
- [ ] 编写完整的单元测试 (覆盖率 >80%)

**关键算法**:

```python
# 艾宾浩斯遗忘曲线复习间隔
review_intervals = [1, 2, 4, 7, 15, 30]  # 天数

# 知识点掌握度计算
mastery_score = (correct_count / total_count) * time_decay_factor
```

#### 1.1.2 数据库迁移 (Week 1)

- [ ] 设计 `mistake_records` 表结构
  - 字段: id, user_id, question_content, correct_answer, user_answer, subject, knowledge_points, difficulty, created_at
- [ ] 设计 `mistake_reviews` 表结构
  - 字段: id, mistake_id, review_date, review_result, mastery_level, next_review_date
- [ ] 创建 Alembic 迁移脚本
- [ ] 添加索引优化查询性能
  - `(user_id, next_review_date)` 复合索引
  - `(knowledge_points)` GIN 索引 (PostgreSQL)

#### 1.1.3 前后端集成 (Week 2-3)

- [ ] 连接前端组件到真实 API
- [ ] 实现错题列表分页和筛选
- [ ] 完成今日复习功能
- [ ] 添加错题统计图表 (ECharts)
- [ ] 优化加载性能和用户体验

#### 1.1.4 测试和优化 (Week 4)

- [ ] 端到端集成测试
- [ ] 性能基准测试 (查询 <100ms)
- [ ] 用户体验优化
- [ ] 生产环境部署

**验收标准**:

- 用户可以手动添加错题记录
- 系统自动生成今日复习清单
- 复习完成后更新掌握度
- 错题统计图表正确展示

---

## 🤖 Phase 2: 基础智能推荐系统 (Q4 2025 - Q1 2026)

**时间规划**: 2025-11 ~ 2026-01 (8 周)  
**优先级**: 🔥 高  
**目标**: 基于协同过滤和规则的推荐系统,准确率 60-70%

### 核心策略说明

**为什么不依赖 RAG？**

- ✅ 协同过滤基于用户行为,不需要语义检索
- ✅ 规则推荐基于知识点标签,已有 MCP 数据支持
- ✅ 可以快速上线,验证推荐系统价值
- 📍 Phase 5 引入 RAG 后,升级为混合推荐策略

### 2.1 协同过滤推荐引擎 (Week 1-3)

**核心算法**: Item-Based Collaborative Filtering

```python
class CollaborativeFilteringEngine:
    """基于物品的协同过滤推荐"""

    async def recommend_exercises(self, user_id: UUID) -> List[Exercise]:
        # 1. 获取用户已完成练习
        user_exercises = await self.get_user_exercises(user_id)

        # 2. 找相似用户 (做过相同练习的用户)
        similar_users = await self.find_similar_users(user_exercises)

        # 3. 统计候选练习并排序
        candidates = await self.get_candidates(similar_users)
        return await self.rank_by_score(candidates)
```

**实现任务**:

- [ ] 构建用户-练习交互矩阵
- [ ] 实现相似度计算 (Cosine Similarity)
- [ ] 优化查询性能 (缓存热门推荐)
- [ ] 冷启动处理 (新用户推荐热门内容)

### 2.2 基于规则的推荐引擎 (Week 3-4)

**利用现有 MCP 数据**: 薄弱知识点、学习偏好

```python
class RuleBasedRecommender:
    async def recommend_by_weak_points(self, user_id: UUID):
        # 1. 获取薄弱知识点 (MCP 服务)
        weak_points = await self.mcp_service.get_weak_points(user_id)

        # 2. 关键词匹配练习
        exercises = await self.exercise_repo.find_by_tags(
            tags=weak_points, difficulty='medium'
        )
        return exercises
```

**实现任务**:

- [ ] 整合 MCP 上下文服务
- [ ] 设计推荐规则集
- [ ] 实现多维度评分
- [ ] 添加推荐解释功能

### 2.3 混合推荐策略 (Week 5-6)

**权重配置**: 协同过滤 50% + 规则推荐 30% + 热门推荐 20%

**实现任务**:

- [ ] 实现加权融合算法
- [ ] 推荐去重和多样性控制
- [ ] A/B 测试不同权重
- [ ] 监控点击率和转化率

### 2.4 推荐 API 和前端集成 (Week 7-8)

**新增 API**:

- `GET /api/v1/recommendations/exercises` - 练习推荐
- `GET /api/v1/recommendations/questions` - 问题推荐
- `POST /api/v1/recommendations/feedback` - 推荐反馈

**验收标准**:

- 推荐准确率 60-70%
- 推荐点击率 >15%
- API 响应时间 <200ms

---

## 📊 Phase 3: 知识图谱可视化 (Q1 2026)

**时间规划**: 2026-01 ~ 2026-02 (6 周)  
**优先级**: 🟡 中

### 3.1 知识图谱数据扩展

- [ ] 扩展知识图谱覆盖范围
  - 七年级: 数学、语文、英语
  - 八年级: 数学、物理
- [ ] 设计知识点关系类型
  - 前置关系 (prerequisite)
  - 扩展关系 (extension)
  - 应用关系 (application)
- [ ] 导入知识图谱数据 (Neo4j 或 PostgreSQL JSON)

### 3.2 图谱查询 API

- [ ] 实现知识点路径查询
- [ ] 实现薄弱知识点前置依赖分析
- [ ] 设计学习路径推荐算法
- [ ] 优化图查询性能

### 3.3 前端可视化

- [ ] 集成 ECharts Graph 或 AntV G6
- [ ] 实现知识图谱交互式展示
- [ ] 突出显示用户薄弱知识点
- [ ] 展示推荐学习路径

---

## 📱 Phase 4: 微信小程序开发 (Q1-Q2 2026)

**时间规划**: 2026-02 ~ 2026-04 (10 周)  
**优先级**: 🟡 中

### 4.1 小程序基础架构 (Week 1-2)

- [ ] 小程序项目初始化
- [ ] 设计小程序页面结构
  - 首页 (Dashboard)
  - 作业问答
  - 错题手册
  - 学习进度
  - 个人中心
- [ ] 实现微信登录和用户绑定
- [ ] 配置小程序网络请求层

### 4.2 核心功能开发 (Week 3-8)

- [ ] 作业问答页面 (支持语音输入)
- [ ] 错题手册页面 (支持拍照识别)
- [ ] 学习进度页面 (图表展示)
- [ ] 消息推送 (复习提醒)
- [ ] 离线缓存 (本地存储)

### 4.3 测试和发布 (Week 9-10)

- [ ] 真机测试
- [ ] 性能优化 (包大小、加载速度)
- [ ] 提交微信审核
- [ ] 正式发布

---

## 🚀 Phase 5: RAG 语义增强 (Q2-Q3 2026)

**时间规划**: 2026-04 ~ 2026-06 (8 周)  
**优先级**: 🟢 中  
**目标**: 升级推荐系统和问答系统,准确率提升到 80%+

### 核心价值说明

**RAG 带来的提升**:

- 📈 推荐准确率: 60% → 80% (+20%)
- 📈 问答质量: 检索相似历史问题,答案更精准
- 📈 错题关联: 发现语义相似但标签不同的错题

**为什么在这个阶段？**

- ✅ 已有大量用户数据 (Phase 2-4 积累)
- ✅ 已验证推荐系统价值,值得投入优化
- ✅ 用户能明显感知到升级效果

### 5.1 向量数据库集成 (Week 1-2)

```sql
-- 安装 PGVector 扩展
CREATE EXTENSION vector;

-- 创建向量表
CREATE TABLE question_embeddings (
    id UUID PRIMARY KEY,
    question_id UUID REFERENCES learning_questions(id),
    embedding vector(1536),
    created_at TIMESTAMP
);

CREATE INDEX ON question_embeddings
USING ivfflat (embedding vector_cosine_ops);
```

### 5.2 Embedding 服务 (Week 2-3)

- [ ] 集成阿里云百炼 Embedding API
- [ ] 实现 Embedding 缓存策略 (Redis)
- [ ] 批量生成异步队列
- [ ] 历史数据 Embedding 迁移

### 5.3 语义检索实现 (Week 4-5)

- [ ] 向量相似度检索
- [ ] 混合检索 (向量 + 关键词)
- [ ] Reranking 重排序
- [ ] 性能优化 (<200ms)

### 5.4 升级推荐系统 (Week 6-7)

**新的混合策略**: 协同过滤 40% + 规则 20% + RAG 语义 40%

```python
class EnhancedRecommendationService:
    def __init__(
        self,
        cf_engine,
        rule_engine,
        rag_engine  # 新增 RAG 推荐
    ):
        self.rag_engine = rag_engine
```

### 5.5 增强问答和错题 (Week 8)

- [ ] 问答系统集成语义检索
- [ ] 错题相似度分析升级
- [ ] A/B 测试效果验证

**验收标准**:

- 语义检索准确率 >80%
- 推荐准确率提升到 75-80%
- 用户满意度提升 >20%

---

## 👥 Phase 6: 协作学习功能 (Q3-Q4 2026)

**时间规划**: 2026-07 ~ 2026-09 (12 周)  
**优先级**: 🟢 低

### 6.1 学习小组

- [ ] 创建/加入学习小组
- [ ] 小组内问题分享
- [ ] 小组学习排行榜
- [ ] 小组学习目标设定

### 6.2 互助答疑

- [ ] 用户之间互相提问
- [ ] 问题悬赏系统
- [ ] 答案投票和采纳
- [ ] 贡献积分系统

---

## 🎓 Phase 7: 教师管理端 (Q4 2026 - Q1 2027)

**时间规划**: 2026-10 ~ 2027-01 (16 周)  
**优先级**: 🟢 低

### 7.1 教师功能

- [ ] 班级管理 (创建、编辑、学生管理)
- [ ] 作业布置和批改
- [ ] 学情分析看板
- [ ] 学生学习报告生成

### 7.2 家长功能

- [ ] 学生学习进度查看
- [ ] 每周学习报告接收
- [ ] 学习提醒设置

---

## 🔧 技术优化 (持续进行)

### 性能优化

- [ ] 数据库查询优化 (索引、慢查询)
- [ ] API 响应时间优化 (缓存、异步)
- [ ] 前端加载速度优化 (Code Splitting、懒加载)
- [ ] CDN 静态资源加速

### 安全加固

- [ ] API 速率限制增强
- [ ] SQL 注入防护审计
- [ ] XSS/CSRF 防护加强
- [ ] 敏感数据加密存储

### 监控和运维

- [ ] Prometheus + Grafana 监控看板
- [ ] 日志聚合分析 (ELK Stack)
- [ ] 错误追踪 (Sentry)
- [ ] 自动化备份和恢复

### 测试覆盖

- [ ] 单元测试覆盖率 >90%
- [ ] 集成测试覆盖核心流程
- [ ] E2E 测试自动化 (Playwright)
- [ ] 性能测试基准建立

---

## 📈 关键指标 (KPI)

### 产品指标

- 日活跃用户 (DAU): 目标 1000+ (6 个月)
- 用户留存率 (30 天): 目标 >40%
- 平均会话时长: 目标 >15 分钟
- 问题解决率: 目标 >85%

### 技术指标

- API 可用性: >99.9%
- API 响应时间 P95: <200ms
- 错误率: <0.1%
- 代码测试覆盖率: >85%

### 业务指标

- 每日提问数: 目标 500+
- 错题复习完成率: 目标 >60%
- AI 答案满意度: 目标 >4.5/5
- 知识点掌握度提升: 目标 >20%

---

## 🎯 阶段性里程碑

### 里程碑 1: 错题手册 MVP (2025-11)

- 错题记录、复习提醒、统计分析完整可用
- 用户可以完整使用错题管理工作流

### 里程碑 2: 基础推荐系统上线 (2026-01)

- 协同过滤 + 规则推荐完整可用
- 推荐准确率达到 60-70%
- 用户能看到个性化推荐内容

### 里程碑 3: 知识图谱可视化 (2026-02)

- 知识图谱交互式展示
- 学习路径智能推荐

### 里程碑 4: 小程序发布 (2026-04)

- 微信小程序正式上线
- DAU 达到 500+

### 里程碑 5: RAG 增强上线 (2026-06)

- 推荐准确率提升到 75-80%
- 问答质量显著提升
- 用户满意度提升 >20%

---

## 📊 Phase 对比总结

| Phase       | 核心功能     | 准确率     | 开发周期 | 技术难度     | 用户价值       |
| ----------- | ------------ | ---------- | -------- | ------------ | -------------- |
| Phase 1     | 错题手册     | -          | 4 周     | ⭐⭐         | ⭐⭐⭐⭐       |
| **Phase 2** | **基础推荐** | **60-70%** | **8 周** | **⭐⭐⭐**   | **⭐⭐⭐⭐**   |
| Phase 3     | 知识图谱     | 75%        | 6 周     | ⭐⭐⭐       | ⭐⭐⭐         |
| Phase 4     | 小程序       | -          | 10 周    | ⭐⭐⭐       | ⭐⭐⭐⭐⭐     |
| **Phase 5** | **RAG 增强** | **75-80%** | **8 周** | **⭐⭐⭐⭐** | **⭐⭐⭐⭐⭐** |
| Phase 6     | 协作学习     | -          | 12 周    | ⭐⭐⭐       | ⭐⭐⭐         |
| Phase 7     | 教师端       | -          | 16 周    | ⭐⭐⭐⭐     | ⭐⭐⭐⭐       |

**关键洞察**:

- ✅ Phase 2 快速上线推荐功能,验证价值
- ✅ Phase 5 在积累数据后,通过 RAG 显著提升质量
- ✅ 渐进式升级策略,降低风险,持续交付价值
- ✅ 用户能明显感知到 Phase 2 → Phase 5 的质量跃升

---

## 🤔 风险评估

### 技术风险

1. **推荐系统冷启动**

   - 风险: 新用户数据不足,推荐效果差
   - 缓解: 使用热门内容推荐 + 快速引导填写兴趣

2. **RAG 检索准确率不达标**

   - 风险: 语义检索效果不理想
   - 缓解: 多轮迭代优化,A/B 测试验证

3. **知识图谱数据不完整**

   - 缓解: 与教育专家合作,逐步扩展覆盖范围

4. **AI 服务稳定性**
   - 缓解: 多模型备份,实现自动故障转移

### 产品风险

1. **用户留存率低**

   - 缓解: 增加激励机制,优化用户体验

2. **推荐系统使用率低**

   - 风险: 用户不信任推荐
   - 缓解: 添加推荐理由说明,提升透明度

3. **小程序审核不通过**
   - 缓解: 提前了解审核规则,准备备选方案

---

## 📝 更新日志

- **2025-10-12 v1.1**: 调整开发顺序,优先实现基础推荐系统,RAG 作为增强项
- **2025-10-12 v1.0**: 初始版本,基于当前项目状态制定

---

<div align="center">

**本路线图将根据实际开发情况和用户反馈持续更新**

最后更新: 2025-10-12 | 版本: v1.1

</div>
