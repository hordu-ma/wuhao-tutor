# 小程序用户编辑资料页面修改报告

## 修改概览

**修改时间**: 2025 年 10 月 25 日  
**修改页面**: `miniprogram/pages/profile/edit/`  
**修改目的**: 将"联系信息"改为"机构信息"，包含"机构名称"和"联系方式"两个字段

## 具体修改内容

### 1. WXML 模板修改 (`index.wxml`)

#### 删除的内容：

- 学习信息部分的"所属机构"字段（仅教师角色显示）
- 联系信息部分的"家长联系方式"字段（仅学生角色显示）

#### 新增的内容：

- **机构信息**部分，包含：
  - **机构名称** (`institution_name`)：文本输入，最大 50 字符
  - **联系方式** (`contact_info`)：文本输入，最大 50 字符，支持手机号和邮箱格式验证

### 2. JavaScript 逻辑修改 (`index.js`)

#### 数据结构调整：

```javascript
// 旧字段结构
formData: {
  // ...其他字段
  parent_contact: '',  // 删除
  institution: ''      // 删除
}

// 新字段结构
formData: {
  // ...其他字段
  institution_name: '', // 新增：机构名称
  contact_info: ''      // 新增：联系方式
}
```

#### 验证规则调整：

```javascript
// 旧验证字段
validation: {
  parent_contact: { valid: true, message: '' }  // 删除
}

// 新验证字段
validation: {
  institution_name: { valid: true, message: '' }, // 新增
  contact_info: { valid: true, message: '' }      // 新增
}
```

#### 验证逻辑新增：

- **机构名称**：最大 50 字符限制
- **联系方式**：最大 50 字符限制，智能识别手机号和邮箱格式

#### 数据初始化兼容性：

- `institution_name` ← 兼容旧字段 `institution`
- `contact_info` ← 兼容旧字段 `parent_contact`

### 3. 样式文件 (`index.wxss`)

- 无需修改，使用现有的通用样式类

## 兼容性设计

### 向后兼容

- 新字段初始化时会读取旧字段数据
- 保证现有用户数据不丢失

### 字段映射

| 新字段             | 旧字段           | 说明     |
| ------------------ | ---------------- | -------- |
| `institution_name` | `institution`    | 机构名称 |
| `contact_info`     | `parent_contact` | 联系方式 |

## 前端修改完成状态

✅ **WXML 模板**：已完成  
✅ **JavaScript 逻辑**：已完成  
✅ **数据验证**：已完成  
✅ **兼容性处理**：已完成  
✅ **页面配置**：无需修改

## 待处理事项

⏳ **后端 API 适配**：需要修改用户信息更新接口  
⏳ **数据库字段**：需要添加新字段并迁移数据  
⏳ **数据模型**：需要更新用户数据模型定义

## 用户界面效果

### 修改前：

```
基本信息
├── 真实姓名
└── 昵称

学习信息
├── 学校名称
├── 年级
├── 班级
└── 所属机构（仅教师）

联系信息
└── 家长联系方式（仅学生）
```

### 修改后：

```
基本信息
├── 真实姓名
└── 昵称

学习信息
├── 学校名称
├── 年级
└── 班级

机构信息
├── 机构名称
└── 联系方式
```

## 下一步计划

1. **后端 API 调整**：修改 `/auth/profile` 接口支持新字段
2. **数据库迁移**：添加新字段并迁移现有数据
3. **数据模型更新**：更新用户模型定义
4. **测试验证**：端到端功能测试

---

**修改完成**: 前端部分 ✅  
**等待处理**: 后端和数据库部分
