# ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–æ‰§è¡Œæ–¹æ¡ˆ

**åˆ›å»ºæ—¥æœŸ**: 2025-11-12  
**æ›´æ–°æ—¥æœŸ**: 2025-11-13  
**ä¼˜åŒ–èŒƒå›´**: æ–‡ä»¶æ¸…ç†ã€æ—¥å¿—ç®¡ç†ã€æ€§èƒ½è°ƒä¼˜  
**å½“å‰æˆæœ**: âœ… é‡Šæ”¾ **26MB** ç£ç›˜ç©ºé—´ï¼Œé¢„æœŸæœ€ç»ˆé‡Šæ”¾ **352MB**

---

## âœ… å·²å®Œæˆæ“ä½œ

### ç¬¬ 1 é˜¶æ®µï¼šç«‹å³è¡ŒåŠ¨ï¼ˆ**2025-11-13 å®Œæˆ**ï¼‰

#### âœ… æ­¥éª¤ 1: é…ç½®æ—¥å¿—è½®è½¬ç³»ç»Ÿ

**çŠ¶æ€**: âœ… **å®Œæˆ**

**æ‰§è¡Œç»“æœ**:

- âœ… `/etc/logrotate.d/wuhao-tutor` é…ç½®æ–‡ä»¶å·²åˆ›å»º
- âœ… æ—¥å¿—è½®è½¬è§„åˆ™å·²éªŒè¯
- âœ… é…ç½®ç”Ÿæ•ˆï¼ˆæ¯æ—¥è½®è½¬ï¼Œä¿ç•™ 14 ä¸ªå¤‡ä»½ï¼‰

**é…ç½®å†…å®¹**:

```ini
- é¢‘ç‡: dailyï¼ˆæ¯æ—¥è½®è½¬ï¼‰
- ä¿ç•™: rotate 14ï¼ˆä¿ç•™ 14 ä¸ªå¤‡ä»½ï¼‰
- å‹ç¼©: compressï¼ˆå¯ç”¨å‹ç¼©ï¼‰
- å¤§å°é™åˆ¶: notifemptyï¼ˆç©ºæ—¥å¿—è·³è¿‡ï¼‰
- è½®è½¬å: é‡æ–°åŠ è½½æœåŠ¡
```

---

#### âœ… æ­¥éª¤ 2: å¤‡ä»½å¹¶æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶

**çŠ¶æ€**: âœ… **å®Œæˆ**

**æ‰§è¡Œç»“æœ**:

- âœ… æ‰€æœ‰æ—§æ—¥å¿—å·²å¤‡ä»½è‡³ `/opt/backups/logs-archive/logs-20251113.tar.gz`
- âœ… 6 ä¸ªè¿‡æœŸæ—¥å¿—æ–‡ä»¶å·²åˆ é™¤ï¼ˆé‡Šæ”¾ 561KBï¼‰
- âœ… `.dev-pids/` å¼€å‘ä¸´æ—¶ç›®å½•å·²æ¸…ç†
- âœ… `/var/log/wuhao-tutor/` ç›®å½•å·²åˆ›å»ºå¹¶æ­£ç¡®é…ç½®

```bash
# 1. ç™»å½•ç”Ÿäº§æœåŠ¡å™¨
ssh root@121.199.173.244

# 2. åˆ›å»ºæ—¥å¿—è½®è½¬é…ç½®
cat > /etc/logrotate.d/wuhao-tutor << 'EOF'
# åº”ç”¨æ—¥å¿—è½®è½¬é…ç½®
/var/log/wuhao-tutor/*.log /opt/wuhao-tutor/*.log {
    # æ¯å¤©æ‰§è¡Œä¸€æ¬¡è½®è½¬
    daily

    # ä¿ç•™ 14 ä¸ªå¤‡ä»½æ–‡ä»¶
    rotate 14

    # å‹ç¼©æ—§æ—¥å¿—
    compress

    # å»¶è¿Ÿå‹ç¼©
    delaycompress

    # å¦‚æœæ—¥å¿—æ–‡ä»¶ä¸ºç©ºåˆ™è·³è¿‡è½®è½¬
    notifempty

    # æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™
    missingok

    # åˆ›å»ºæ–°æ—¥å¿—æ–‡ä»¶
    create 0640 root root

    # å…±äº«è„šæœ¬ï¼ˆå¤šä¸ªæ–‡ä»¶æ¨¡å¼ï¼‰
    sharedscripts

    # è½®è½¬åé‡æ–°åŠ è½½åº”ç”¨
    postrotate
        systemctl reload wuhao-tutor.service > /dev/null 2>&1 || true
    endscript
}
EOF

# 3. æµ‹è¯•é…ç½®
logrotate -d /etc/logrotate.d/wuhao-tutor

# 4. æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡ï¼ˆæ¼”ç¤ºï¼‰
logrotate -f /etc/logrotate.d/wuhao-tutor

# 5. éªŒè¯
ls -lh /opt/wuhao-tutor/*.log* | head -5
ls -lh /var/log/wuhao-tutor/*.log* 2>/dev/null | head -5
```

**éªŒè¯**: åº”è¯¥çœ‹åˆ° `.log.1.gz` ç­‰å‹ç¼©æ–‡ä»¶

---

#### âœ… æ­¥éª¤ 2: å¤‡ä»½å¹¶æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶

**ç›®çš„**: é‡Šæ”¾ ~561KB ç£ç›˜ç©ºé—´ï¼Œæ•´ç†ç›®å½•ç»“æ„

**å‘½ä»¤**:

```bash
# 1. ç¡®è®¤å½“å‰æ—¥å¿—å¤§å°
du -sh /opt/wuhao-tutor/*.log /opt/wuhao-tutor/.dev-pids/

# 2. å¤‡ä»½æ‰€æœ‰æ—¥å¿—ï¼ˆå¯é€‰ï¼‰
mkdir -p /opt/backups/logs-archive
tar -czf /opt/backups/logs-archive/logs-20251112.tar.gz \
    /opt/wuhao-tutor/*.log \
    /opt/wuhao-tutor/.dev-pids/ \
    2>/dev/null || true

# 3. åˆ é™¤æ—§æ—¥å¿—æ–‡ä»¶
rm -f /opt/wuhao-tutor/backend.log
rm -f /opt/wuhao-tutor/deploy.log
rm -f /opt/wuhao-tutor/deployment.log
rm -f /opt/wuhao-tutor/frontend.log
rm -f /opt/wuhao-tutor/server.log

# 4. æ¸…ç†å¼€å‘ä¸´æ—¶ç›®å½•
rm -rf /opt/wuhao-tutor/.dev-pids/

# 5. åˆ›å»ºæ—¥å¿—ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
mkdir -p /var/log/wuhao-tutor
chown -R root:root /var/log/wuhao-tutor
chmod 755 /var/log/wuhao-tutor

# 6. éªŒè¯æ¸…ç†ç»“æœ
ls -lh /opt/wuhao-tutor/*.log 2>/dev/null && echo "æœ‰æ—§æ—¥å¿—" || echo "âœ… æ—¥å¿—æ–‡ä»¶å·²æ¸…ç†"
du -sh /opt/wuhao-tutor | grep "^[0-9]"
```

**é¢„æœŸç»“æœ**: é‡Šæ”¾ ~561KB ç©ºé—´

---

#### âœ… æ­¥éª¤ 3: æ¸…ç† Python ç¼“å­˜æ–‡ä»¶

**çŠ¶æ€**: âœ… **å®Œæˆ**

**æ‰§è¡Œç»“æœ**:

- âœ… æ‰€æœ‰ `__pycache__` ç›®å½•å·²åˆ é™¤
- âœ… 1,647 ä¸ª `.pyc` æ–‡ä»¶å·²åˆ é™¤ï¼ˆé‡Šæ”¾ 21.4MBï¼‰
- âœ… Systemd é…ç½®å·²ä¿®æ”¹ï¼Œæ·»åŠ  `-B` å‚æ•°
- âœ… åº”ç”¨å·²é‡å¯å¹¶éªŒè¯é€šè¿‡ï¼ˆAPI å¥åº·æ£€æŸ¥ âœ…ï¼‰

**ä¿®æ”¹å†…å®¹**:

```bash
# åŸ: ExecStart=/opt/wuhao-tutor/venv/bin/uvicorn ...
# æ–°: ExecStart=/opt/wuhao-tutor/venv/bin/python -B /opt/wuhao-tutor/venv/bin/uvicorn ...
```

**éªŒè¯ç»“æœ**:

```json
GET https://www.horsduroot.com/health
{
  "status": "healthy",
  "project": "äº”å¥½ä¼´å­¦",
  "version": "0.1.0",
  "environment": "production"
}
```

---

## ğŸ“ˆ ç¬¬ 1 é˜¶æ®µæˆæœç»Ÿè®¡

| é¡¹ç›®             | é‡Šæ”¾ç©ºé—´  | çŠ¶æ€        |
| ---------------- | --------- | ----------- |
| æ—¥å¿—æ–‡ä»¶è½®è½¬é…ç½® | -         | âœ… é…ç½®å®Œæˆ |
| æ—§æ—¥å¿—æ–‡ä»¶æ¸…ç†   | 561KB     | âœ… å®Œæˆ     |
| Python ç¼“å­˜æ¸…ç†  | 21.4MB    | âœ… å®Œæˆ     |
| åº”ç”¨éªŒè¯         | -         | âœ… æ­£å¸¸è¿è¡Œ |
| **å°è®¡**         | **~22MB** | **âœ… å®Œæˆ** |

**é¡¹ç›®å¤§å°å˜åŒ–**: 679MB â†’ 653MB (-26MB)

---

## â³ åç»­æ“ä½œè®¡åˆ’

### ç¬¬ 2 é˜¶æ®µï¼šæœ¬å‘¨å®Œæˆï¼ˆ3-5 å¤©å†…ï¼‰

#### ğŸŸ¡ æ­¥éª¤ 4: æ¸…ç†æ—§å¤‡ä»½æ–‡ä»¶

**ç›®çš„**: é‡Šæ”¾ 241MB ç£ç›˜ç©ºé—´

**æ“ä½œæ­¥éª¤**:

```bash
# 1. ç¡®è®¤å¤‡ä»½å†…å®¹ï¼ˆOct 9 çš„ä»£ç å¤‡ä»½ï¼‰
ls -lh /opt/wuhao-tutor/backups/code_20251009_000406.tar.gz

# 2. åˆ›å»ºæ¸…ç†æ—¥å¿—
cat > /opt/backups/CLEANUP_LOG.txt << 'EOF'
æ¸…ç†æ—¥æœŸ: 2025-11-13
åˆ é™¤çš„å¤‡ä»½:
- code_20251009_000406.tar.gz (241MB) - ä»£ç åº“å¤‡ä»½ï¼ˆè¿‡æ—¶ï¼‰
- env_20251009_000406 (2.5K) - ç¯å¢ƒé…ç½®å¤‡ä»½

ä¿ç•™çš„å¤‡ä»½:
- /opt/wuhao-tutor/backup/* - æ›´æ–°çš„å¤‡ä»½
- /opt/backups/logs-archive/ - æ—¥å¿—å¤‡ä»½
EOF

# 3. åˆ é™¤æ—§å¤‡ä»½
rm -f /opt/wuhao-tutor/backups/code_20251009_000406.tar.gz
rm -f /opt/wuhao-tutor/backups/env_20251009_000406

# 4. éªŒè¯åˆ é™¤
du -sh /opt/wuhao-tutor/backups/
```

**é¢„æœŸç»“æœ**: é‡Šæ”¾ ~241MB ç©ºé—´

---

#### ğŸŸ¡ æ­¥éª¤ 5: åˆ¶å®šæ–°å¤‡ä»½ç­–ç•¥

**æ“ä½œæ­¥éª¤**:

```bash
# 1. åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /opt/scripts/backup-daily.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y-%m-%d_%H%M%S)

# å¤‡ä»½ä»£ç å’Œé…ç½®ï¼ˆæ’é™¤è™šæ‹Ÿç¯å¢ƒï¼‰
tar -czf /opt/backups/daily/backup_${DATE}.tar.gz \
    --exclude=venv \
    --exclude=.git \
    --exclude=__pycache__ \
    --exclude=*.pyc \
    --exclude=uploads \
    /opt/wuhao-tutor/src \
    /opt/wuhao-tutor/alembic \
    /opt/wuhao-tutor/frontend \
    /opt/wuhao-tutor/miniprogram

# æ¸…ç†è¶…è¿‡ 7 å¤©çš„å¤‡ä»½
find /opt/backups/daily -name "backup_*.tar.gz" -mtime +7 -delete

echo "[$(date)] Backup completed: backup_${DATE}.tar.gz"
EOF

chmod +x /opt/scripts/backup-daily.sh

# 2. æ·»åŠ åˆ° crontabï¼ˆæ¯å¤©å‡Œæ™¨ 2 ç‚¹ï¼‰
crontab -e
# æ·»åŠ ä¸€è¡Œ:
# 0 2 * * * /opt/scripts/backup-daily.sh >> /var/log/backup.log 2>&1
```

**é¢„æœŸæ•ˆæœ**: æ¯æ—¥è‡ªåŠ¨å¤‡ä»½ï¼Œè‡ªåŠ¨æ¸…ç† 7 å¤©å‰çš„å¤‡ä»½

---

### ç¬¬ 3 é˜¶æ®µï¼šæœ¬æœˆå®Œæˆï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰

#### ğŸŸ¢ æ­¥éª¤ 6: è¿ç§»ä¸Šä¼ æ–‡ä»¶åˆ° OSS

**ç›®çš„**: è§£å†³ç£ç›˜å®¹é‡é™åˆ¶ï¼Œå®ç°æ— é™æ‰©å±•

**åç»­æ‰§è¡Œ**:

1. åœ¨é˜¿é‡Œäº‘ OSS åˆ›å»º Bucketï¼ˆ`wuhao-tutor-uploads`ï¼‰
2. ä¿®æ”¹åº”ç”¨é…ç½®ä½¿ç”¨ OSS å­˜å‚¨
3. è¿ç§»ç°æœ‰ 89MB æ–‡ä»¶åˆ° OSS
4. æ¸…ç†æœ¬åœ°å­˜å‚¨

**é¢„æœŸç»“æœ**: é‡Šæ”¾ 89MB ç©ºé—´ + æ— é™æ‰©å±•

---

tar -tzf /opt/wuhao-tutor/backups/code_20251009_000406.tar.gz | head -20

# éªŒè¯å†…å®¹æ˜¯å¦å°±æ˜¯ /opt/wuhao-tutor ç›®å½•

# 3. ä¿å­˜å¤‡ä»½æ¸…å•ï¼ˆä»¥é˜²éœ€è¦ï¼‰

cat > /opt/backups/BACKUP_CLEANUP_LOG.txt << 'EOF'
æ¸…ç†æ—¥æœŸ: 2025-11-12
åˆ é™¤çš„å¤‡ä»½æ–‡ä»¶:

- code_20251009_000406.tar.gz (241MB) - æ•´ä¸ªä»£ç åº“å¤‡ä»½ï¼Œå·²è¿‡æ—¶
- env_20251009_000406 (2.5K) - ç¯å¢ƒå˜é‡æ–‡ä»¶å¤‡ä»½

ä¿ç•™çš„å¤‡ä»½:

- /opt/wuhao-tutor/backup/\* (640KB) - æ›´æ–°çš„å¤‡ä»½æ–‡ä»¶
- /opt/backups/logs-archive/ - æ—¥å¿—å¤‡ä»½
  EOF

# 4. åˆ é™¤æ—§å¤‡ä»½ï¼ˆéœ€ç¡®è®¤ï¼‰

# âš ï¸ è¯·ç¡®ä¿è¿™ä¸ªæ–‡ä»¶ç¡®å®æ˜¯è¿‡æ—¶çš„ä»£ç å¤‡ä»½ï¼Œä¸æ˜¯å½“å‰ä»£ç ï¼

rm -f /opt/wuhao-tutor/backups/code_20251009_000406.tar.gz
rm -f /opt/wuhao-tutor/backups/env_20251009_000406

# 5. éªŒè¯åˆ é™¤

du -sh /opt/wuhao-tutor/backups/
ls /opt/wuhao-tutor/backups/

````

**é¢„æœŸç»“æœ**: é‡Šæ”¾ ~241MB ç©ºé—´

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­ç­‰ï¼ˆç¡®è®¤å¤‡ä»½å†…å®¹åå†åˆ é™¤ï¼‰

---

#### ğŸŸ¡ æ­¥éª¤ 5: åˆ¶å®šå¤‡ä»½ç­–ç•¥

**ç›®çš„**: é˜²æ­¢å¤‡ä»½æ··ä¹±ï¼Œç¡®ä¿æ•°æ®å®‰å…¨

**æ¨èæ–¹æ¡ˆ**:

```bash
# æ–¹æ¡ˆ 1: æœ¬åœ°å¤‡ä»½ç­–ç•¥ï¼ˆæˆæœ¬ä½ï¼‰
mkdir -p /opt/backups/daily
mkdir -p /opt/backups/weekly
mkdir -p /opt/backups/monthly

# æ¯æ—¥å¤‡ä»½è„šæœ¬
cat > /opt/scripts/backup-daily.sh << 'BACKUP_EOF'
#!/bin/bash
DATE=$(date +%Y-%m-%d_%H%M%S)
tar -czf /opt/backups/daily/backup_${DATE}.tar.gz \
    --exclude=venv \
    --exclude=.git \
    --exclude=__pycache__ \
    --exclude=.pyc \
    /opt/wuhao-tutor/src \
    /opt/wuhao-tutor/alembic \
    /opt/wuhao-tutor/frontend \
    /opt/wuhao-tutor/miniprogram

# æ¸…ç†è¶…è¿‡ 7 å¤©çš„å¤‡ä»½
find /opt/backups/daily -name "backup_*.tar.gz" -mtime +7 -delete

echo "Backup completed: backup_${DATE}.tar.gz"
BACKUP_EOF

chmod +x /opt/scripts/backup-daily.sh

# æ·»åŠ åˆ° crontab
crontab -e
# æ·»åŠ ä¸€è¡Œ:
# 0 2 * * * /opt/scripts/backup-daily.sh >> /var/log/backup.log 2>&1

# æ–¹æ¡ˆ 2: ä½¿ç”¨é˜¿é‡Œäº‘è‡ªåŠ¨å¤‡ä»½ï¼ˆæ¨èï¼‰
# åœ¨é˜¿é‡Œäº‘ ECS æ§åˆ¶å°ä¸ºå®ä¾‹å¯ç”¨è‡ªåŠ¨å¿«ç…§
# - é¢‘ç‡: æ¯æ—¥
# - ä¿ç•™: æœ€è¿‘ 7 ä¸ªå¿«ç…§
# - æˆæœ¬: æŒ‰å¿«ç…§å­˜å‚¨è®¡è´¹ï¼ˆ~0.12 å…ƒ/GB/å¤©ï¼‰
````

---

### ç¬¬ 3 é˜¶æ®µï¼šé•¿æœŸä¼˜åŒ–ï¼ˆæœ¬æœˆå†…å®Œæˆï¼‰

#### ğŸŸ¢ æ­¥éª¤ 6: è¿ç§»ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶åˆ° OSS

**ç›®çš„**: è§£å†³ç£ç›˜å®¹é‡é™åˆ¶ï¼Œå®ç°å¯æ‰©å±•å­˜å‚¨ï¼ˆ89MB ç°åœ¨ï¼Œæœªæ¥ä¼šæ›´å¤šï¼‰

**å‰ç½®æ¡ä»¶**:

- å·²åœ¨é˜¿é‡Œäº‘ OSS åˆ›å»º Bucket
- å·²é…ç½® OSS è®¿é—®å¯†é’¥

**å®ç°æ­¥éª¤**:

```bash
# 1. åœ¨é˜¿é‡Œäº‘ OSS åˆ›å»º Bucketï¼ˆå¦‚æœªåˆ›å»ºï¼‰
# - Bucket åç§°: wuhao-tutor-uploads
# - åŒºåŸŸ: åä¸œ 1ï¼ˆä¸ RDS åŒåŒºï¼‰
# - è®¿é—®æƒé™: ç§æœ‰ï¼ˆé˜²æ­¢å…¬å¼€è®¿é—®ï¼‰

# 2. é…ç½®åº”ç”¨ï¼ˆä¿®æ”¹ src/utils/file_upload.pyï¼‰
# åˆ‡æ¢åˆ° OSS å­˜å‚¨è€Œéæœ¬åœ°å­˜å‚¨

# 3. è¿ç§»ç°æœ‰æ–‡ä»¶
aliyun oss cp -r /opt/wuhao-tutor/uploads/ \
    oss://wuhao-tutor-uploads/uploads/

# 4. éªŒè¯è¿ç§»
aliyun oss ls oss://wuhao-tutor-uploads/ -s

# 5. æ¸…ç†æœ¬åœ°å­˜å‚¨ï¼ˆè¿ç§»å®Œæˆåï¼‰
rm -rf /opt/wuhao-tutor/uploads/*
```

**é¢„æœŸç»“æœ**:

- é‡Šæ”¾ 89MB ç©ºé—´
- æ”¯æŒæ— é™æ‰©å±•ï¼ˆæŒ‰é‡ä»˜è´¹ï¼‰
- è‡ªåŠ¨å¤‡ä»½ï¼ˆé˜¿é‡Œäº‘ OSS å¤‡ä»½ï¼‰

---

## ğŸ“Š ä¼˜åŒ–å½±å“è¯„ä¼°

### ç£ç›˜ç©ºé—´èŠ‚çœç»Ÿè®¡

| é¡¹ç›®               | å¤§å°              | ä¼˜å…ˆçº§  | ä¼˜åŒ–çŠ¶æ€  |
| ------------------ | ----------------- | ------- | --------- |
| æ—§æ—¥å¿—æ–‡ä»¶         | 561KB             | ğŸ”´ ç«‹å³ | âœ… å®æ–½ä¸­ |
| Python ç¼“å­˜        | 21.4MB            | ğŸ”´ ç«‹å³ | âœ… å®æ–½ä¸­ |
| æ—§å¤‡ä»½ (Oct 9)     | 241MB             | ğŸŸ¡ æœ¬å‘¨ | â³ å¾…ç¡®è®¤ |
| ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ â†’ OSS | 89MB ç°åœ¨ï¼Œâˆ æœªæ¥ | ğŸŸ¢ æœ¬æœˆ | â³ å¾…å®æ–½ |
| **å°è®¡**           | **~352MB**        | -       | -         |

### ç³»ç»Ÿç¨³å®šæ€§æå‡

| æŒ‡æ ‡       | æ”¹è¿›              | éªŒè¯æ–¹æ³•                                    |
| ---------- | ----------------- | ------------------------------------------- |
| ç£ç›˜ç©ºé—´   | 24% â†’ 11%         | `df -h /`                                   |
| æ—¥å¿—ç®¡ç†   | æ— è½®è½¬ â†’ è‡ªåŠ¨è½®è½¬ | `logrotate -d /etc/logrotate.d/wuhao-tutor` |
| åº”ç”¨å¯åŠ¨   | åŒæ—§å­—èŠ‚ç æ··ç”¨    | æ¸…é™¤ç¼“å­˜åé‡å¯                              |
| å¤‡ä»½æ¸…æ™°åº¦ | æ··ä¹± â†’ æœ‰è®¡åˆ’     | æ–°å¤‡ä»½è„šæœ¬                                  |

---

## ğŸ”„ æ‰§è¡Œæ¸…å•

### ç¬¬ 1 é˜¶æ®µï¼ˆ**2025-11-13 å·²å®Œæˆ** âœ…ï¼‰

- [x] æ­¥éª¤ 1: é…ç½®æ—¥å¿—è½®è½¬
  - [x] åˆ›å»º `/etc/logrotate.d/wuhao-tutor`
  - [x] æµ‹è¯•é…ç½®
  - [x] æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡
- [x] æ­¥éª¤ 2: æ¸…ç†æ—§æ—¥å¿—
  - [x] å¤‡ä»½æ—¥å¿—æ–‡ä»¶è‡³ `/opt/backups/logs-archive/logs-20251113.tar.gz`
  - [x] åˆ é™¤ 6 ä¸ª .log æ–‡ä»¶ï¼ˆé‡Šæ”¾ 561KBï¼‰
  - [x] åˆ é™¤ .dev-pids ç›®å½•
  - [x] éªŒè¯æ¸…ç†ç»“æœ âœ…
- [x] æ­¥éª¤ 3: æ¸…ç† Python ç¼“å­˜
  - [x] åˆ é™¤ **pycache** ç›®å½•
  - [x] åˆ é™¤ 1,647 ä¸ª .pyc æ–‡ä»¶ï¼ˆé‡Šæ”¾ 21.4MBï¼‰
  - [x] ä¿®æ”¹ Systemd é…ç½®ï¼ˆæ·»åŠ  -B å‚æ•°ï¼‰
  - [x] é‡å¯åº”ç”¨
  - [x] éªŒè¯å¥åº·æ£€æŸ¥ âœ…

### ç¬¬ 2 é˜¶æ®µï¼ˆæœ¬å‘¨ 3-5 å¤©å†…ï¼‰

- [ ] æ­¥éª¤ 4: æ¸…ç†æ—§å¤‡ä»½
  - [ ] ç¡®è®¤ Oct 9 å¤‡ä»½å†…å®¹
  - [ ] ä¿å­˜æ¸…ç†æ—¥å¿—
  - [ ] åˆ é™¤æ—§å¤‡ä»½ (241MB)
  - [ ] éªŒè¯ç©ºé—´é‡Šæ”¾
- [ ] æ­¥éª¤ 5: åˆ¶å®šå¤‡ä»½ç­–ç•¥
  - [ ] é€‰æ‹©å¤‡ä»½æ–¹æ¡ˆ
  - [ ] åˆ›å»ºå¤‡ä»½è„šæœ¬
  - [ ] é…ç½® cron ä»»åŠ¡
  - [ ] æµ‹è¯•å¤‡ä»½æ¢å¤

### ç¬¬ 3 é˜¶æ®µï¼ˆæœ¬æœˆ 30 å¤©å†…ï¼‰

- [ ] æ­¥éª¤ 6: è¿ç§»åˆ° OSS
  - [ ] åˆ›å»º OSS Bucket
  - [ ] é…ç½®è®¿é—®å¯†é’¥
  - [ ] ä¿®æ”¹åº”ç”¨ä»£ç 
  - [ ] è¿ç§»ç°æœ‰æ–‡ä»¶ (89MB)
  - [ ] éªŒè¯è®¿é—®æƒé™
  - [ ] æ¸…ç†æœ¬åœ°å­˜å‚¨
  - [ ] é…ç½® cron ä»»åŠ¡
  - [ ] æµ‹è¯•å¤‡ä»½æ¢å¤

### ç¬¬ 3 é˜¶æ®µï¼ˆæœ¬æœˆï¼‰

- [ ] æ­¥éª¤ 6: è¿ç§»åˆ° OSS
  - [ ] åˆ›å»º OSS Bucket
  - [ ] é…ç½®è®¿é—®å¯†é’¥
  - [ ] ä¿®æ”¹åº”ç”¨ä»£ç 
  - [ ] è¿ç§»ç°æœ‰æ–‡ä»¶
  - [ ] éªŒè¯è®¿é—®æƒé™
  - [ ] æ¸…ç†æœ¬åœ°å­˜å‚¨

---

## ğŸš¨ å›æ»šæ–¹æ¡ˆ

### å¦‚æœå‡ºç°é—®é¢˜

#### åœºæ™¯ 1: åˆ é™¤æ—¥å¿—ååº”ç”¨æ— æ³•å¯åŠ¨

```bash
# æ¢å¤å¤‡ä»½
tar -xzf /opt/backups/logs-archive/logs-20251112.tar.gz -C /

# é‡å¯æœåŠ¡
systemctl restart wuhao-tutor.service
```

#### åœºæ™¯ 2: ä¿®æ”¹ Systemd ååº”ç”¨å´©æºƒ

```bash
# æ¢å¤é…ç½®æ–‡ä»¶
cp /etc/systemd/system/wuhao-tutor.service.bak \
   /etc/systemd/system/wuhao-tutor.service

# é‡æ–°åŠ è½½å¹¶é‡å¯
systemctl daemon-reload
systemctl restart wuhao-tutor.service
```

#### åœºæ™¯ 3: åˆ é™¤å¤‡ä»½åå‘ç°éœ€è¦æ¢å¤

```bash
# ä» Git æ¢å¤ä»£ç ï¼ˆå¦‚æœæ˜¯ä»£ç é—®é¢˜ï¼‰
cd /opt/wuhao-tutor
git status  # æ£€æŸ¥æ˜¯å¦æœ‰ Git ä»“åº“

# æˆ–ä»é˜¿é‡Œäº‘å¿«ç…§æ¢å¤ï¼ˆå®Œæ•´ç³»ç»Ÿå¤‡ä»½ï¼‰
```

---

## âœ… éªŒè¯æ¸…å•

### æ¯ä¸ªæ­¥éª¤å®Œæˆåçš„éªŒè¯

```bash
# æ­¥éª¤ 1-2 éªŒè¯
du -sh /opt/wuhao-tutor/
ls -lh /opt/wuhao-tutor/*.log 2>/dev/null | wc -l  # åº”è¯¥ = 0
curl https://www.horsduroot.com/health | head -c 50

# æ­¥éª¤ 3 éªŒè¯
find /opt/wuhao-tutor -name '*.pyc' | wc -l  # åº”è¯¥ = 0
ps aux | grep uvicorn | grep -v grep

# æ­¥éª¤ 4 éªŒè¯
du -sh /opt/wuhao-tutor/backups/
ls -lh /opt/wuhao-tutor/backups/ | wc -l

# æ•´ä½“éªŒè¯
df -h /                                          # ç£ç›˜ä½¿ç”¨ç‡
du -sh /opt/wuhao-tutor                         # æ€»å¤§å°
systemctl status wuhao-tutor.service            # æœåŠ¡çŠ¶æ€
```

---

## ğŸ“ å…³é”®è”ç³»æ–¹å¼

- **ç”Ÿäº§ç¯å¢ƒ**: SSH root@121.199.173.244
- **åº”ç”¨ç›®å½•**: /opt/wuhao-tutor
- **æœåŠ¡æ—¥å¿—**: journalctl -u wuhao-tutor.service -f
- **Nginx æ—¥å¿—**: /var/log/nginx/access.log, error.log

---

## ğŸ“ æ‰§è¡Œå¤‡æ³¨

- **é¢„è®¡è€—æ—¶**: 30-45 åˆ†é’Ÿï¼ˆç¬¬ 1 é˜¶æ®µï¼‰
- **é£é™©ç­‰çº§**: ä½ï¼ˆæ‰€æœ‰æ“ä½œå¯å›æ»šï¼‰
- **å¤‡ä»½éœ€æ±‚**: å·²åœ¨æ­¥éª¤ä¸­åŒ…å«
- **åœæœºéœ€æ±‚**: æ— ï¼ˆæ­¥éª¤ 3 éœ€è¦é‡å¯ï¼Œä½†åº”ç”¨ä¼šè‡ªåŠ¨æ¢å¤ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-12  
**ä¸‹æ¬¡æ£€æŸ¥**: 2025-12-12
