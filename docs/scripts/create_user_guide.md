# 用户账号创建脚本使用说明

## 概述

`create_user.py` 是一个交互式的用户账号创建工具，专为管理员设计，用于快速创建用户账号并自动生成安全密码。

## 功能特性

- ✅ **交互式界面**：友好的命令行交互
- ✅ **手机号验证**：自动验证手机号格式和唯一性
- ✅ **自动密码生成**：生成 8 位安全随机密码
- ✅ **实时反馈**：创建过程和结果的详细反馈
- ✅ **错误处理**：完善的异常处理和用户提示

## 使用方法

### 基本用法

```bash
# 在项目根目录运行
cd /path/to/wuhao-tutor
uv run python scripts/create_user.py
```

### 交互流程

1. **输入手机号**

   ```
   📱 请输入用户手机号: 13800138000
   ```

2. **输入姓名**

   ```
   👤 请输入用户姓名: 张三
   ```

3. **确认密码**

   ```
   🔐 生成的登录密码: Ab3dE8kL
   ⚠️  请妥善保存此密码，用户首次登录时需要使用
   ```

4. **确认创建**
   ```
   确认创建用户账号吗？(手机号: 13800138000, 姓名: 张三) [y/N]: y
   ```

## 输出示例

```
============================================================
✅ 用户账号创建成功！
============================================================
👤 用户ID: b4efe891-a005-4b8b-84eb-5277d1d79cd9
📱 手机号: 13800138100
👤 姓名: 测试用户2
🔐 密码: 1vlvK6Rp
📧 角色: student
✅ 状态: 激活
✅ 验证: 已验证
📅 创建时间: 2025-10-26T02:16:02.378843
============================================================
```

## 安全特性

### 密码生成

- **长度**：8 位字符
- **复杂度**：至少包含 1 个大写字母、1 个小写字母、1 个数字
- **随机性**：使用 `secrets` 模块确保密码安全性

### 数据验证

- **手机号格式**：严格按照中国大陆手机号格式验证
- **唯一性检查**：确保手机号在系统中唯一
- **姓名验证**：不能为空且长度不超过 50 字符

### 权限控制

- 创建的用户默认角色为 `student`
- 账号状态为 `激活` 和 `已验证`
- 无需短信验证码验证

## 使用场景

### 适合场景

- 学校批量注册学生账号
- 教师账号快速创建
- 用户申请审核通过后的账号激活
- 管理员手动创建测试账号

### 不适合场景

- 用户自助注册（应使用注册 API）
- 需要短信验证的场景
- 批量导入大量用户（建议使用专门的导入工具）

## 技术实现

### 依赖模块

- `sqlalchemy` - 数据库操作
- `secrets` - 安全随机数生成
- `string` - 字符串操作
- `re` - 正则表达式验证

### 数据库操作

- 使用 `BaseRepository` 进行数据访问
- 自动生成密码哈希（PBKDF2）
- 支持异步数据库操作

### 错误处理

- 手机号已存在检查
- 数据库连接异常处理
- 用户输入验证
- 优雅的错误提示

## 注意事项

### 安全提醒

- ⚠️ 生成的密码请妥善保存，创建后立即告知用户
- ⚠️ 建议用户首次登录后修改密码
- ⚠️ 定期清理测试账号

### 使用限制

- 需要在项目环境中运行（依赖 `.env` 配置）
- 需要数据库连接正常
- 仅支持创建学生角色账号

### 后续操作

- 告知用户登录方式：手机号 + 密码
- 引导用户完善个人信息（学校、年级等）
- 监控用户首次登录情况

## 故障排除

### 常见问题

**问题 1: ModuleNotFoundError**

```
解决方案: 使用 uv run python scripts/create_user.py
```

**问题 2: 手机号已存在**

```
解决方案: 使用其他手机号，或检查是否重复创建
```

**问题 3: 数据库连接失败**

```
解决方案: 检查 .env 配置和数据库服务状态
```

## 维护建议

- 定期更新密码生成算法
- 监控脚本使用情况
- 根据实际需求调整用户默认设置
- 添加日志记录功能

---

**最后更新**: 2025-10-26
**维护者**: 五好伴学开发团队
