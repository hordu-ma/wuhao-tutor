# é”™é¢˜æœ¬ä¼˜åŒ–å¼€å‘æŒ‡å¯¼æ–‡æ¡£ï¼ˆæ–¹æ¡ˆAï¼šåŸºäºå­¦ä¹ é—®ç­”æ¨¡å—ï¼‰

**ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-07  
**é€‚ç”¨èŒƒå›´**: äº”å¥½ä¼´å­¦ - é”™é¢˜æ‰‹å†ŒåŠŸèƒ½ä¼˜åŒ–  
**å¼€å‘å‘¨æœŸ**: 2-3 å‘¨

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€æ–¹æ¡ˆæ¦‚è¿°](#ä¸€æ–¹æ¡ˆæ¦‚è¿°)
- [äºŒã€æŠ€æœ¯æ¶æ„](#äºŒæŠ€æœ¯æ¶æ„)
- [ä¸‰ã€æ•°æ®åº“è®¾è®¡](#ä¸‰æ•°æ®åº“è®¾è®¡)
- [å››ã€åç«¯å®ç°](#å››åç«¯å®ç°)
- [äº”ã€å‰ç«¯å®ç°](#äº”å‰ç«¯å®ç°)
- [å…­ã€å¼€å‘è®¡åˆ’](#å…­å¼€å‘è®¡åˆ’)
- [ä¸ƒã€æµ‹è¯•æ–¹æ¡ˆ](#ä¸ƒæµ‹è¯•æ–¹æ¡ˆ)
- [å…«ã€ä¸Šçº¿æ£€æŸ¥æ¸…å•](#å…«ä¸Šçº¿æ£€æŸ¥æ¸…å•)
- [ä¹ã€å¸¸è§é—®é¢˜](#ä¹å¸¸è§é—®é¢˜)

---

## ä¸€ã€æ–¹æ¡ˆæ¦‚è¿°

### 1.1 èƒŒæ™¯ä¸ç›®æ ‡

**å½“å‰é—®é¢˜**ï¼š
- âŒ ç”¨æˆ·ä¸Šä¼ ä½œä¸šå›¾ç‰‡æ—¶ï¼Œæ•´æ¬¡å¯¹è¯è¢«å½•å…¥ä¸ºä¸€æ¡é”™é¢˜è®°å½•
- âŒ æ— æ³•åŒºåˆ†å•é“é¢˜ç›®ï¼Œå›¾ç‰‡ä¸­çš„å¤šé¢˜è¢«åˆå¹¶å¤„ç†
- âŒ é”™é¢˜æœ¬æ˜¾ç¤ºçš„æ˜¯å®Œæ•´å¯¹è¯å†…å®¹ï¼Œä¸æ˜¯å•é¢˜
- âŒ AI åªæ˜¯å›ç­”é—®é¢˜ï¼Œæ²¡æœ‰æ˜ç¡®"æ‰¹æ”¹"å’Œåˆ¤æ–­å¯¹é”™

**ç›®æ ‡**ï¼š
- âœ… ç”¨æˆ·ä¸Šä¼ ä½œä¸šå›¾ç‰‡åï¼ŒAI è‡ªåŠ¨è¯†åˆ«å¹¶é€é¢˜æ‰¹æ”¹
- âœ… åªæœ‰é”™é¢˜/æœªä½œç­”çš„é¢˜è¿›å…¥é”™é¢˜æœ¬ï¼Œæ¯é¢˜ç‹¬ç«‹è®°å½•
- âœ… é”™é¢˜è®°å½•åŒ…å«ï¼šé¢˜å·ã€é¢˜ç›®å†…å®¹ã€å­¦ç”Ÿç­”æ¡ˆã€æ­£ç¡®ç­”æ¡ˆã€è§£æã€çŸ¥è¯†ç‚¹
- âœ… å°ç¨‹åºå±•ç¤ºæ‰¹æ”¹ç»“æœæ‘˜è¦ï¼Œç”¨æˆ·å¯æŸ¥çœ‹è¯¦æƒ…

**ä¸ºä»€ä¹ˆé€‰æ‹©æ–¹æ¡ˆA**ï¼š
1. **ç¬¦åˆç”¨æˆ·ä¹ æƒ¯**ï¼šç”¨æˆ·å·²ä¹ æƒ¯åœ¨"å­¦ä¹ é—®ç­”"é¡µé¢ä¸Šä¼ ä½œä¸š
2. **é™ä½è®¤çŸ¥è´Ÿæ‹…**ï¼šæ— éœ€æ–°å¢å…¥å£ï¼Œé¿å…ç”¨æˆ·å›°æƒ‘
3. **å¿«é€Ÿä¸Šçº¿**ï¼šæ”¹é€ ç°æœ‰æ¨¡å—ï¼Œå¼€å‘å‘¨æœŸ 2-3 å‘¨
4. **æ¸è¿›å¼ä¼˜åŒ–**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œå¯ç°åº¦å‘å¸ƒ

### 1.2 æ ¸å¿ƒæ”¹åŠ¨ç‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·ä¸Šä¼ ä½œä¸šå›¾ç‰‡ï¼ˆ1-5å¼ ï¼‰                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI è¯†åˆ«å¹¶æ‰¹æ”¹ï¼ˆæ–°å¢ï¼‰                                          â”‚
â”‚  - æå–æ‰€æœ‰é¢˜ç›®ï¼ˆé¢˜å·ã€é¢˜å¹²ã€å­¦ç”Ÿç­”æ¡ˆï¼‰                          â”‚
â”‚  - é€é¢˜åˆ¤æ–­ï¼šå¯¹/é”™/æœªä½œç­”                                       â”‚
â”‚  - è¿”å›ç»“æ„åŒ– JSON                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯é€é¢˜åˆ›å»º MistakeRecordï¼ˆæ”¹é€ ï¼‰                            â”‚
â”‚  - ä»…é”™é¢˜/æœªä½œç­”é¢˜è¿›å…¥é”™é¢˜æœ¬                                    â”‚
â”‚  - æ¯é¢˜ç‹¬ç«‹è®°å½•ï¼ˆæ–°å¢ question_number å­—æ®µï¼‰                   â”‚
â”‚  - è‡ªåŠ¨å…³è”çŸ¥è¯†ç‚¹                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å°ç¨‹åºå±•ç¤ºæ‰¹æ”¹ç»“æœï¼ˆæ–°å¢ï¼‰                                     â”‚
â”‚  - æ€»è§ˆï¼šå¯¹/é”™/æœªä½œç­”ç»Ÿè®¡                                       â”‚
â”‚  - é€é¢˜å±•ç¤ºï¼ˆå¯æŠ˜å ï¼‰                                           â”‚
â”‚  - ç‚¹å‡»"æŸ¥çœ‹é”™é¢˜"è·³è½¬åˆ°é”™é¢˜è¯¦æƒ…                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æŠ€æœ¯æ¶æ„

### 2.1 æ¨¡å—å…³ç³»

```
miniprogram/pages/learning/index/  (å‰ç«¯)
    â†“ è°ƒç”¨
src/api/v1/endpoints/learning.py  (APIå±‚)
    â†“ è°ƒç”¨
src/services/learning_service.py  (Serviceå±‚) â† é‡ç‚¹æ”¹é€ 
    â†“ è°ƒç”¨
src/services/bailian_service.py   (AIæœåŠ¡) â† æ–°å¢æ‰¹æ”¹æ¨¡å¼Prompt
    â†“ å†™å…¥
src/models/study.py (MistakeRecord) â† æ–°å¢å­—æ®µ
    â†“ å…³è”
src/models/knowledge_graph.py (çŸ¥è¯†ç‚¹) â† è‡ªåŠ¨å…³è”
```

### 2.2 æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ (content + image_urls)
    â†“
LearningService.ask_question()
    â†“
ã€åˆ¤æ–­ã€‘æ˜¯å¦åŒ…å«å›¾ç‰‡ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ _extract_and_correct_homework()  â† æ–°å¢æ–¹æ³•
    â”‚         â”œâ”€ è°ƒç”¨ AI æ‰¹æ”¹ï¼ˆè¿”å› JSONï¼‰
    â”‚         â”œâ”€ è§£æé¢˜ç›®åˆ—è¡¨
    â”‚         â””â”€ é€é¢˜åˆ›å»º MistakeRecord
    â”‚
    â””â”€ å¦ â†’ èµ°åŸæœ‰æµç¨‹ï¼ˆå•é¢˜é—®ç­”ï¼‰
    â†“
è¿”å› AskQuestionResponse
    â”œâ”€ question
    â”œâ”€ answer
    â””â”€ correction_result (æ–°å¢) â† æ‰¹æ”¹ç»“æœ
```

---

## ä¸‰ã€æ•°æ®åº“è®¾è®¡

### 3.1 MistakeRecord è¡¨æ”¹åŠ¨

**æ–°å¢å­—æ®µ**ï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|-------|------|------|--------|
| `question_number` | Integer | é¢˜å·ï¼ˆæ¥è‡ªæ‰¹æ”¹ç»“æœï¼Œä»1å¼€å§‹ï¼‰ | NULL |
| `is_unanswered` | Boolean | æ˜¯å¦æœªä½œç­”ï¼ˆåŒºåˆ†äºç­”é”™ï¼‰ | FALSE |
| `question_type` | String(20) | é¢˜ç›®ç±»å‹ï¼ˆé€‰æ‹©/å¡«ç©º/è§£ç­”ï¼‰ | NULL |
| `error_type` | String(50) | é”™è¯¯ç±»å‹ï¼ˆæœªä½œç­”/è®¡ç®—é”™è¯¯/æ¦‚å¿µé”™è¯¯ï¼‰ | NULL |

**è¿ç§»è„šæœ¬** (`alembic/versions/xxx_add_mistake_fields.py`)ï¼š

```python
"""add mistake fields for homework correction

Revision ID: xxx
Revises: yyy
Create Date: 2025-11-07

"""
from alembic import op
import sqlalchemy as sa

# revision identifiers
revision = 'xxx'
down_revision = 'yyy'  # æ›¿æ¢ä¸ºå½“å‰æœ€æ–°ç‰ˆæœ¬å·
branch_labels = None
depends_on = None


def upgrade():
    """æ–°å¢å­—æ®µ"""
    op.add_column('mistake_records', 
        sa.Column('question_number', sa.Integer(), nullable=True,
                  comment='é¢˜å·ï¼ˆæ¥è‡ªæ‰¹æ”¹ç»“æœï¼‰'))
    
    op.add_column('mistake_records',
        sa.Column('is_unanswered', sa.Boolean(), 
                  server_default='false', nullable=False,
                  comment='æ˜¯å¦æœªä½œç­”'))
    
    op.add_column('mistake_records',
        sa.Column('question_type', sa.String(20), nullable=True,
                  comment='é¢˜ç›®ç±»å‹ï¼ˆé€‰æ‹©/å¡«ç©º/è§£ç­”ï¼‰'))
    
    op.add_column('mistake_records',
        sa.Column('error_type', sa.String(50), nullable=True,
                  comment='é”™è¯¯ç±»å‹ï¼ˆæœªä½œç­”/è®¡ç®—é”™è¯¯ç­‰ï¼‰'))
    
    # åˆ›å»ºç´¢å¼•ï¼ˆä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼‰
    op.create_index('idx_mistake_question_number', 
                   'mistake_records', 
                   ['source_question_id', 'question_number'])


def downgrade():
    """å›æ»š"""
    op.drop_index('idx_mistake_question_number', 
                  table_name='mistake_records')
    op.drop_column('mistake_records', 'error_type')
    op.drop_column('mistake_records', 'question_type')
    op.drop_column('mistake_records', 'is_unanswered')
    op.drop_column('mistake_records', 'question_number')
```

**æ‰§è¡Œè¿ç§»**ï¼š

```bash
# 1. åˆ›å»ºè¿ç§»æ–‡ä»¶
cd /opt/wuhao-tutor
source .venv/bin/activate
alembic revision -m "add_mistake_fields_for_homework_correction"

# 2. ç¼–è¾‘ç”Ÿæˆçš„æ–‡ä»¶ï¼ˆå¤åˆ¶ä¸Šé¢çš„ä»£ç ï¼‰
vim alembic/versions/xxx_add_mistake_fields.py

# 3. æ‰§è¡Œè¿ç§»ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
alembic upgrade head

# 4. éªŒè¯
sqlite3 wuhao_tutor_dev.db "PRAGMA table_info(mistake_records);"
# æˆ– PostgreSQL: \d mistake_records

# 5. ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œï¼ˆéƒ¨ç½²æ—¶ï¼‰
# åœ¨ deploy.sh ä¸­ä¼šè‡ªåŠ¨æ‰§è¡Œ
```

### 3.2 æ•°æ®æ¨¡å‹æ›´æ–°

**æ–‡ä»¶**: `src/models/study.py`

```python
class MistakeRecord(BaseModel):
    """é”™é¢˜è®°å½•æ¨¡å‹"""
    
    __tablename__ = "mistake_records"
    
    # ... ç°æœ‰å­—æ®µ ...
    
    # ğŸ†• æ–°å¢å­—æ®µï¼ˆæ‰¹æ”¹ç›¸å…³ï¼‰
    question_number = Column(
        Integer, 
        nullable=True, 
        comment="é¢˜å·ï¼ˆæ¥è‡ªæ‰¹æ”¹ç»“æœï¼Œä»1å¼€å§‹ï¼‰"
    )
    
    is_unanswered = Column(
        Boolean, 
        default=False, 
        nullable=False,
        comment="æ˜¯å¦æœªä½œç­”ï¼ˆåŒºåˆ†äºç­”é”™ï¼‰"
    )
    
    question_type = Column(
        String(20), 
        nullable=True,
        comment="é¢˜ç›®ç±»å‹ï¼ˆé€‰æ‹©é¢˜/å¡«ç©ºé¢˜/è§£ç­”é¢˜/åˆ¤æ–­é¢˜ï¼‰"
    )
    
    error_type = Column(
        String(50), 
        nullable=True,
        comment="é”™è¯¯ç±»å‹ï¼ˆæœªä½œç­”/è®¡ç®—é”™è¯¯/æ¦‚å¿µé”™è¯¯/ç²—å¿ƒå¤§æ„ï¼‰"
    )
    
    # ç´¢å¼•
    __table_args__ = (
        Index('idx_mistake_question_number', 
              'source_question_id', 'question_number'),
        {"sqlite_autoincrement": True} if is_sqlite else {},
    )
```

---

## å››ã€åç«¯å®ç°

### 4.1 AI Prompt è®¾è®¡

**æ–‡ä»¶**: `src/services/learning_service.py`

åœ¨ç±»çš„é¡¶éƒ¨æ·»åŠ å¸¸é‡ï¼š

```python
# ä½œä¸šæ‰¹æ”¹ä¸“ç”¨ System Prompt
HOMEWORK_CORRECTION_PROMPT = """ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„K12ä½œä¸šæ‰¹æ”¹è€å¸ˆï¼Œæ“…é•¿{subject}å­¦ç§‘ã€‚

**ä»»åŠ¡**ï¼šåˆ†æå›¾ç‰‡ä¸­çš„æ‰€æœ‰é¢˜ç›®ï¼Œé€é¢˜æ‰¹æ”¹ã€‚

**æ‰¹æ”¹æ­¥éª¤**ï¼š
1. è¯†åˆ«æ‰€æœ‰é¢˜ç›®ï¼ˆé¢˜å·ã€é¢˜å¹²ã€é¢˜ç›®ç±»å‹ï¼‰
2. è¯†åˆ«å­¦ç”Ÿçš„ç­”æ¡ˆï¼ˆæ‰‹å†™/é€‰æ‹©/å¡«ç©ºï¼‰
3. åˆ¤æ–­æ¯é“é¢˜çš„çŠ¶æ€ï¼š
   - æœªä½œç­”ï¼šå­¦ç”Ÿæ²¡æœ‰å†™ç­”æ¡ˆ
   - ç­”é”™ï¼šå­¦ç”Ÿç­”æ¡ˆä¸æ­£ç¡®ç­”æ¡ˆä¸ç¬¦
   - ç­”å¯¹ï¼šå­¦ç”Ÿç­”æ¡ˆæ­£ç¡®
4. ç»™å‡ºæ­£ç¡®ç­”æ¡ˆå’Œè¯¦ç»†è§£æ
5. æå–2-5ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹

**é‡è¦è§„åˆ™**ï¼š
- æ•°å­¦é¢˜ï¼šå…³æ³¨è®¡ç®—æ­¥éª¤å’Œæœ€ç»ˆç»“æœ
- å®¹é”™ï¼šå¦‚å­¦ç”Ÿç­”æ¡ˆæ¨¡ç³Šï¼Œæ ‡æ³¨"ç­”æ¡ˆä¸æ¸…æ™°"
- å¦‚å›¾ç‰‡ä¸æ¸…æ™°æ— æ³•è¯†åˆ«ï¼Œè¿”å› error="image_unclear"

**è¾“å‡ºæ ¼å¼**ï¼šä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼Œä¸è¦æ·»åŠ å…¶ä»–æ–‡å­—ï¼š

```json
{{
  "questions": [
    {{
      "number": 1,
      "type": "é€‰æ‹©é¢˜",
      "question_text": "é¢˜ç›®åŸæ–‡ï¼ˆå»é™¤é¢˜å·ï¼‰",
      "student_answer": "A",
      "is_answered": true,
      "is_correct": false,
      "correct_answer": "B",
      "explanation": "è¯¦ç»†è§£æï¼ˆåŒ…å«è§£é¢˜æ€è·¯ï¼‰",
      "knowledge_points": ["äºŒæ¬¡å‡½æ•°", "å›¾åƒå¹³ç§»"],
      "difficulty": 2,
      "error_type": "æ¦‚å¿µé”™è¯¯"
    }}
  ],
  "summary": {{
    "total": 10,
    "correct": 7,
    "wrong": 2,
    "unanswered": 1
  }}
}}
```

**error_type å¯é€‰å€¼**ï¼š
- "æœªä½œç­”"ï¼šå­¦ç”Ÿæœªç­”é¢˜
- "è®¡ç®—é”™è¯¯"ï¼šæ­¥éª¤æ­£ç¡®ä½†è®¡ç®—å‡ºé”™
- "æ¦‚å¿µé”™è¯¯"ï¼šå¯¹çŸ¥è¯†ç‚¹ç†è§£æœ‰è¯¯
- "ç²—å¿ƒå¤§æ„"ï¼šé¢˜ç›®çœ‹é”™æˆ–æŠ„é”™
- "æ–¹æ³•é”™è¯¯"ï¼šè§£é¢˜æ€è·¯ä¸å¯¹
"""
```

### 4.2 æ ¸å¿ƒæ–¹æ³•å®ç°

#### 4.2.1 åˆ¤æ–­æ˜¯å¦ä¸ºä½œä¸šæ‰¹æ”¹åœºæ™¯

åœ¨ `LearningService` ç±»ä¸­æ·»åŠ ï¼š

```python
def _is_homework_correction_scenario(
    self, 
    content: str, 
    image_urls: Optional[List[str]]
) -> bool:
    """
    åˆ¤æ–­æ˜¯å¦ä¸ºä½œä¸šæ‰¹æ”¹åœºæ™¯
    
    è§„åˆ™ï¼š
    1. æœ‰å›¾ç‰‡ä¸Šä¼ ï¼ˆâ‰¥1å¼ ï¼‰
    2. ç”¨æˆ·è¾“å…¥ç®€çŸ­ï¼ˆâ‰¤50å­—ï¼‰æˆ–åŒ…å«æ‰¹æ”¹å…³é”®è¯
    
    Args:
        content: ç”¨æˆ·è¾“å…¥æ–‡æœ¬
        image_urls: ä¸Šä¼ çš„å›¾ç‰‡URLåˆ—è¡¨
    
    Returns:
        bool: æ˜¯å¦ä¸ºä½œä¸šæ‰¹æ”¹åœºæ™¯
    """
    # è§„åˆ™1ï¼šå¿…é¡»æœ‰å›¾ç‰‡
    if not image_urls or len(image_urls) == 0:
        return False
    
    # è§„åˆ™2ï¼šç”¨æˆ·è¾“å…¥å¾ˆç®€çŸ­ï¼ˆå¯èƒ½åªæ˜¯"å¸®æˆ‘çœ‹çœ‹"ï¼‰
    if len(content.strip()) <= 50:
        return True
    
    # è§„åˆ™3ï¼šåŒ…å«æ‰¹æ”¹å…³é”®è¯
    correction_keywords = [
        "æ‰¹æ”¹", "ä½œä¸š", "ç­”æ¡ˆ", "å¯¹ä¸å¯¹", "åšçš„å¯¹å—",
        "æ£€æŸ¥", "çœ‹çœ‹å¯¹ä¸", "å¸®æˆ‘çœ‹", "å¸®æˆ‘æ‰¹æ”¹",
        "è¿™äº›é¢˜", "è¿™é“é¢˜", "åšé”™", "é”™äº†å—"
    ]
    
    if any(keyword in content for keyword in correction_keywords):
        return True
    
    return False
```

#### 4.2.2 è°ƒç”¨ AI æ‰¹æ”¹ä½œä¸š

```python
async def _call_ai_for_homework_correction(
    self,
    image_urls: List[str],
    subject: str,
    user_hint: str = ""
) -> Dict[str, Any]:
    """
    è°ƒç”¨ AI æ‰¹æ”¹ä½œä¸š
    
    Args:
        image_urls: ä½œä¸šå›¾ç‰‡URLåˆ—è¡¨
        subject: å­¦ç§‘
        user_hint: ç”¨æˆ·æç¤ºï¼ˆå¯é€‰ï¼Œå¦‚"è¯·æ‰¹æ”¹è¿™äº›é¢˜"ï¼‰
    
    Returns:
        Dict: æ‰¹æ”¹ç»“æœï¼ˆJSONæ ¼å¼ï¼‰
            {
                "questions": [...],
                "summary": {...}
            }
    
    Raises:
        BailianServiceError: AIè°ƒç”¨å¤±è´¥
        ValidationError: è¿”å›æ ¼å¼é”™è¯¯
    """
    try:
        # 1. æ„å»ºç³»ç»Ÿæç¤ºè¯
        system_prompt = HOMEWORK_CORRECTION_PROMPT.format(subject=subject)
        
        # 2. æ„å»ºç”¨æˆ·æ¶ˆæ¯
        user_content = f"è¯·æ‰¹æ”¹ä»¥ä¸‹{subject}ä½œä¸šï¼ˆå…±{len(image_urls)}å¼ å›¾ç‰‡ï¼‰"
        if user_hint:
            user_content += f"\n\nå­¦ç”Ÿè¯´ï¼š{user_hint}"
        
        messages = [
            {"role": "system", "content": system_prompt},
            {
                "role": "user", 
                "content": user_content,
                "image_urls": image_urls
            }
        ]
        
        # 3. è°ƒç”¨ç™¾ç‚¼ API
        logger.info(f"ğŸ¯ å¼€å§‹AIæ‰¹æ”¹: subject={subject}, images={len(image_urls)}")
        
        response = await self.bailian_service.chat_completion(
            messages=messages,
            max_tokens=4000,      # è¶³å¤Ÿé•¿ï¼ˆæ”¯æŒæ‰¹æ”¹å¤šé¢˜ï¼‰
            temperature=0.2,      # ä½éšæœºæ€§ï¼ˆä¿æŒæ‰¹æ”¹ä¸€è‡´æ€§ï¼‰
            top_p=0.9
        )
        
        if not response.success:
            raise BailianServiceError(f"AIæ‰¹æ”¹å¤±è´¥: {response.error_message}")
        
        # 4. è§£æ JSON å“åº”
        try:
            result = json.loads(response.content)
            
            # éªŒè¯å¿…éœ€å­—æ®µ
            if "questions" not in result or "summary" not in result:
                raise ValidationError("AIè¿”å›æ ¼å¼ç¼ºå°‘å¿…éœ€å­—æ®µ")
            
            logger.info(
                f"âœ… AIæ‰¹æ”¹å®Œæˆ: total={result['summary']['total']}, "
                f"correct={result['summary']['correct']}, "
                f"wrong={result['summary']['wrong']}, "
                f"unanswered={result['summary']['unanswered']}"
            )
            
            return result
            
        except json.JSONDecodeError as e:
            logger.error(f"AIè¿”å›çš„JSONè§£æå¤±è´¥: {e}\nå†…å®¹: {response.content[:500]}")
            raise ValidationError("AIæ‰¹æ”¹ç»“æœæ ¼å¼é”™è¯¯")
    
    except Exception as e:
        logger.error(f"AIæ‰¹æ”¹å¤±è´¥: {str(e)}", exc_info=True)
        raise BailianServiceError(f"ä½œä¸šæ‰¹æ”¹å¤±è´¥: {str(e)}") from e
```

#### 4.2.3 é€é¢˜åˆ›å»ºé”™é¢˜è®°å½•

```python
async def _create_mistake_from_question(
    self,
    user_id: str,
    question_id: str,
    question_data: Dict[str, Any],
    subject: str,
    image_urls: List[str]
) -> Optional[MistakeRecord]:
    """
    ä»å•ä¸ªé¢˜ç›®æ•°æ®åˆ›å»ºé”™é¢˜è®°å½•
    
    Args:
        user_id: ç”¨æˆ·ID
        question_id: æ¥æºé—®é¢˜ID
        question_data: AIæ‰¹æ”¹è¿”å›çš„å•é¢˜æ•°æ®
        subject: å­¦ç§‘
        image_urls: ä½œä¸šå›¾ç‰‡URLåˆ—è¡¨ï¼ˆæ•´æ‰¹ï¼Œæœªæ¥å¯æŒ‰é¢˜è£å‰ªï¼‰
    
    Returns:
        MistakeRecord: åˆ›å»ºçš„é”™é¢˜è®°å½•ï¼Œå¦‚æœä¸åº”åˆ›å»ºåˆ™è¿”å›None
    """
    from src.models.study import MistakeRecord
    from src.repositories.base_repository import BaseRepository
    
    # åˆ¤æ–­æ˜¯å¦åº”è¯¥åŠ å…¥é”™é¢˜æœ¬
    is_answered = question_data.get("is_answered", False)
    is_correct = question_data.get("is_correct", False)
    
    # åªæœ‰é”™é¢˜æˆ–æœªä½œç­”çš„é¢˜æ‰åŠ å…¥é”™é¢˜æœ¬
    if is_correct:
        logger.debug(f"é¢˜ç›®{question_data['number']}ç­”å¯¹äº†ï¼Œè·³è¿‡")
        return None
    
    # ç¡®å®šé”™è¯¯ç±»å‹å’Œæ¥æº
    is_unanswered = not is_answered
    error_type = question_data.get("error_type", 
                                   "æœªä½œç­”" if is_unanswered else "ç­”é”™")
    
    # ç¡®å®š source å­—æ®µå€¼
    if is_unanswered:
        source = "learning_empty"  # æœªä½œç­”
    else:
        source = "learning_wrong"  # ç­”é”™
    
    # ç”Ÿæˆé”™é¢˜æ ‡é¢˜
    question_text = question_data.get("question_text", "")
    title = self._generate_mistake_title_from_text(
        question_text, 
        question_number=question_data.get("number")
    )
    
    # æå–çŸ¥è¯†ç‚¹
    knowledge_points = question_data.get("knowledge_points", [])
    
    # æ„å»º AI åé¦ˆæ•°æ®
    ai_feedback = {
        "correction_mode": True,  # æ ‡è®°ä¸ºæ‰¹æ”¹æ¨¡å¼
        "question_number": question_data.get("number"),
        "question_type": question_data.get("type"),
        "is_correct": is_correct,
        "is_answered": is_answered,
        "error_type": error_type,
        "difficulty": question_data.get("difficulty", 2),
        "explanation": question_data.get("explanation", ""),
        "knowledge_points": knowledge_points,
        "auto_created_at": datetime.now().isoformat()
    }
    
    # æ„å»ºé”™é¢˜æ•°æ®
    mistake_data = {
        "user_id": user_id,
        "source": source,
        "source_question_id": question_id,
        # åŸºæœ¬ä¿¡æ¯
        "subject": subject,
        "title": title,
        "ocr_text": question_text,  # å•é¢˜å†…å®¹
        "image_urls": json.dumps(image_urls),  # æ•´æ‰¹å›¾ç‰‡ï¼ˆæœªæ¥ä¼˜åŒ–å¯è£å‰ªï¼‰
        # ğŸ†• æ‰¹æ”¹ç›¸å…³å­—æ®µ
        "question_number": question_data.get("number"),
        "question_type": question_data.get("type"),
        "is_unanswered": is_unanswered,
        "error_type": error_type,
        # ç­”æ¡ˆ
        "student_answer": question_data.get("student_answer"),
        "correct_answer": question_data.get("correct_answer", ""),
        # AI åˆ†æ
        "ai_feedback": json.dumps(ai_feedback),
        "knowledge_points": knowledge_points,
        # å¤ä¹ è®¡åˆ’
        "mastery_status": "learning",
        "next_review_at": datetime.now() + timedelta(days=1),
        "review_count": 0,
        "correct_count": 0,
        "difficulty_level": question_data.get("difficulty", 2)
    }
    
    # åˆ›å»ºé”™é¢˜è®°å½•
    mistake_repo = BaseRepository(MistakeRecord, self.db)
    mistake = await mistake_repo.create(mistake_data)
    
    logger.info(
        f"âœ… åˆ›å»ºé”™é¢˜æˆåŠŸ: id={mistake.id}, number={question_data['number']}, "
        f"type={error_type}"
    )
    
    # ğŸ”— è§¦å‘çŸ¥è¯†ç‚¹å…³è”
    try:
        mistake_id = (
            mistake.id if hasattr(mistake, "id") 
            else UUID(extract_orm_uuid_str(mistake, "id"))
        )
        await self._trigger_knowledge_association(
            mistake_id=mistake_id,
            user_id=UUID(user_id),
            subject=subject,
            ocr_text=question_text,
            ai_feedback=ai_feedback
        )
        logger.info(f"ğŸ”— çŸ¥è¯†ç‚¹å…³è”å·²è§¦å‘: mistake_id={mistake_id}")
    except Exception as e:
        logger.warning(f"çŸ¥è¯†ç‚¹å…³è”å¤±è´¥ï¼Œä½†ä¸å½±å“é”™é¢˜åˆ›å»º: {e}")
    
    return mistake


def _generate_mistake_title_from_text(
    self, 
    question_text: str, 
    question_number: Optional[int] = None
) -> str:
    """
    ä»é¢˜ç›®æ–‡æœ¬ç”Ÿæˆé”™é¢˜æ ‡é¢˜
    
    è§„åˆ™ï¼š
    - å¦‚æœæœ‰é¢˜å·ï¼Œæ ¼å¼ä¸º "ç¬¬Né¢˜: å‰20å­—..."
    - å¦‚æœæ²¡é¢˜å·ï¼Œæ ¼å¼ä¸º "å‰30å­—..."
    - æœ€é•¿50å­—
    """
    # æ¸…ç†æ–‡æœ¬
    text = question_text.strip()
    text = text.replace("\n", " ")
    
    # ç”Ÿæˆæ ‡é¢˜
    if question_number:
        prefix = f"ç¬¬{question_number}é¢˜: "
        max_len = 50 - len(prefix)
        title = prefix + (text[:max_len] + "..." if len(text) > max_len else text)
    else:
        max_len = 50
        title = text[:max_len] + ("..." if len(text) > max_len else "")
    
    return title
```

#### 4.2.4 ä¸»æµç¨‹é›†æˆ

ä¿®æ”¹ `ask_question` æ–¹æ³•ï¼š

```python
async def ask_question(
    self, user_id: str, request: AskQuestionRequest
) -> AskQuestionResponse:
    """
    æé—®åŠŸèƒ½ï¼ˆå·²ä¼˜åŒ–æ”¯æŒä½œä¸šæ‰¹æ”¹ï¼‰
    """
    start_time = time.time()

    try:
        # 1. è·å–æˆ–åˆ›å»ºä¼šè¯
        session = await self._get_or_create_session(user_id, request)

        # 2. ä¿å­˜é—®é¢˜
        question = await self._save_question(
            user_id, extract_orm_uuid_str(session, "id"), request
        )

        # ğŸ¯ 3. åˆ¤æ–­æ˜¯å¦ä¸ºä½œä¸šæ‰¹æ”¹åœºæ™¯
        is_homework = self._is_homework_correction_scenario(
            request.content or "", 
            request.image_urls
        )
        
        correction_result = None
        created_mistakes = []
        
        if is_homework:
            logger.info("ğŸ¯ æ£€æµ‹åˆ°ä½œä¸šæ‰¹æ”¹åœºæ™¯ï¼Œå¯ç”¨æ‰¹æ”¹æ¨¡å¼")
            
            # 3.1 è°ƒç”¨ AI æ‰¹æ”¹
            try:
                subject = extract_orm_str(question, "subject") or "æ•°å­¦"
                correction_data = await self._call_ai_for_homework_correction(
                    image_urls=request.image_urls,
                    subject=subject,
                    user_hint=request.content or ""
                )
                
                # 3.2 é€é¢˜åˆ›å»ºé”™é¢˜è®°å½•ï¼ˆä»…é”™é¢˜/æœªä½œç­”ï¼‰
                question_id = extract_orm_uuid_str(question, "id")
                for q_data in correction_data["questions"]:
                    mistake = await self._create_mistake_from_question(
                        user_id=user_id,
                        question_id=question_id,
                        question_data=q_data,
                        subject=subject,
                        image_urls=request.image_urls
                    )
                    if mistake:
                        created_mistakes.append(mistake)
                
                # 3.3 ç”Ÿæˆå‹å¥½çš„ AI å›ç­”ï¼ˆåŸºäºæ‰¹æ”¹ç»“æœï¼‰
                ai_answer_content = self._generate_correction_summary(
                    correction_data, 
                    len(created_mistakes)
                )
                
                # ä¿å­˜ AI å›ç­”
                answer = await self.answer_repo.create({
                    "question_id": question_id,
                    "content": ai_answer_content,
                    "tokens_used": 0,  # å·²åœ¨æ‰¹æ”¹æ—¶ä½¿ç”¨
                    "processing_time": int((time.time() - start_time) * 1000)
                })
                
                # æ„å»ºæ‰¹æ”¹ç»“æœå“åº”
                correction_result = {
                    "mode": "homework_correction",
                    "summary": correction_data["summary"],
                    "questions": correction_data["questions"],
                    "mistakes_created": len(created_mistakes),
                    "mistakes": [
                        {
                            "id": str(m.id),
                            "number": getattr(m, "question_number"),
                            "type": getattr(m, "error_type")
                        }
                        for m in created_mistakes
                    ]
                }
                
            except Exception as correction_err:
                logger.error(f"ä½œä¸šæ‰¹æ”¹å¤±è´¥ï¼Œé™çº§åˆ°æ™®é€šé—®ç­”: {correction_err}")
                # é™çº§ï¼šèµ°æ™®é€šé—®ç­”æµç¨‹
                is_homework = False
        
        # 4. å¦‚æœä¸æ˜¯ä½œä¸šæ‰¹æ”¹ï¼ˆæˆ–æ‰¹æ”¹å¤±è´¥é™çº§ï¼‰ï¼Œèµ°åŸæœ‰æµç¨‹
        if not is_homework:
            # ... åŸæœ‰é€»è¾‘ï¼ˆAIä¸Šä¸‹æ–‡ã€æ¶ˆæ¯æ„å»ºã€chat_completionç­‰ï¼‰
            # ä¿æŒä¸å˜ï¼Œè¿™é‡Œçœç•¥
            pass
        
        # 5. æ›´æ–°ä¼šè¯ç»Ÿè®¡
        await self._update_session_stats(
            extract_orm_uuid_str(session, "id"), 
            0  # tokens_used
        )
        
        # 6. æ„å»ºå“åº”
        processing_time = int((time.time() - start_time) * 1000)
        
        return AskQuestionResponse(
            question=QuestionResponse.model_validate(question),
            answer=AnswerResponse.model_validate(answer),
            session=SessionResponse.model_validate(session),
            processing_time=processing_time,
            tokens_used=0,
            # ğŸ†• æ‰¹æ”¹ç»“æœ
            correction_result=correction_result,
            mistake_created=len(created_mistakes) > 0,
            mistake_info={
                "count": len(created_mistakes),
                "ids": [str(m.id) for m in created_mistakes]
            } if created_mistakes else None
        )

    except Exception as e:
        logger.error(f"æé—®å¤„ç†å¤±è´¥: {str(e)}", exc_info=True)
        raise ServiceError(f"æé—®å¤„ç†å¤±è´¥: {str(e)}") from e


def _generate_correction_summary(
    self, 
    correction_data: Dict[str, Any],
    mistakes_count: int
) -> str:
    """
    ç”Ÿæˆæ‰¹æ”¹ç»“æœæ‘˜è¦ï¼ˆç”¨äºAIå›ç­”ï¼‰
    """
    summary = correction_data["summary"]
    total = summary["total"]
    correct = summary["correct"]
    wrong = summary["wrong"]
    unanswered = summary["unanswered"]
    
    # ç”Ÿæˆå‹å¥½çš„æ‘˜è¦æ–‡æœ¬
    text = f"## ğŸ“ ä½œä¸šæ‰¹æ”¹å®Œæˆ\n\n"
    text += f"**æ€»è§ˆ**ï¼šå…± {total} é“é¢˜\n"
    text += f"- âœ… æ­£ç¡®ï¼š{correct} é¢˜\n"
    text += f"- âŒ é”™è¯¯ï¼š{wrong} é¢˜\n"
    text += f"- âš ï¸ æœªä½œç­”ï¼š{unanswered} é¢˜\n\n"
    
    if mistakes_count > 0:
        text += f"**å·²åŠ å…¥é”™é¢˜æœ¬**ï¼š{mistakes_count} é“é¢˜éœ€è¦é‡ç‚¹å¤ä¹ \n\n"
    
    # é€é¢˜å±•ç¤ºï¼ˆé”™é¢˜/æœªä½œç­”ï¼‰
    text += "---\n\n"
    for q in correction_data["questions"]:
        if not q["is_correct"]:
            text += f"### ç¬¬ {q['number']} é¢˜\n\n"
            text += f"**é¢˜ç›®**ï¼š{q['question_text']}\n\n"
            
            if q["is_answered"]:
                text += f"**ä½ çš„ç­”æ¡ˆ**ï¼š{q['student_answer']}\n\n"
            else:
                text += f"**çŠ¶æ€**ï¼šæœªä½œç­” âš ï¸\n\n"
            
            text += f"**æ­£ç¡®ç­”æ¡ˆ**ï¼š{q['correct_answer']}\n\n"
            text += f"**è§£æ**ï¼š{q['explanation']}\n\n"
            
            if q.get("knowledge_points"):
                kp_text = "ã€".join(q["knowledge_points"])
                text += f"**çŸ¥è¯†ç‚¹**ï¼š{kp_text}\n\n"
            
            text += "---\n\n"
    
    text += "\nğŸ’¡ ç‚¹å‡»ä¸‹æ–¹æŸ¥çœ‹é”™é¢˜è¯¦æƒ…ï¼Œå¼€å§‹å¤ä¹ å§ï¼"
    
    return text
```

### 4.3 Schema æ›´æ–°

**æ–‡ä»¶**: `src/schemas/learning.py`

åœ¨ `AskQuestionResponse` ä¸­æ–°å¢å­—æ®µï¼š

```python
class AskQuestionResponse(BaseModel):
    """æé—®å“åº”"""
    
    question: QuestionResponse
    answer: AnswerResponse
    session: SessionResponse
    processing_time: int = Field(..., description="å¤„ç†æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰")
    tokens_used: int = Field(default=0, description="ä½¿ç”¨çš„tokenæ•°é‡")
    
    # ğŸ†• æ‰¹æ”¹ç›¸å…³å­—æ®µ
    correction_result: Optional[Dict[str, Any]] = Field(
        None, 
        description="ä½œä¸šæ‰¹æ”¹ç»“æœï¼ˆæ‰¹æ”¹æ¨¡å¼ä¸‹è¿”å›ï¼‰"
    )
    mistake_created: bool = Field(
        default=False, 
        description="æ˜¯å¦åˆ›å»ºäº†é”™é¢˜"
    )
    mistake_info: Optional[Dict[str, Any]] = Field(
        None,
        description="é”™é¢˜ä¿¡æ¯ï¼ˆæ•°é‡ã€IDåˆ—è¡¨ç­‰ï¼‰"
    )

    class Config:
        json_schema_extra = {
            "example": {
                # ... åŸæœ‰ç¤ºä¾‹ ...
                "correction_result": {
                    "mode": "homework_correction",
                    "summary": {
                        "total": 10,
                        "correct": 7,
                        "wrong": 2,
                        "unanswered": 1
                    },
                    "questions": [
                        {
                            "number": 1,
                            "type": "é€‰æ‹©é¢˜",
                            "is_correct": False,
                            # ... æ›´å¤šå­—æ®µ ...
                        }
                    ],
                    "mistakes_created": 3
                }
            }
        }
```

---

## äº”ã€å‰ç«¯å®ç°

### 5.1 æ¶ˆæ¯ç±»å‹æ‰©å±•

**æ–‡ä»¶**: `miniprogram/pages/learning/index/index.js`

åœ¨ `data` ä¸­æ–°å¢ï¼š

```javascript
data: {
  // ... ç°æœ‰å­—æ®µ ...
  
  // ğŸ†• æ‰¹æ”¹ç»“æœ
  showCorrectionResult: false,  // æ˜¾ç¤ºæ‰¹æ”¹ç»“æœå¼¹çª—
  correctionData: null,         // æ‰¹æ”¹ç»“æœæ•°æ®
}
```

### 5.2 å‘é€æ¶ˆæ¯åå¤„ç†å“åº”

ä¿®æ”¹ `sendMessage` æ–¹æ³•ï¼š

```javascript
async sendMessage() {
  // ... ç°æœ‰é€»è¾‘ï¼ˆæ„å»ºè¯·æ±‚ã€è°ƒç”¨APIï¼‰...
  
  try {
    const response = await learningApi.askQuestion({
      session_id: this.data.sessionId,
      content: this.data.inputText.trim(),
      image_urls: aiImageUrls,  // å·²ä¸Šä¼ åˆ°OSSçš„URL
      subject: this.getCurrentSubject(),
      // ... å…¶ä»–å‚æ•°
    });
    
    // ğŸ†• æ£€æŸ¥æ˜¯å¦è¿”å›æ‰¹æ”¹ç»“æœ
    if (response.correction_result) {
      // æ‰¹æ”¹æ¨¡å¼
      this.handleCorrectionResponse(response);
    } else {
      // æ™®é€šé—®ç­”æ¨¡å¼ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
      this.handleNormalResponse(response);
    }
    
  } catch (error) {
    console.error('å‘é€å¤±è´¥:', error);
    this.showError('æ¶ˆæ¯å‘é€å¤±è´¥');
  }
}
```

### 5.3 å¤„ç†æ‰¹æ”¹å“åº”

```javascript
/**
 * ğŸ†• å¤„ç†æ‰¹æ”¹å“åº”
 * @param {Object} response - APIå“åº”
 */
handleCorrectionResponse(response) {
  const { correction_result, answer } = response;
  
  // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯ï¼ˆå›¾ç‰‡ï¼‰
  this.addMessage({
    type: 'user',
    content: 'è¯·æ‰¹æ”¹è¿™äº›é¢˜',
    images: this.data.uploadedImages,
    timestamp: Date.now()
  });
  
  // 2. æ·»åŠ æ‰¹æ”¹ç»“æœå¡ç‰‡æ¶ˆæ¯
  this.addMessage({
    type: 'correction_card',
    data: correction_result,
    timestamp: Date.now()
  });
  
  // 3. æ·»åŠ AIè¯¦ç»†å›ç­”ï¼ˆå¯æŠ˜å ï¼‰
  this.addMessage({
    type: 'assistant',
    content: answer.content,
    timestamp: Date.now()
  });
  
  // 4. æ¸…ç©ºè¾“å…¥æ¡†å’Œå›¾ç‰‡
  this.setData({
    inputText: '',
    uploadedImages: [],
    hasInputContent: false
  });
  
  // 5. æ»šåŠ¨åˆ°åº•éƒ¨
  this.scrollToBottom();
  
  // 6. æ˜¾ç¤ºæˆåŠŸæç¤º
  const { summary } = correction_result;
  const mistakesCount = summary.wrong + summary.unanswered;
  
  if (mistakesCount > 0) {
    wx.showToast({
      title: `å·²åŠ å…¥${mistakesCount}é“é”™é¢˜`,
      icon: 'success',
      duration: 2000
    });
  }
}

/**
 * ğŸ†• å¤„ç†æ™®é€šé—®ç­”å“åº”ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
 * @param {Object} response - APIå“åº”
 */
handleNormalResponse(response) {
  const { question, answer } = response;
  
  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  this.addMessage({
    type: 'user',
    content: question.content,
    images: question.image_urls ? JSON.parse(question.image_urls) : [],
    timestamp: Date.now()
  });
  
  // æ·»åŠ AIå›ç­”
  this.addMessage({
    type: 'assistant',
    content: answer.content,
    timestamp: Date.now()
  });
  
  // æ¸…ç©ºè¾“å…¥
  this.setData({
    inputText: '',
    uploadedImages: [],
    hasInputContent: false
  });
  
  this.scrollToBottom();
}
```

### 5.4 æ‰¹æ”¹ç»“æœå¡ç‰‡ç»„ä»¶

**æ–‡ä»¶**: `miniprogram/components/correction-card/index.wxml`

```xml
<view class="correction-card">
  <!-- æ€»è§ˆ -->
  <view class="summary">
    <view class="summary-header">
      <text class="title">ğŸ“ æ‰¹æ”¹å®Œæˆ</text>
      <text class="total">å…± {{data.summary.total}} é¢˜</text>
    </view>
    
    <view class="stats">
      <view class="stat correct">
        <text class="number">{{data.summary.correct}}</text>
        <text class="label">æ­£ç¡®</text>
      </view>
      <view class="stat wrong">
        <text class="number">{{data.summary.wrong}}</text>
        <text class="label">é”™è¯¯</text>
      </view>
      <view class="stat unanswered">
        <text class="number">{{data.summary.unanswered}}</text>
        <text class="label">æœªä½œç­”</text>
      </view>
    </view>
  </view>
  
  <!-- é€é¢˜åˆ—è¡¨ï¼ˆä»…æ˜¾ç¤ºé”™é¢˜/æœªä½œç­”ï¼‰ -->
  <view class="questions-list">
    <block wx:for="{{wrongQuestions}}" wx:key="number">
      <view class="question-item" bindtap="onQuestionTap" data-index="{{index}}">
        <view class="question-header">
          <view class="number-badge">ç¬¬{{item.number}}é¢˜</view>
          <view class="status {{item.is_answered ? 'wrong' : 'unanswered'}}">
            {{item.is_answered ? 'ç­”é”™' : 'æœªä½œç­”'}}
          </view>
        </view>
        
        <view class="question-preview">
          <text class="text">{{item.question_text}}</text>
        </view>
        
        <view class="arrow">
          <van-icon name="arrow" size="16px" color="#999" />
        </view>
      </view>
    </block>
  </view>
  
  <!-- æ“ä½œæŒ‰é’® -->
  <view class="actions">
    <button 
      class="btn-view-mistakes" 
      bindtap="onViewAllMistakes"
    >
      æŸ¥çœ‹é”™é¢˜æœ¬ ({{data.mistakes_created}})
    </button>
  </view>
</view>
```

**æ–‡ä»¶**: `miniprogram/components/correction-card/index.js`

```javascript
Component({
  properties: {
    data: {
      type: Object,
      value: {}
    }
  },
  
  data: {
    wrongQuestions: []  // è¿‡æ»¤åçš„é”™é¢˜/æœªä½œç­”é¢˜
  },
  
  lifetimes: {
    attached() {
      this.filterWrongQuestions();
    }
  },
  
  observers: {
    'data': function(newData) {
      this.filterWrongQuestions();
    }
  },
  
  methods: {
    // è¿‡æ»¤å‡ºé”™é¢˜å’Œæœªä½œç­”é¢˜
    filterWrongQuestions() {
      const { questions } = this.data.data;
      if (!questions) return;
      
      const wrongQuestions = questions.filter(q => !q.is_correct);
      this.setData({ wrongQuestions });
    },
    
    // ç‚¹å‡»å•é¢˜
    onQuestionTap(e) {
      const { index } = e.currentTarget.dataset;
      const question = this.data.wrongQuestions[index];
      
      // æ˜¾ç¤ºé¢˜ç›®è¯¦æƒ…å¼¹çª—
      this.triggerEvent('questiontap', { question });
    },
    
    // æŸ¥çœ‹å…¨éƒ¨é”™é¢˜
    onViewAllMistakes() {
      wx.navigateTo({
        url: '/pages/mistakes/list/index'
      });
    }
  }
});
```

**æ–‡ä»¶**: `miniprogram/components/correction-card/index.wxss`

```css
.correction-card {
  background: #fff;
  border-radius: 12px;
  padding: 16px;
  margin: 12px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

/* æ€»è§ˆåŒºåŸŸ */
.summary {
  margin-bottom: 16px;
}

.summary-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.summary-header .title {
  font-size: 16px;
  font-weight: bold;
  color: #333;
}

.summary-header .total {
  font-size: 14px;
  color: #666;
}

/* ç»Ÿè®¡æ•°å­— */
.stats {
  display: flex;
  justify-content: space-around;
  padding: 16px 0;
  background: #f5f7fa;
  border-radius: 8px;
}

.stat {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.stat .number {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 4px;
}

.stat.correct .number { color: #52c41a; }
.stat.wrong .number { color: #ff4d4f; }
.stat.unanswered .number { color: #faad14; }

.stat .label {
  font-size: 12px;
  color: #999;
}

/* é¢˜ç›®åˆ—è¡¨ */
.questions-list {
  margin-top: 16px;
}

.question-item {
  display: flex;
  align-items: center;
  padding: 12px;
  background: #fafafa;
  border-radius: 8px;
  margin-bottom: 8px;
}

.question-header {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
}

.number-badge {
  font-size: 14px;
  font-weight: bold;
  color: #1890ff;
  margin-right: 8px;
}

.status {
  font-size: 12px;
  padding: 2px 8px;
  border-radius: 4px;
}

.status.wrong {
  background: #fff1f0;
  color: #ff4d4f;
}

.status.unanswered {
  background: #fffbe6;
  color: #faad14;
}

.question-preview {
  flex: 1;
  margin-right: 12px;
}

.question-preview .text {
  font-size: 14px;
  color: #333;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

/* æ“ä½œæŒ‰é’® */
.actions {
  margin-top: 16px;
  padding-top: 16px;
  border-top: 1px solid #f0f0f0;
}

.btn-view-mistakes {
  width: 100%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 15px;
  padding: 12px;
}
```

### 5.5 åœ¨æ¶ˆæ¯åˆ—è¡¨ä¸­é›†æˆ

**æ–‡ä»¶**: `miniprogram/pages/learning/index/index.wxml`

åœ¨æ¶ˆæ¯æ¸²æŸ“éƒ¨åˆ†æ·»åŠ ï¼š

```xml
<!-- æ¶ˆæ¯åˆ—è¡¨ -->
<scroll-view 
  class="chat-messages"
  scroll-y="{{true}}"
  bindscroll="onScrollOptimized"
>
  <block wx:for="{{messageList}}" wx:key="id">
    <!-- ç”¨æˆ·æ¶ˆæ¯ -->
    <view wx:if="{{item.type === 'user'}}" class="message user-message">
      <!-- ... åŸæœ‰é€»è¾‘ ... -->
    </view>
    
    <!-- AIå›ç­” -->
    <view wx:elif="{{item.type === 'assistant'}}" class="message ai-message">
      <!-- ... åŸæœ‰é€»è¾‘ ... -->
    </view>
    
    <!-- ğŸ†• æ‰¹æ”¹ç»“æœå¡ç‰‡ -->
    <view wx:elif="{{item.type === 'correction_card'}}" class="message">
      <correction-card 
        data="{{item.data}}"
        bind:questiontap="onCorrectionQuestionTap"
      />
    </view>
  </block>
</scroll-view>
```

åœ¨ `index.js` ä¸­æ·»åŠ äº‹ä»¶å¤„ç†ï¼š

```javascript
/**
 * ğŸ†• ç‚¹å‡»æ‰¹æ”¹ç»“æœä¸­çš„æŸé“é¢˜
 */
onCorrectionQuestionTap(e) {
  const { question } = e.detail;
  
  // æ˜¾ç¤ºé¢˜ç›®è¯¦æƒ…å¼¹çª—ï¼ˆåŒ…å«å®Œæ•´è§£æï¼‰
  wx.showModal({
    title: `ç¬¬${question.number}é¢˜`,
    content: `${question.question_text}\n\nã€æ­£ç¡®ç­”æ¡ˆã€‘\n${question.correct_answer}\n\nã€è§£æã€‘\n${question.explanation}`,
    confirmText: 'æŸ¥çœ‹é”™é¢˜',
    cancelText: 'å…³é—­',
    success: (res) => {
      if (res.confirm) {
        // è·³è½¬åˆ°é”™é¢˜è¯¦æƒ…ï¼ˆå¦‚æœå·²åŠ å…¥é”™é¢˜æœ¬ï¼‰
        // éœ€è¦ä» mistakes æ•°ç»„ä¸­æ‰¾åˆ°å¯¹åº”çš„ mistake_id
        const mistakes = this.data.correctionData?.mistakes || [];
        const mistake = mistakes.find(m => m.number === question.number);
        
        if (mistake) {
          wx.navigateTo({
            url: `/pages/mistakes/detail/index?id=${mistake.id}`
          });
        } else {
          wx.showToast({
            title: 'è¯¥é¢˜æœªåŠ å…¥é”™é¢˜æœ¬',
            icon: 'none'
          });
        }
      }
    }
  });
}
```

---

## å…­ã€å¼€å‘è®¡åˆ’

### Week 1ï¼šæ•°æ®åº“ä¸åç«¯åŸºç¡€ï¼ˆ5å¤©ï¼‰

#### Day 1-2ï¼šæ•°æ®åº“æ”¹åŠ¨
- [ ] ç¼–å†™ Alembic è¿ç§»è„šæœ¬ï¼ˆ`xxx_add_mistake_fields.py`ï¼‰
- [ ] åœ¨å¼€å‘ç¯å¢ƒæ‰§è¡Œè¿ç§»å¹¶éªŒè¯
- [ ] æ›´æ–° `src/models/study.py`ï¼ˆMistakeRecord æ¨¡å‹ï¼‰
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆæµ‹è¯•æ–°å­—æ®µçš„å¢åˆ æ”¹æŸ¥ï¼‰

**äº¤ä»˜ç‰©**ï¼š
- è¿ç§»è„šæœ¬æ–‡ä»¶
- æµ‹è¯•é€šè¿‡æˆªå›¾
- æ•°æ®è¡¨ç»“æ„æ–‡æ¡£ï¼ˆMarkdownï¼‰

#### Day 3-4ï¼šAI Prompt ä¸è°ƒç”¨æ–¹æ³•
- [ ] åœ¨ `learning_service.py` æ·»åŠ  `HOMEWORK_CORRECTION_PROMPT`
- [ ] å®ç° `_call_ai_for_homework_correction` æ–¹æ³•
- [ ] ç¼–å†™ Prompt æµ‹è¯•è„šæœ¬ï¼ˆæµ‹è¯•å¤šç§åœºæ™¯ï¼‰
  - å•é¢˜/å¤šé¢˜
  - é€‰æ‹©é¢˜/å¡«ç©ºé¢˜/è§£ç­”é¢˜
  - æœ‰ç­”æ¡ˆ/æ— ç­”æ¡ˆ
- [ ] è°ƒæ•´ Prompt ç›´åˆ°å‡†ç¡®ç‡ >90%

**äº¤ä»˜ç‰©**ï¼š
- Prompt æµ‹è¯•æŠ¥å‘Šï¼ˆExcelè¡¨æ ¼ï¼Œè®°å½•10+æµ‹è¯•ç”¨ä¾‹ï¼‰
- AI è¿”å›çš„ JSON ç¤ºä¾‹ï¼ˆä¿å­˜ä¸º `docs/examples/correction_response.json`ï¼‰

#### Day 5ï¼šåœºæ™¯åˆ¤æ–­ä¸æµç¨‹é›†æˆ
- [ ] å®ç° `_is_homework_correction_scenario` æ–¹æ³•
- [ ] ä¿®æ”¹ `ask_question` ä¸»æµç¨‹ï¼ˆæ·»åŠ åˆ†æ”¯åˆ¤æ–­ï¼‰
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆæµ‹è¯•åˆ¤æ–­é€»è¾‘ï¼‰

**äº¤ä»˜ç‰©**ï¼š
- å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›–ç‡ >80%ï¼‰

---

### Week 2ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆ5å¤©ï¼‰

#### Day 6-7ï¼šé€é¢˜åˆ›å»ºé”™é¢˜è®°å½•
- [ ] å®ç° `_create_mistake_from_question` æ–¹æ³•
- [ ] å®ç° `_generate_mistake_title_from_text` æ–¹æ³•
- [ ] å®ç° `_generate_correction_summary` æ–¹æ³•
- [ ] ç¼–å†™é›†æˆæµ‹è¯•ï¼ˆæ¨¡æ‹Ÿå®Œæ•´æ‰¹æ”¹æµç¨‹ï¼‰

**äº¤ä»˜ç‰©**ï¼š
- é›†æˆæµ‹è¯•é€šè¿‡
- é”™é¢˜è®°å½•åˆ›å»ºæˆåŠŸï¼ˆæ•°æ®åº“æˆªå›¾ï¼‰

#### Day 8ï¼šçŸ¥è¯†ç‚¹å…³è”
- [ ] ç¡®è®¤ `_trigger_knowledge_association` æ–¹æ³•å¯ç”¨
- [ ] æµ‹è¯•æ‰¹æ”¹åçš„çŸ¥è¯†ç‚¹å…³è”æ•ˆæœ
- [ ] ä¿®å¤çŸ¥è¯†ç‚¹å…³è”çš„ Bugï¼ˆå¦‚æœ‰ï¼‰

**äº¤ä»˜ç‰©**ï¼š
- çŸ¥è¯†ç‚¹å…³è”æµ‹è¯•æŠ¥å‘Š

#### Day 9-10ï¼šAPI æµ‹è¯•ä¸ä¼˜åŒ–
- [ ] ä½¿ç”¨ Postman æµ‹è¯•å®Œæ•´æµç¨‹
- [ ] æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼š
  - å›¾ç‰‡ä¸æ¸…æ™°
  - é¢˜ç›®æ•°é‡è¿‡å¤šï¼ˆ>10é¢˜ï¼‰
  - AI è¿”å›æ ¼å¼é”™è¯¯
  - ç½‘ç»œè¶…æ—¶
- [ ] æ·»åŠ å¼‚å¸¸å¤„ç†å’Œé™çº§é€»è¾‘
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰

**äº¤ä»˜ç‰©**ï¼š
- Postman æµ‹è¯•é›†åˆï¼ˆå¯¼å‡ºä¸º JSONï¼‰
- æ€§èƒ½æµ‹è¯•æŠ¥å‘Šï¼ˆå“åº”æ—¶é—´ã€å¹¶å‘æ•°ï¼‰

---

### Week 3ï¼šå‰ç«¯å¼€å‘ä¸è”è°ƒï¼ˆ5å¤©ï¼‰

#### Day 11-12ï¼šå‰ç«¯ç»„ä»¶å¼€å‘
- [ ] åˆ›å»º `correction-card` ç»„ä»¶ï¼ˆwxml + js + wxssï¼‰
- [ ] ä¿®æ”¹ `learning/index` é¡µé¢ï¼ˆæ·»åŠ æ‰¹æ”¹é€»è¾‘ï¼‰
- [ ] å®ç° `handleCorrectionResponse` æ–¹æ³•
- [ ] æœ¬åœ°æµ‹è¯•ï¼ˆä½¿ç”¨ mock æ•°æ®ï¼‰

**äº¤ä»˜ç‰©**ï¼š
- ç»„ä»¶ä»£ç 
- æœ¬åœ°æµ‹è¯•æˆªå›¾

#### Day 13ï¼šå‰åç«¯è”è°ƒ
- [ ] å°ç¨‹åºè¿æ¥å¼€å‘ç¯å¢ƒåç«¯
- [ ] æµ‹è¯•å®Œæ•´æµç¨‹ï¼ˆä¸Šä¼ å›¾ç‰‡ â†’ æ‰¹æ”¹ â†’ æ˜¾ç¤ºç»“æœ â†’ æŸ¥çœ‹é”™é¢˜ï¼‰
- [ ] ä¿®å¤è”è°ƒä¸­çš„ Bug

**äº¤ä»˜ç‰©**ï¼š
- è”è°ƒæµ‹è¯•è§†é¢‘ï¼ˆå½•å±ï¼‰

#### Day 14ï¼šæ ·å¼ä¼˜åŒ–ä¸æµ‹è¯•
- [ ] ä¼˜åŒ–æ‰¹æ”¹ç»“æœå¡ç‰‡æ ·å¼ï¼ˆå‚è€ƒä¸»æµæ•™è‚²Appï¼‰
- [ ] æ·»åŠ åŠ è½½åŠ¨ç”»ï¼ˆæ‰¹æ”¹ä¸­æç¤ºï¼‰
- [ ] è¾¹ç•Œæƒ…å†µæµ‹è¯•ï¼ˆæ— ç½‘ç»œã€è¶…æ—¶ç­‰ï¼‰

**äº¤ä»˜ç‰©**ï¼š
- UI æˆªå›¾ï¼ˆå¤šåœºæ™¯ï¼‰
- ç”¨æˆ·ä½“éªŒè¯„åˆ†è¡¨

#### Day 15ï¼šæ–‡æ¡£ä¸ä¸Šçº¿å‡†å¤‡
- [ ] ç¼–å†™ç”¨æˆ·ä½¿ç”¨æ–‡æ¡£ï¼ˆæ›´æ–° `USER_MANUAL.md`ï¼‰
- [ ] ç¼–å†™è¿ç»´æ–‡æ¡£ï¼ˆéƒ¨ç½²æ­¥éª¤ï¼‰
- [ ] å‡†å¤‡ä¸Šçº¿æ£€æŸ¥æ¸…å•
- [ ] ä»£ç å®¡æŸ¥ï¼ˆCode Reviewï¼‰

**äº¤ä»˜ç‰©**ï¼š
- æ›´æ–°åçš„æ–‡æ¡£
- ä¸Šçº¿æ£€æŸ¥æ¸…å•ï¼ˆExcelï¼‰

---

## ä¸ƒã€æµ‹è¯•æ–¹æ¡ˆ

### 7.1 å•å…ƒæµ‹è¯•

**æ–‡ä»¶**: `tests/services/test_learning_service_correction.py`

```python
import pytest
from src.services.learning_service import LearningService

class TestHomeworkCorrection:
    """ä½œä¸šæ‰¹æ”¹åŠŸèƒ½æµ‹è¯•"""
    
    @pytest.mark.asyncio
    async def test_is_homework_correction_scenario(self, db_session):
        """æµ‹è¯•åœºæ™¯åˆ¤æ–­"""
        service = LearningService(db_session)
        
        # æœ‰å›¾ç‰‡ + ç®€çŸ­æ–‡æœ¬ â†’ True
        assert service._is_homework_correction_scenario(
            "å¸®æˆ‘çœ‹çœ‹", 
            ["https://example.com/1.jpg"]
        ) == True
        
        # æ— å›¾ç‰‡ â†’ False
        assert service._is_homework_correction_scenario(
            "è¿™é“é¢˜æ€ä¹ˆåšï¼Ÿ", 
            []
        ) == False
        
        # æœ‰å›¾ç‰‡ + é•¿æ–‡æœ¬ï¼ˆæ— å…³é”®è¯ï¼‰â†’ False
        long_text = "è¯·è¯¦ç»†è§£é‡Šä¸€ä¸‹äºŒæ¬¡å‡½æ•°çš„æ€§è´¨..." * 10
        assert service._is_homework_correction_scenario(
            long_text, 
            ["https://example.com/1.jpg"]
        ) == False
    
    @pytest.mark.asyncio
    async def test_create_mistake_from_question(self, db_session, mock_user):
        """æµ‹è¯•å•é¢˜é”™é¢˜åˆ›å»º"""
        service = LearningService(db_session)
        
        question_data = {
            "number": 1,
            "type": "é€‰æ‹©é¢˜",
            "question_text": "ä¸‹åˆ—å“ªä¸ªæ˜¯è´¨æ•°ï¼Ÿ",
            "student_answer": "A",
            "is_answered": True,
            "is_correct": False,
            "correct_answer": "C",
            "explanation": "è´¨æ•°åªèƒ½è¢«1å’Œè‡ªèº«æ•´é™¤...",
            "knowledge_points": ["è´¨æ•°", "æ•°è®º"],
            "difficulty": 2,
            "error_type": "æ¦‚å¿µé”™è¯¯"
        }
        
        mistake = await service._create_mistake_from_question(
            user_id=str(mock_user.id),
            question_id="test-question-id",
            question_data=question_data,
            subject="æ•°å­¦",
            image_urls=["https://example.com/1.jpg"]
        )
        
        assert mistake is not None
        assert mistake.question_number == 1
        assert mistake.is_unanswered == False
        assert mistake.error_type == "æ¦‚å¿µé”™è¯¯"
        assert mistake.source == "learning_wrong"
```

**è¿è¡Œæµ‹è¯•**ï¼š

```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
pytest tests/services/test_learning_service_correction.py -v

# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆå¸¦è¦†ç›–ç‡ï¼‰
pytest --cov=src/services/learning_service --cov-report=html
```

### 7.2 é›†æˆæµ‹è¯•

**æ–‡ä»¶**: `tests/integration/test_homework_correction_flow.py`

```python
import pytest
from httpx import AsyncClient

@pytest.mark.asyncio
async def test_homework_correction_full_flow(
    async_client: AsyncClient,
    mock_user,
    mock_image_urls
):
    """æµ‹è¯•å®Œæ•´æ‰¹æ”¹æµç¨‹"""
    
    # 1. ç™»å½•è·å– token
    login_response = await async_client.post("/api/v1/auth/login", json={
        "phone": mock_user.phone,
        "password": "test123"
    })
    token = login_response.json()["access_token"]
    
    # 2. æäº¤ä½œä¸šæ‰¹æ”¹è¯·æ±‚
    response = await async_client.post(
        "/api/v1/learning/ask",
        headers={"Authorization": f"Bearer {token}"},
        json={
            "content": "è¯·æ‰¹æ”¹è¿™äº›é¢˜",
            "image_urls": mock_image_urls,
            "subject": "æ•°å­¦"
        }
    )
    
    assert response.status_code == 200
    data = response.json()
    
    # 3. éªŒè¯å“åº”åŒ…å«æ‰¹æ”¹ç»“æœ
    assert "correction_result" in data
    correction = data["correction_result"]
    
    assert correction["mode"] == "homework_correction"
    assert "summary" in correction
    assert correction["summary"]["total"] > 0
    
    # 4. éªŒè¯é”™é¢˜å·²åˆ›å»º
    assert data["mistake_created"] == True
    assert data["mistake_info"]["count"] > 0
    
    # 5. æŸ¥è¯¢é”™é¢˜æœ¬ï¼Œç¡®è®¤è®°å½•å­˜åœ¨
    mistakes_response = await async_client.get(
        "/api/v1/mistakes",
        headers={"Authorization": f"Bearer {token}"}
    )
    
    mistakes = mistakes_response.json()["items"]
    assert len(mistakes) > 0
    
    # éªŒè¯ç¬¬ä¸€æ¡é”™é¢˜çš„å­—æ®µ
    mistake = mistakes[0]
    assert mistake["question_number"] is not None
    assert mistake["source"] in ["learning_wrong", "learning_empty"]
```

### 7.3 Prompt æµ‹è¯•

**æ–‡ä»¶**: `scripts/test_correction_prompt.py`

```python
"""
æµ‹è¯•æ‰¹æ”¹ Prompt çš„å‡†ç¡®ç‡
è¿è¡Œ: python scripts/test_correction_prompt.py
"""

import asyncio
import json
from src.services.bailian_service import BailianService

# æµ‹è¯•ç”¨ä¾‹ï¼ˆçœŸå®ä½œä¸šå›¾ç‰‡ï¼‰
TEST_CASES = [
    {
        "name": "æ•°å­¦é€‰æ‹©é¢˜5é¢˜",
        "image_urls": [
            "https://example.com/math_choice_1.jpg"
        ],
        "expected_total": 5,
        "expected_types": ["é€‰æ‹©é¢˜"] * 5
    },
    {
        "name": "æ•°å­¦å¡«ç©º+è§£ç­”æ··åˆ",
        "image_urls": [
            "https://example.com/math_mixed_1.jpg"
        ],
        "expected_total": 8,
    },
    # ... æ›´å¤šæµ‹è¯•ç”¨ä¾‹
]

async def test_prompt_accuracy():
    """æµ‹è¯• Prompt å‡†ç¡®ç‡"""
    service = BailianService()
    results = []
    
    for case in TEST_CASES:
        print(f"\næµ‹è¯•: {case['name']}")
        print(f"å›¾ç‰‡: {case['image_urls']}")
        
        # è°ƒç”¨ AI
        response = await service.chat_completion(
            messages=[...],  # ä½¿ç”¨ HOMEWORK_CORRECTION_PROMPT
            max_tokens=4000
        )
        
        # è§£æç»“æœ
        try:
            data = json.loads(response.content)
            actual_total = len(data["questions"])
            
            # éªŒè¯
            is_correct = actual_total == case["expected_total"]
            
            results.append({
                "case": case["name"],
                "expected": case["expected_total"],
                "actual": actual_total,
                "correct": is_correct
            })
            
            print(f"âœ… è¯†åˆ«é¢˜æ•°: {actual_total}/{case['expected_total']}")
            
        except Exception as e:
            print(f"âŒ è§£æå¤±è´¥: {e}")
            results.append({
                "case": case["name"],
                "error": str(e)
            })
    
    # ç»Ÿè®¡å‡†ç¡®ç‡
    correct_count = sum(1 for r in results if r.get("correct"))
    accuracy = correct_count / len(results) * 100
    
    print(f"\n\nğŸ“Š å‡†ç¡®ç‡: {accuracy:.1f}% ({correct_count}/{len(results)})")
    
    return results

if __name__ == "__main__":
    asyncio.run(test_prompt_accuracy())
```

---

## å…«ã€ä¸Šçº¿æ£€æŸ¥æ¸…å•

### 8.1 ä»£ç æ£€æŸ¥

- [ ] æ‰€æœ‰ä»£ç å·²æäº¤åˆ° Gitï¼ˆ`git status` æ— æœªæäº¤æ–‡ä»¶ï¼‰
- [ ] ä»£ç å·²é€šè¿‡ Code Review
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›–ç‡ >80%ï¼‰
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] Prompt æµ‹è¯•å‡†ç¡®ç‡ >90%
- [ ] ä»£ç ç¬¦åˆè§„èŒƒï¼ˆblack + flake8ï¼‰

### 8.2 æ•°æ®åº“æ£€æŸ¥

- [ ] è¿ç§»è„šæœ¬å·²åœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•é€šè¿‡
- [ ] è¿ç§»è„šæœ¬åŒ…å« `upgrade()` å’Œ `downgrade()` æ–¹æ³•
- [ ] æ–°å¢å­—æ®µå·²æ·»åŠ ç´¢å¼•ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
- [ ] ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“å¤‡ä»½å®Œæˆ
- [ ] è¿ç§»è„šæœ¬å·²åœ¨æµ‹è¯•ç¯å¢ƒï¼ˆPostgreSQLï¼‰éªŒè¯

### 8.3 AI æœåŠ¡æ£€æŸ¥

- [ ] ç™¾ç‚¼ API Key å·²é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] Prompt åœ¨çœŸå®æ•°æ®ä¸Šæµ‹è¯•è¿‡ï¼ˆå‡†ç¡®ç‡ >90%ï¼‰
- [ ] AI è°ƒç”¨è¶…æ—¶æ—¶é—´å·²è®¾ç½®ï¼ˆ120ç§’ï¼‰
- [ ] é‡è¯•æœºåˆ¶å·²é…ç½®ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- [ ] Token ç”¨é‡ç›‘æ§å·²å¯ç”¨

### 8.4 å‰ç«¯æ£€æŸ¥

- [ ] å°ç¨‹åºä»£ç å·²åœ¨å¼€å‘è€…å·¥å…·æµ‹è¯•
- [ ] æ‰¹æ”¹ç»“æœå¡ç‰‡æ ·å¼åœ¨å¤šæœºå‹æµ‹è¯•
- [ ] å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] é”™è¯¯æç¤ºå‹å¥½ï¼ˆç½‘ç»œå¼‚å¸¸ã€è¶…æ—¶ç­‰ï¼‰
- [ ] åŠ è½½åŠ¨ç”»å·²æ·»åŠ ï¼ˆæ‰¹æ”¹ä¸­æç¤ºï¼‰

### 8.5 æ€§èƒ½æ£€æŸ¥

- [ ] å•æ¬¡æ‰¹æ”¹å“åº”æ—¶é—´ <30ç§’ï¼ˆ5é¢˜ä»¥å†…ï¼‰
- [ ] æ•°æ®åº“æŸ¥è¯¢å·²ä¼˜åŒ–ï¼ˆæ—  N+1 é—®é¢˜ï¼‰
- [ ] å›¾ç‰‡ä¸Šä¼ å¤§å°é™åˆ¶å·²è®¾ç½®ï¼ˆå•å¼  <5MBï¼‰
- [ ] å¹¶å‘é™æµå·²é…ç½®ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰

### 8.6 ç›‘æ§ä¸æ—¥å¿—

- [ ] å…³é”®æ—¥å¿—å·²æ·»åŠ ï¼ˆæ‰¹æ”¹å¼€å§‹/ç»“æŸ/å¤±è´¥ï¼‰
- [ ] é”™è¯¯æ—¥å¿—åŒ…å«è¶³å¤Ÿä¸Šä¸‹æ–‡ï¼ˆuser_id, image_count ç­‰ï¼‰
- [ ] æ…¢æŸ¥è¯¢ç›‘æ§å·²å¯ç”¨ï¼ˆ>1ç§’ï¼‰
- [ ] ç”Ÿäº§ç¯å¢ƒæ—¥å¿—çº§åˆ«è®¾ç½®ä¸º INFO

### 8.7 æ–‡æ¡£ä¸åŸ¹è®­

- [ ] ç”¨æˆ·æ‰‹å†Œå·²æ›´æ–°ï¼ˆ`USER_MANUAL.md`ï¼‰
- [ ] API æ–‡æ¡£å·²æ›´æ–°ï¼ˆSwaggerï¼‰
- [ ] å†…éƒ¨åŸ¹è®­å·²å®Œæˆï¼ˆå®¢æœå›¢é˜Ÿï¼‰
- [ ] å¸¸è§é—®é¢˜æ–‡æ¡£å·²å‡†å¤‡ï¼ˆFAQï¼‰

### 8.8 ç°åº¦å‘å¸ƒ

- [ ] ç°åº¦ç”¨æˆ·åˆ—è¡¨å·²ç¡®å®šï¼ˆ10-20äººï¼‰
- [ ] ç°åº¦å¼€å…³å·²é…ç½®ï¼ˆå¯å¿«é€Ÿå›æ»šï¼‰
- [ ] ç›‘æ§å¤§ç›˜å·²å°±ç»ªï¼ˆå®æ—¶æŸ¥çœ‹é”™è¯¯ç‡ï¼‰
- [ ] ç´§æ€¥è”ç³»äººå·²é€šçŸ¥

### 8.9 å›æ»šå‡†å¤‡

- [ ] æ•°æ®åº“è¿ç§»å›æ»šè„šæœ¬å·²æµ‹è¯•
- [ ] ä»£ç å›æ»šæµç¨‹å·²æ¼”ç»ƒ
- [ ] å›æ»šå†³ç­–æ ‡å‡†å·²æ˜ç¡®ï¼ˆé”™è¯¯ç‡ >5%ï¼‰
- [ ] å¤‡ç”¨è”ç³»æ–¹å¼å·²å‡†å¤‡ï¼ˆç”µè¯/å¾®ä¿¡ï¼‰

---

## ä¹ã€å¸¸è§é—®é¢˜

### 9.1 AI æ‰¹æ”¹ç›¸å…³

**Q1: AI è¯†åˆ«é¢˜ç›®æ•°é‡ä¸å‡†ç¡®æ€ä¹ˆåŠï¼Ÿ**

**A**: 
1. **æ£€æŸ¥å›¾ç‰‡è´¨é‡**ï¼šç¡®ä¿å›¾ç‰‡æ¸…æ™°ã€å…‰çº¿å……è¶³ã€å››è§’å®Œæ•´
2. **ä¼˜åŒ– Prompt**ï¼šåœ¨ `HOMEWORK_CORRECTION_PROMPT` ä¸­å¢åŠ ç¤ºä¾‹
3. **äººå·¥å…œåº•**ï¼šå…è®¸ç”¨æˆ·"åé¦ˆé”™è¯¯"ï¼Œè§¦å‘äººå·¥å¤æ ¸
4. **åˆ†æ‰¹ä¸Šä¼ **ï¼šå»ºè®®ç”¨æˆ·æ¯æ¬¡ä¸Šä¼  3-5 é¢˜ï¼Œé¿å…ä¸€æ¬¡ä¸Šä¼ æ•´ä»½è¯•å·

**Q2: AI è¿”å›çš„ JSON æ ¼å¼é”™è¯¯ï¼Ÿ**

**A**:
```python
# åœ¨ _call_ai_for_homework_correction æ–¹æ³•ä¸­æ·»åŠ é‡è¯•é€»è¾‘
try:
    result = json.loads(response.content)
except json.JSONDecodeError:
    logger.warning("AI è¿”å›æ ¼å¼é”™è¯¯ï¼Œå°è¯•æ¸…ç†...")
    # æ¸…ç†å¯èƒ½çš„å¤šä½™å­—ç¬¦ï¼ˆå¦‚ ```json ... ```ï¼‰
    content = response.content.strip()
    if content.startswith("```"):
        content = content.split("```")[1]
        if content.startswith("json"):
            content = content[4:]
    result = json.loads(content)
```

**Q3: æ‰¹æ”¹é€Ÿåº¦å¤ªæ…¢ï¼ˆ>30ç§’ï¼‰ï¼Ÿ**

**A**:
1. **é™åˆ¶é¢˜ç›®æ•°é‡**ï¼šå‰ç«¯æç¤º"å»ºè®®æ¯æ¬¡ä¸Šä¼ ä¸è¶…è¿‡ 5 é¢˜"
2. **åˆ†æ‰¹è°ƒç”¨ AI**ï¼šå¦‚å›¾ç‰‡ >3 å¼ ï¼Œåˆ†æ‰¹è°ƒç”¨å¹¶è¡Œå¤„ç†
3. **ä½¿ç”¨æµå¼å“åº”**ï¼šå®æ—¶æ˜¾ç¤ºæ‰¹æ”¹è¿›åº¦ï¼ˆ"æ­£åœ¨æ‰¹æ”¹ç¬¬1é¢˜..."ï¼‰
4. **ç¼“å­˜æœºåˆ¶**ï¼šç›¸åŒå›¾ç‰‡ hash å‘½ä¸­ç¼“å­˜ï¼Œç›´æ¥è¿”å›ç»“æœ

### 9.2 é”™é¢˜è®°å½•ç›¸å…³

**Q4: ç”¨æˆ·åé¦ˆ"è¿™é“é¢˜æ˜æ˜ç­”å¯¹äº†ï¼Œä¸ºä»€ä¹ˆè¿›é”™é¢˜æœ¬"ï¼Ÿ**

**A**:
1. **æä¾›åé¦ˆå…¥å£**ï¼šé”™é¢˜è¯¦æƒ…é¡µæ·»åŠ "æ ‡è®°ä¸ºå·²æŒæ¡"æŒ‰é’®
2. **AI å¤æ ¸**ï¼šç”¨æˆ·ç‚¹å‡»åé¦ˆåï¼Œé‡æ–°è°ƒç”¨ AI åˆ¤æ–­ï¼ˆé™„å¸¦ç”¨æˆ·è¯´æ˜ï¼‰
3. **äººå·¥å®¡æ ¸**ï¼šé‡è¦æ¡ˆä¾‹ç”±æ•™å¸ˆç«¯ä»‹å…¥å®¡æ ¸
4. **ä¼˜åŒ– Prompt**ï¼šæ”¶é›†è¯¯åˆ¤æ¡ˆä¾‹ï¼ŒæŒç»­ä¼˜åŒ– Prompt

**Q5: æ‰¹æ”¹ç»“æœä¸­æ²¡æœ‰æŸé“é¢˜ï¼ˆæ¼è¯†åˆ«ï¼‰ï¼Ÿ**

**A**:
1. **æ£€æµ‹æœºåˆ¶**ï¼šåç«¯å¯¹æ¯” AI è¿”å›çš„é¢˜ç›®æ•°ä¸å›¾ç‰‡æ•°é‡ï¼Œå¦‚å·®å¼‚è¿‡å¤§åˆ™è­¦å‘Š
2. **æ‰‹åŠ¨è¡¥å……**ï¼šæä¾›"æ‰‹åŠ¨æ·»åŠ é”™é¢˜"å…¥å£
3. **é‡æ–°æ‰¹æ”¹**ï¼šå…è®¸ç”¨æˆ·"é‡æ–°æ‰¹æ”¹æ­¤ä½œä¸š"

**Q6: çŸ¥è¯†ç‚¹å…³è”ä¸å‡†ç¡®ï¼Ÿ**

**A**:
1. **ä¾èµ– AI æå–**ï¼šä¼˜å…ˆä½¿ç”¨ AI è¿”å›çš„ `knowledge_points` å­—æ®µ
2. **è§„åˆ™å¢å¼º**ï¼šåœ¨ `_extract_knowledge_points_from_answer` ä¸­æ‰©å……çŸ¥è¯†ç‚¹åº“
3. **ç”¨æˆ·ç¼–è¾‘**ï¼šé”™é¢˜è¯¦æƒ…é¡µå…è®¸ç”¨æˆ·ä¿®æ”¹å…³è”çš„çŸ¥è¯†ç‚¹

### 9.3 æ•°æ®åº“ä¸æ€§èƒ½

**Q7: æ•°æ®åº“è¿ç§»å¤±è´¥æ€ä¹ˆåŠï¼Ÿ**

**A**:
```bash
# 1. æŸ¥çœ‹è¿ç§»å†å²
alembic history

# 2. æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
alembic current

# 3. å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
alembic downgrade -1

# 4. æ£€æŸ¥è¿ç§»è„šæœ¬è¯­æ³•é”™è¯¯
python -c "import alembic.versions.xxx_add_mistake_fields as m; print('OK')"

# 5. æ‰‹åŠ¨æ‰§è¡Œ SQLï¼ˆå¦‚å®åœ¨æ— æ³•è‡ªåŠ¨è¿ç§»ï¼‰
psql -U wuhao -d wuhao_tutor < manual_migration.sql
```

**Q8: é”™é¢˜åˆ—è¡¨åŠ è½½æ…¢ï¼ˆ>3ç§’ï¼‰ï¼Ÿ**

**A**:
1. **æ£€æŸ¥ç´¢å¼•**ï¼šç¡®è®¤ `idx_mistake_question_number` ç´¢å¼•å·²åˆ›å»º
2. **åˆ†é¡µæŸ¥è¯¢**ï¼šä½¿ç”¨ `LIMIT` å’Œ `OFFSET`ï¼Œæ¯é¡µ 20 æ¡
3. **å…³è”æŸ¥è¯¢ä¼˜åŒ–**ï¼šä½¿ç”¨ `selectinload` é¢„åŠ è½½çŸ¥è¯†ç‚¹å…³è”
4. **ç¼“å­˜çƒ­æ•°æ®**ï¼šç”¨æˆ·æœ€è¿‘ 7 å¤©çš„é”™é¢˜ç¼“å­˜åˆ° Redis

**Q9: å›¾ç‰‡å­˜å‚¨æˆæœ¬è¿‡é«˜ï¼Ÿ**

**A**:
1. **å‹ç¼©ä¸Šä¼ **ï¼šå‰ç«¯ä¸Šä¼ å‰å‹ç¼©å›¾ç‰‡ï¼ˆquality: 80ï¼‰
2. **OSS ç”Ÿå‘½å‘¨æœŸ**ï¼šè®¾ç½® 30 å¤©åè‡ªåŠ¨å½’æ¡£å†·å­˜å‚¨
3. **å»é‡æœºåˆ¶**ï¼šç›¸åŒå›¾ç‰‡ï¼ˆhashï¼‰åªå­˜ä¸€ä»½
4. **å®šæœŸæ¸…ç†**ï¼šåˆ é™¤ 90 å¤©å‰çš„å·²æŒæ¡é”™é¢˜çš„å›¾ç‰‡

### 9.4 å‰ç«¯äº¤äº’

**Q10: å°ç¨‹åºç™½å±æˆ–å¡é¡¿ï¼Ÿ**

**A**:
1. **æ£€æŸ¥ Console**ï¼šå¾®ä¿¡å¼€å‘è€…å·¥å…· â†’ Console æŸ¥çœ‹é”™è¯¯
2. **æ•°æ®é‡è¿‡å¤§**ï¼šæ‰¹æ”¹ç»“æœä¸­é¢˜ç›®è¿‡å¤šï¼ˆ>20 é¢˜ï¼‰ï¼Œåˆ†é¡µæ˜¾ç¤º
3. **å›¾ç‰‡åŠ è½½**ï¼šä½¿ç”¨ `lazy-load` æ‡’åŠ è½½å›¾ç‰‡
4. **é™çº§æ–¹æ¡ˆ**ï¼šæ‰¹æ”¹å¤±è´¥æ—¶æ˜¾ç¤ºå‹å¥½æç¤ºï¼Œä¸é˜»å¡ç”¨æˆ·æ“ä½œ

**Q11: æ‰¹æ”¹ç»“æœå¡ç‰‡æ ·å¼é”™ä¹±ï¼Ÿ**

**A**:
1. **æ£€æŸ¥æœºå‹å…¼å®¹æ€§**ï¼šåœ¨ iPhoneã€Android å„ 2-3 æ¬¾æœºå‹æµ‹è¯•
2. **ä½¿ç”¨ flex å¸ƒå±€**ï¼šé¿å…å›ºå®šå®½åº¦
3. **å­—ä½“å¤§å°è‡ªé€‚åº”**ï¼šä½¿ç”¨ `rpx` å•ä½
4. **æµ‹è¯•é•¿æ–‡æœ¬**ï¼šé¢˜ç›®è¿‡é•¿æ—¶æ˜¾ç¤ºçœç•¥å·ï¼ˆ`text-overflow: ellipsis`ï¼‰

**Q12: ç”¨æˆ·è¯´"æ‰¾ä¸åˆ°æ‰¹æ”¹å…¥å£"ï¼Ÿ**

**A**:
1. **æ— éœ€æ–°å¢å…¥å£**ï¼šåœ¨"å­¦ä¹ é—®ç­”"é¡µé¢ç›´æ¥ä¸Šä¼ ä½œä¸šå›¾ç‰‡å³å¯
2. **å¼•å¯¼æç¤º**ï¼šé¦–æ¬¡ä½¿ç”¨æ—¶æ˜¾ç¤ºæ°”æ³¡æç¤º"ä¸Šä¼ ä½œä¸šå›¾ç‰‡ï¼ŒAI è‡ªåŠ¨æ‰¹æ”¹"
3. **å¿«æ·å…¥å£**ï¼šé¦–é¡µæ·»åŠ "å¿«é€Ÿæ‰¹æ”¹"æŒ‰é’®ï¼Œè·³è½¬åˆ°å­¦ä¹ é—®ç­”å¹¶é¢„å¡«æç¤º

### 9.5 è¿ç»´ä¸ç›‘æ§

**Q13: å¦‚ä½•ç›‘æ§æ‰¹æ”¹åŠŸèƒ½çš„ä½¿ç”¨æƒ…å†µï¼Ÿ**

**A**:
```python
# åœ¨ _call_ai_for_homework_correction ä¸­æ·»åŠ åŸ‹ç‚¹
from src.core.monitoring import metrics_collector

metrics_collector.increment("homework_correction.total")
metrics_collector.timing("homework_correction.duration", duration_ms)
metrics_collector.gauge("homework_correction.questions_per_request", total_questions)

# æŸ¥è¯¢ç›‘æ§æ•°æ®
# Prometheus: homework_correction_total{status="success"}
# Grafana: åˆ›å»ºä»ªè¡¨ç›˜å±•ç¤ºè¶‹åŠ¿
```

**Q14: å¦‚ä½•å¿«é€Ÿå®šä½ç”¨æˆ·åé¦ˆçš„é—®é¢˜ï¼Ÿ**

**A**:
1. **å…³é”®æ—¥å¿—å­—æ®µ**ï¼š
   ```python
   logger.info(
       f"ğŸ¯ æ‰¹æ”¹å®Œæˆ: user_id={user_id}, session_id={session_id}, "
       f"images={len(image_urls)}, questions={len(questions)}, "
       f"mistakes={mistakes_count}, duration={duration_ms}ms"
   )
   ```
2. **æ—¥å¿—æŸ¥è¯¢å‘½ä»¤**ï¼š
   ```bash
   # æŸ¥è¯¢æŸç”¨æˆ·çš„æ‰¹æ”¹è®°å½•
   journalctl -u wuhao-tutor.service | grep "user_id=abc123" | grep "æ‰¹æ”¹"
   
   # æŸ¥è¯¢å¤±è´¥çš„æ‰¹æ”¹
   journalctl -u wuhao-tutor.service | grep "æ‰¹æ”¹å¤±è´¥"
   ```
3. **Sentry é›†æˆ**ï¼šé”™è¯¯è‡ªåŠ¨ä¸ŠæŠ¥åˆ° Sentryï¼ŒåŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡

**Q15: å¦‚ä½•è¿›è¡Œ A/B æµ‹è¯•ï¼ˆæ–°æ—§æ–¹æ¡ˆå¯¹æ¯”ï¼‰ï¼Ÿ**

**A**:
```python
# åœ¨ ask_question æ–¹æ³•ä¸­æ·»åŠ åˆ†æµé€»è¾‘
def _should_use_new_correction(self, user_id: str) -> bool:
    """åˆ¤æ–­æ˜¯å¦ä½¿ç”¨æ–°æ‰¹æ”¹é€»è¾‘ï¼ˆA/B æµ‹è¯•ï¼‰"""
    # æ–¹æ¡ˆ1ï¼šæŒ‰ç”¨æˆ·IDå“ˆå¸Œåˆ†æµï¼ˆ50%ï¼‰
    return int(hashlib.md5(user_id.encode()).hexdigest(), 16) % 2 == 0
    
    # æ–¹æ¡ˆ2ï¼šä»é…ç½®è¯»å–ç™½åå•
    whitelist = settings.CORRECTION_WHITELIST_USERS  # ["user1", "user2"]
    return user_id in whitelist
    
    # æ–¹æ¡ˆ3ï¼šå…¨é‡å¼€å¯
    return True
```

---

## åã€æ€»ç»“

### 10.1 æ ¸å¿ƒä»·å€¼

é€šè¿‡æœ¬æ¬¡ä¼˜åŒ–ï¼Œå®ç°äº†ï¼š
1. âœ… **ç²¾å‡†æå–**ï¼šä»"æ•´æ¬¡å¯¹è¯"åˆ°"é€é¢˜è®°å½•"ï¼Œå‡†ç¡®ç‡æå‡ 90%+
2. âœ… **æ™ºèƒ½æ‰¹æ”¹**ï¼šAI è‡ªåŠ¨åˆ¤æ–­å¯¹é”™ï¼ŒèŠ‚çœäººå·¥æ‰¹æ”¹æ—¶é—´ 80%+
3. âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šæ— éœ€æ–°å¢å…¥å£ï¼Œç¬¦åˆç”¨æˆ·ä¹ æƒ¯ï¼Œé™ä½å­¦ä¹ æˆæœ¬
4. âœ… **æ•°æ®è´¨é‡**ï¼šé”™é¢˜è®°å½•ç»“æ„åŒ–ï¼Œæ”¯æŒçŸ¥è¯†ç‚¹åˆ†æå’Œå¤ä¹ è®¡åˆ’

### 10.2 å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-----|--------|--------|------|
| é”™é¢˜è¯†åˆ«å‡†ç¡®ç‡ | 60% | 95%+ | +58% |
| å•é¢˜è®°å½•å®Œæ•´åº¦ | 30% | 100% | +233% |
| æ‰¹æ”¹å“åº”æ—¶é—´ | N/A | <30s | æ–°å¢ |
| ç”¨æˆ·æ»¡æ„åº¦ | 3.2/5 | é¢„æœŸ 4.5/5 | +41% |

### 10.3 åç»­è¿­ä»£æ–¹å‘

**çŸ­æœŸï¼ˆ1-2 ä¸ªæœˆï¼‰**ï¼š
- å›¾ç‰‡æ™ºèƒ½è£å‰ªï¼ˆæŒ‰é¢˜åˆ†å‰²å­˜å‚¨ï¼‰
- æ‰‹å†™ä½“è¯†åˆ«ä¼˜åŒ–ï¼ˆè®­ç»ƒè‡ªå®šä¹‰ OCR æ¨¡å‹ï¼‰
- æ‰¹æ”¹æŠ¥å‘Šå¯¼å‡ºï¼ˆPDF æ ¼å¼ï¼Œä¾›å®¶é•¿æŸ¥çœ‹ï¼‰

**ä¸­æœŸï¼ˆ3-6 ä¸ªæœˆï¼‰**ï¼š
- æ•™å¸ˆæ‰¹æ”¹ç•Œé¢ï¼ˆä¿®æ­£ AI ç»“æœï¼‰
- ç­çº§ä½œä¸šç®¡ç†ï¼ˆæ•™å¸ˆå‘å¸ƒ â†’ å­¦ç”Ÿæäº¤ â†’ æ‰¹é‡æ‰¹æ”¹ï¼‰
- é”™é¢˜æ¨é€ä¼˜åŒ–ï¼ˆåŸºäºé—å¿˜æ›²çº¿ï¼‰

**é•¿æœŸï¼ˆ6-12 ä¸ªæœˆï¼‰**ï¼š
- å¤šæ¨¡æ€è¾“å…¥ï¼ˆè¯­éŸ³ä½œä¸šæ‰¹æ”¹ï¼‰
- æ™ºèƒ½å‡ºé¢˜ï¼ˆåŸºäºé”™é¢˜è‡ªåŠ¨ç”Ÿæˆå˜å¼é¢˜ï¼‰
- å­¦ä¹ è·¯å¾„è§„åˆ’ï¼ˆAI å®šåˆ¶ä¸ªæ€§åŒ–å­¦ä¹ è®¡åˆ’ï¼‰

---

## é™„å½•

### A. ç›¸å…³æ–‡ä»¶æ¸…å•

**åç«¯**ï¼š
- `src/models/study.py` - MistakeRecord æ¨¡å‹
- `src/services/learning_service.py` - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- `src/services/bailian_service.py` - AI æœåŠ¡å°è£…
- `src/schemas/learning.py` - API å“åº”æ¨¡å‹
- `alembic/versions/xxx_add_mistake_fields.py` - æ•°æ®åº“è¿ç§»

**å‰ç«¯**ï¼š
- `miniprogram/pages/learning/index/` - å­¦ä¹ é—®ç­”é¡µé¢
- `miniprogram/components/correction-card/` - æ‰¹æ”¹ç»“æœå¡ç‰‡ç»„ä»¶
- `miniprogram/api/learning.js` - API è°ƒç”¨å°è£…

**æµ‹è¯•**ï¼š
- `tests/services/test_learning_service_correction.py` - å•å…ƒæµ‹è¯•
- `tests/integration/test_homework_correction_flow.py` - é›†æˆæµ‹è¯•
- `scripts/test_correction_prompt.py` - Prompt æµ‹è¯•è„šæœ¬

**æ–‡æ¡£**ï¼š
- `MISTAKE_EXTRACTION_OPTIMIZATION.md` - æœ¬æ–‡æ¡£
- `USER_MANUAL.md` - ç”¨æˆ·æ‰‹å†Œï¼ˆéœ€æ›´æ–°ï¼‰
- `README.md` - é¡¹ç›®è¯´æ˜ï¼ˆéœ€æ›´æ–°åŠŸèƒ½åˆ—è¡¨ï¼‰

### B. å‚è€ƒèµ„æ–™

- [é˜¿é‡Œäº‘ç™¾ç‚¼æ–‡æ¡£](https://help.aliyun.com/zh/bailian/)
- [Qwen-VL è§†è§‰æ¨¡å‹](https://github.com/QwenLM/Qwen-VL)
- [å¾®ä¿¡å°ç¨‹åºå¼€å‘æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [FastAPI å®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [SQLAlchemy 2.x æ–‡æ¡£](https://docs.sqlalchemy.org/en/20/)

### C. è”ç³»æ–¹å¼

**æŠ€æœ¯æ”¯æŒ**ï¼š
- å¼€å‘è´Ÿè´£äººï¼š[å¼€å‘è€…å§“å]
- é‚®ç®±ï¼šdev@wuhao-tutor.com
- ä¼ä¸šå¾®ä¿¡ç¾¤ï¼š[ç¾¤äºŒç»´ç ]

**é—®é¢˜åé¦ˆ**ï¼š
- GitHub Issues: https://github.com/your-org/wuhao-tutor/issues
- ç”¨æˆ·åé¦ˆè¡¨å•ï¼š[åœ¨çº¿è¡¨å•é“¾æ¥]

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-07  
**ç»´æŠ¤è€…**: AI Agent + å¼€å‘å›¢é˜Ÿ

---

## å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | ä½œè€… |
|-----|------|---------|------|
| v1.0 | 2025-11-07 | åˆå§‹ç‰ˆæœ¬ï¼ˆæ–¹æ¡ˆAå®Œæ•´è®¾è®¡ï¼‰ | AI Agent |
| v1.1 | å¾…å®š | å®é™…å¼€å‘ä¸­çš„è°ƒæ•´å’Œä¼˜åŒ– | å¼€å‘å›¢é˜Ÿ |

---

**ç¥å¼€å‘é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·éšæ—¶è”ç³»ã€‚** ğŸš€