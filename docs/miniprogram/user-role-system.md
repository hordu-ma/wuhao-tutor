# ç”¨æˆ·è®¤è¯ä¸å­¦ä¹ ç®¡ç†ç³»ç»ŸæŒ‡å—

**æœ€åæ›´æ–°**: 2025-10-19  
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª - å­¦ç”Ÿä¸“ç”¨ç®€åŒ–ç‰ˆ

---

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿä¸º K12 å­¦ç”Ÿä¸“é—¨è®¾è®¡çš„å¾®ä¿¡å°ç¨‹åºå­¦ä¹ ç®¡ç†ç³»ç»Ÿï¼Œæä¾›ç®€æ´é«˜æ•ˆçš„ç”¨æˆ·è®¤è¯ã€å­¦ä¹ è¿›åº¦è·Ÿè¸ªã€ä½œä¸šé—®ç­”å’Œé”™é¢˜ç®¡ç†åŠŸèƒ½ã€‚ç³»ç»Ÿä¸“æ³¨äºå­¦ç”Ÿè§’è‰²ï¼Œæä¾›ç»Ÿä¸€çš„å­¦ä¹ ä½“éªŒã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
å­¦ç”Ÿå­¦ä¹ ç³»ç»Ÿ
â”œâ”€â”€ è®¤è¯ç®¡ç† (AuthManager)            # å­¦ç”Ÿç™»å½•å’ŒTokenç®¡ç†
â”œâ”€â”€ TabBarç®¡ç† (TabBarManager)        # ç®€åŒ–TabBaré…ç½®ï¼ˆå­¦ç”Ÿ/è®¿å®¢ï¼‰
â”œâ”€â”€ å­¦ä¹ è¿›åº¦ç®¡ç† (LearningManager)    # å­¦ä¹ è¿›åº¦å’Œç»Ÿè®¡
â”œâ”€â”€ é”™é¢˜ç®¡ç† (MistakesManager)        # é”™é¢˜æœ¬åŠŸèƒ½
â”œâ”€â”€ ä½œä¸šé—®ç­” (HomeworkQA)             # AIé©±åŠ¨çš„å­¦ä¹ é—®ç­”
â””â”€â”€ å­¦æƒ…åˆ†æ (AnalyticsManager)       # å­¦ä¹ æŠ¥å‘Šå’Œæ•°æ®åˆ†æ
```

### è®¿é—®å±‚çº§

```
ç”¨æˆ·è®¤è¯å±‚ (ç™»å½•çŠ¶æ€éªŒè¯)
    â†“
å­¦ç”ŸåŠŸèƒ½æƒé™å±‚ (å·²ç™»å½•å­¦ç”Ÿ vs è®¿å®¢)
    â†“
å­¦ä¹ åŠŸèƒ½è®¿é—®å±‚ (ä½œä¸šé—®ç­”ã€é”™é¢˜æœ¬ã€å­¦ä¹ æŠ¥å‘Š)
    â†“
APIè°ƒç”¨æƒé™å±‚ (åç«¯æ¥å£æƒé™)
    â†“
æ•°æ®å®‰å…¨å±‚ (å­¦ç”Ÿæ•°æ®éš”ç¦»)
```

---

## ğŸ“ æ ¸å¿ƒç»„ä»¶

### 1. è®¤è¯ç®¡ç†å™¨ (`utils/auth.js`)
- å¾®ä¿¡å°ç¨‹åºç™»å½•é›†æˆ
- æ‰‹æœºå·+å¯†ç ç™»å½•æ”¯æŒ
- Tokenç®¡ç†å’Œè‡ªåŠ¨åˆ·æ–°
- ç”¨æˆ·ä¼šè¯çŠ¶æ€æ£€æŸ¥
- ç™»å½•çŠ¶æ€æŒä¹…åŒ–

**æ ¸å¿ƒåŠŸèƒ½**:
```javascript
// ç®€åŒ–çš„è§’è‰²è·å– - å›ºå®šè¿”å› 'student'
async getUserRole() {
  return 'student';
}

// ç™»å½•çŠ¶æ€æ£€æŸ¥
async isLoggedIn() {
  // æ£€æŸ¥Tokenæœ‰æ•ˆæ€§
}
```

### 2. TabBarç®¡ç†å™¨ (`utils/tabbar-manager.js`) - ç®€åŒ–ç‰ˆ
- å­¦ç”ŸTabBaré…ç½®ï¼ˆé¦–é¡µã€é”™é¢˜æœ¬ã€ä½œä¸šé—®ç­”ã€å­¦ä¹ æŠ¥å‘Šã€æˆ‘çš„ï¼‰
- è®¿å®¢TabBaré…ç½®ï¼ˆé¦–é¡µã€æˆ‘çš„ï¼‰
- åŸºäºç™»å½•çŠ¶æ€çš„åŠ¨æ€åˆ‡æ¢
- ç§»é™¤å¤æ‚çš„è§’è‰²åˆ¤æ–­é€»è¾‘

**TabBaré…ç½®**:
```javascript
// å­¦ç”Ÿä¸“ç”¨TabBar
studentTabBarConfig = {
  list: [
    { pagePath: 'pages/index/index', text: 'é¦–é¡µ' },
    { pagePath: 'pages/mistakes/list/index', text: 'é”™é¢˜æœ¬' },
    { pagePath: 'pages/learning/index/index', text: 'ä½œä¸šé—®ç­”' },
    { pagePath: 'pages/analysis/report/index', text: 'å­¦ä¹ æŠ¥å‘Š' },
    { pagePath: 'pages/profile/index/index', text: 'æˆ‘çš„' }
  ]
}
```

### 3. æƒé™ç®¡ç† - ç®€åŒ–ç‰ˆ
åŸºäºç™»å½•çŠ¶æ€çš„ç®€å•æƒé™æ§åˆ¶ï¼š
- **å·²ç™»å½•å­¦ç”Ÿ**: å¯è®¿é—®æ‰€æœ‰å­¦ä¹ åŠŸèƒ½
- **æœªç™»å½•è®¿å®¢**: åªèƒ½è®¿é—®é¦–é¡µå’Œç™»å½•é¡µé¢

---

## ğŸ“ å­¦ç”Ÿå­¦ä¹ åŠŸèƒ½

### æ ¸å¿ƒå­¦ä¹ æ¨¡å—

#### ğŸ“š ä½œä¸šé—®ç­” (`pages/learning/`)
- AIé©±åŠ¨çš„æ™ºèƒ½é—®ç­”
- æ”¯æŒæ–‡å­—ã€å›¾ç‰‡è¾“å…¥
- æ•°å­¦å…¬å¼æ¸²æŸ“
- å¯¹è¯å†å²è®°å½•
- å­¦ä¹ è¿›åº¦è·Ÿè¸ª

#### ğŸ“ é”™é¢˜æ‰‹å†Œ (`pages/mistakes/`)
- é”™é¢˜è®°å½•å’Œåˆ†ç±»
- åŸºäºè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿çš„å¤ä¹ æé†’
- çŸ¥è¯†ç‚¹å…³è”åˆ†æ
- æŒæ¡åº¦ç»Ÿè®¡
- æ™ºèƒ½å¤ä¹ æ¨è

#### ğŸ“Š å­¦ä¹ æŠ¥å‘Š (`pages/analysis/`)
- ä¸ªäººå­¦ä¹ æ•°æ®ç»Ÿè®¡
- å­¦ç§‘åˆ†å¸ƒåˆ†æ
- å­¦ä¹ æ—¶é•¿ç»Ÿè®¡
- çŸ¥è¯†ç‚¹æŒæ¡åº¦
- å­¦ä¹ è¶‹åŠ¿åˆ†æ

#### ğŸ‘¤ ä¸ªäººä¸­å¿ƒ (`pages/profile/`)
- ä¸ªäººä¿¡æ¯ç®¡ç†
- å¤´åƒä¸Šä¼ 
- å­¦ä¹ ç»Ÿè®¡å±•ç¤º
- è®¾ç½®å’Œåå¥½

---

## ğŸ”§ æŠ€æœ¯å®ç°

### å‰ç«¯å°ç¨‹åºæ¶æ„
```
miniprogram/
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ auth.js                 # è®¤è¯ç®¡ç†ï¼ˆç®€åŒ–ç‰ˆï¼‰
â”‚   â”œâ”€â”€ tabbar-manager.js       # TabBarç®¡ç†ï¼ˆç®€åŒ–ç‰ˆï¼‰
â”‚   â”œâ”€â”€ request.js              # ç½‘ç»œè¯·æ±‚å°è£…
â”‚   â””â”€â”€ storage.js              # æœ¬åœ°å­˜å‚¨ç®¡ç†
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ index/                  # é¦–é¡µ
â”‚   â”œâ”€â”€ learning/               # ä½œä¸šé—®ç­”
â”‚   â”œâ”€â”€ mistakes/               # é”™é¢˜æœ¬
â”‚   â”œâ”€â”€ analysis/               # å­¦ä¹ æŠ¥å‘Š
â”‚   â””â”€â”€ profile/                # ä¸ªäººä¸­å¿ƒ
â””â”€â”€ components/                 # å…±ç”¨ç»„ä»¶
```

### åç«¯APIæ¶æ„
```
src/
â”œâ”€â”€ models/
â”‚   â””â”€â”€ user.py                 # ç”¨æˆ·æ¨¡å‹ï¼ˆç®€åŒ–è§’è‰²æšä¸¾ï¼‰
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ auth_service.py         # è®¤è¯æœåŠ¡ï¼ˆç®€åŒ–æƒé™ï¼‰
â”‚   â”œâ”€â”€ user_service.py         # ç”¨æˆ·æœåŠ¡ï¼ˆå›ºå®šå­¦ç”Ÿè§’è‰²ï¼‰
â”‚   â”œâ”€â”€ learning_service.py     # å­¦ä¹ æœåŠ¡
â”‚   â””â”€â”€ analytics_service.py    # å­¦æƒ…åˆ†ææœåŠ¡
â””â”€â”€ api/
    â””â”€â”€ v1/endpoints/           # APIç«¯ç‚¹ï¼ˆç®€åŒ–æƒé™æ£€æŸ¥ï¼‰
```

---

## ğŸ“± å°ç¨‹åºé¡µé¢å¯¼èˆª

### ä¸»è¦é¡µé¢æµç¨‹

```
å¯åŠ¨é¡µé¢
    â†“
é¦–é¡µ (index) â†â†’ TabBarå¯¼èˆª
    â†“
â”œâ”€â”€ ä½œä¸šé—®ç­” (learning)
â”œâ”€â”€ é”™é¢˜æœ¬ (mistakes) 
â”œâ”€â”€ å­¦ä¹ æŠ¥å‘Š (analysis)
â””â”€â”€ ä¸ªäººä¸­å¿ƒ (profile)
```

### è®¿å®¢vså­¦ç”Ÿä½“éªŒ

| åŠŸèƒ½æ¨¡å— | è®¿å®¢ç”¨æˆ· | å·²ç™»å½•å­¦ç”Ÿ |
|----------|----------|------------|
| é¦–é¡µæµè§ˆ | âœ… å¯è®¿é—® | âœ… å¯è®¿é—® |
| ä½œä¸šé—®ç­” | âŒ éœ€ç™»å½• | âœ… å¯è®¿é—® |
| é”™é¢˜æœ¬ | âŒ éœ€ç™»å½• | âœ… å¯è®¿é—® |
| å­¦ä¹ æŠ¥å‘Š | âŒ éœ€ç™»å½• | âœ… å¯è®¿é—® |
| ä¸ªäººä¸­å¿ƒ | ğŸ”“ ç™»å½•é¡µ | âœ… ä¸ªäººä¿¡æ¯ |

---

## ğŸš€ å¼€å‘æŒ‡å—

### é¡µé¢æƒé™æ£€æŸ¥
```javascript
// ç®€åŒ–çš„æƒé™æ£€æŸ¥
const app = getApp();
const isLoggedIn = await authManager.isLoggedIn();

if (!isLoggedIn) {
  // è·³è½¬åˆ°ç™»å½•é¡µ
  wx.redirectTo({ url: '/pages/auth/login/index' });
  return;
}
```

### APIè°ƒç”¨æƒé™
```python
# åç«¯æƒé™æ£€æŸ¥ï¼ˆç®€åŒ–ç‰ˆï¼‰
from src.api.dependencies.auth import get_current_user

@router.get("/learning/progress")
async def get_learning_progress(
    current_user: User = Depends(get_current_user)
):
    # æ‰€æœ‰è®¤è¯ç”¨æˆ·éƒ½æ˜¯å­¦ç”Ÿï¼Œæ— éœ€è§’è‰²æ£€æŸ¥
    return await learning_service.get_user_progress(current_user.id)
```

### TabBaråŠ¨æ€æ›´æ–°
```javascript
// ç™»å½•çŠ¶æ€å˜åŒ–æ—¶æ›´æ–°TabBar
await tabBarManager.onLoginStatusChange(isLoggedIn);
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç®€åŒ–å¸¦æ¥çš„ä¼˜åŠ¿
- **å‡å°‘30%ä»£ç å¤æ‚åº¦** - ç§»é™¤å¤šè§’è‰²åˆ¤æ–­é€»è¾‘
- **æå‡TabBarç¨³å®šæ€§** - åŸºäºç™»å½•çŠ¶æ€çš„ç®€å•åˆ‡æ¢
- **é™ä½ç»´æŠ¤æˆæœ¬** - ç»Ÿä¸€çš„å­¦ç”Ÿä½“éªŒè®¾è®¡
- **åŠ å¿«é¡µé¢åŠ è½½** - å‡å°‘æƒé™æ£€æŸ¥å¼€é”€

### æœ€ä½³å®è·µ
1. **ç»Ÿä¸€è®¤è¯æµç¨‹** - æ‰€æœ‰å­¦ä¹ åŠŸèƒ½éƒ½åŸºäºç™»å½•çŠ¶æ€
2. **ç®€åŒ–æƒé™æ¨¡å‹** - é¿å…å¤æ‚çš„è§’è‰²åµŒå¥—
3. **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ** - ä¸“æ³¨å­¦ç”Ÿå­¦ä¹ åœºæ™¯
4. **æ•°æ®å®‰å…¨ä¿æŠ¤** - ç¡®ä¿å­¦ç”Ÿæ•°æ®éš”ç¦»

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

### æ•°æ®ä¿æŠ¤
- å­¦ç”Ÿæ•°æ®ä¸¥æ ¼éš”ç¦»
- Tokenæœ‰æ•ˆæœŸç®¡ç†
- APIè®¿é—®é™æµ
- æ•æ„Ÿä¿¡æ¯è„±æ•

### è®¤è¯å®‰å…¨
- æ‰‹æœºå·éªŒè¯
- å¯†ç å¼ºåº¦è¦æ±‚
- è‡ªåŠ¨ç™»å½•è¶…æ—¶
- å¼‚å¸¸ç™»å½•æ£€æµ‹

---

## ğŸ“ APIæ–‡æ¡£

### ä¸»è¦ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| `/api/v1/auth/login` | POST | å­¦ç”Ÿç™»å½• | å…¬å¼€ |
| `/api/v1/learning/ask` | POST | ä½œä¸šé—®ç­” | å­¦ç”Ÿ |
| `/api/v1/mistakes/list` | GET | é”™é¢˜åˆ—è¡¨ | å­¦ç”Ÿ |
| `/api/v1/analytics/report` | GET | å­¦ä¹ æŠ¥å‘Š | å­¦ç”Ÿ |
| `/api/v1/user/profile` | GET | ä¸ªäººä¿¡æ¯ | å­¦ç”Ÿ |

---

**æ³¨æ„**: æœ¬ç³»ç»Ÿä¸“ä¸ºå­¦ç”Ÿå­¦ä¹ åœºæ™¯ä¼˜åŒ–ï¼Œæä¾›ç®€æ´ã€é«˜æ•ˆã€å®‰å…¨çš„å­¦ä¹ ä½“éªŒã€‚æ‰€æœ‰åŠŸèƒ½å›´ç»•å­¦ç”Ÿçš„å­¦ä¹ éœ€æ±‚è®¾è®¡ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ˜“ç”¨æ€§ã€‚