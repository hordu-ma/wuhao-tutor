# 角色系统简化修改清单

## 总体目标

将当前支持多角色(student/parent/teacher)的系统简化为只支持学生角色(student)，大幅度简化系统逻辑和复杂度。

## 影响分析

### 1. 前端小程序 (miniprogram/)

#### 核心管理文件

- **utils/tabbar-manager.js** - 移除 parent、teacher 配置，只保留 student TabBar
- **utils/role-manager.js** - 完全简化或移除，只保留 student 角色配置
- **utils/auth.js** - 简化 getUserRole 方法，固定返回'student'
- **utils/permission-manager.js** - 大幅简化权限检查逻辑
- **app.js** - 简化全局角色管理，移除角色切换逻辑

#### 页面文件影响

- **pages/_/_.js** - 移除页面中的角色条件判断
- **pages/_/_.wxml** - 移除角色相关的条件渲染（wx:if="{{role==='student'}}"）
- **components/_/_.js** - 移除组件中的角色逻辑

#### 配置文件

- **app.json** - 简化 tabBar 配置，固定为 student 版本
- **project.config.json** - 无需修改

### 2. 后端 API (src/)

#### 模型层 (models/)

- **src/models/user.py** - 移除或简化 UserRole 枚举，只保留 STUDENT
- **数据库表结构** - role 字段可保留但固定为'student'

#### 服务层 (services/)

- **src/services/user_service.py** - 移除角色相关的复杂逻辑
- **src/services/auth_service.py** - 简化认证逻辑，默认 student 角色
- **src/services/analytics_service.py** - 已经主要针对 student_id，影响较小

#### API 层 (api/)

- **src/api/auth.py** - 简化登录/注册接口的角色处理
- **src/api/users.py** - 移除角色相关的查询和过滤
- **src/core/security.py** - 简化权限检查中间件

### 3. 文档和配置

#### 项目文档

- **README.md** - 更新项目简介，移除多角色描述
- **.github/copilot-instructions.md** - 更新开发指令，简化架构说明
- **docs/miniprogram/user-role-system.md** - 重写或删除
- **docs/api/** - 更新 API 文档，移除角色相关端点

#### 配置模板

- **config/templates/.env.example** - 可能无需修改
- **alembic/versions/** - 可能需要新的迁移脚本

### 4. 测试文件 (tests/)

- **tests/** - 更新所有测试用例，移除角色相关测试
- **测试数据** - 简化测试用户创建，固定为 student 角色

## 修改优先级

### 🔴 高优先级 (立即解决 TabBar 问题)

1. `miniprogram/utils/tabbar-manager.js` - 移除 parent/teacher 配置
2. `miniprogram/utils/auth.js` - 固定 getUserRole 返回'student'
3. `miniprogram/app.js` - 简化角色管理逻辑

### 🟡 中优先级 (系统稳定性)

4. `miniprogram/utils/role-manager.js` - 简化或移除
5. `miniprogram/utils/permission-manager.js` - 简化权限逻辑
6. `src/services/user_service.py` - 简化用户服务角色逻辑
7. `src/models/user.py` - 简化用户模型

### 🟢 低优先级 (文档和清理)

8. 文档更新 (README.md, docs/, .github/)
9. 测试用例更新
10. 数据库迁移脚本(如需要)

## 预期效果

### ✅ 解决的问题

- TabBar 显示不一致问题
- 复杂的角色切换逻辑
- 权限检查的性能开销
- 代码维护复杂度

### ✅ 系统简化

- 前端代码减少约 30%的角色相关逻辑
- 后端 API 简化权限中间件
- 文档和测试用例大幅简化
- 新开发者理解成本降低

### ⚠️ 注意事项

- 现有数据库中的 role 字段数据需要处理
- 确保所有页面和组件都移除角色依赖
- API 接口保持向后兼容性
- 充分测试简化后的功能完整性

## 实施计划

1. **阶段 1**: 前端 TabBar 和认证简化 (解决当前问题)
2. **阶段 2**: 后端角色系统简化 (系统一致性)
3. **阶段 3**: 文档和配置更新 (完整性)
4. **阶段 4**: 测试验证和数据库清理 (稳定性)

每个阶段完成后进行功能验证，确保系统正常运行。
