<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>五好伴学 - 浏览器兼容性检测</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .summary {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 14px;
      }

      .summary-item:last-child {
        margin-bottom: 0;
      }

      .summary-label {
        color: #666;
        font-weight: 500;
      }

      .summary-value {
        color: #333;
        font-weight: 600;
      }

      .section {
        margin-bottom: 30px;
      }

      .section-title {
        color: #333;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e9ecef;
      }

      .check-item {
        margin: 10px 0;
        padding: 12px 15px;
        background: #f8f9fa;
        border-radius: 6px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        transition: all 0.2s;
      }

      .check-item:hover {
        transform: translateX(5px);
      }

      .check-item.pass {
        background: #d4edda;
        border-left: 4px solid #28a745;
      }

      .check-item.fail {
        background: #f8d7da;
        border-left: 4px solid #dc3545;
      }

      .check-name {
        flex: 1;
        color: #333;
        font-weight: 500;
      }

      .check-status {
        font-weight: 600;
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 13px;
      }

      .check-item.pass .check-status {
        color: #155724;
        background: #c3e6cb;
      }

      .check-item.fail .check-status {
        color: #721c24;
        background: #f5c6cb;
      }

      .info {
        background: #e7f3ff;
        border-left: 4px solid #0066cc;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 4px;
        font-size: 13px;
        color: #004085;
        word-break: break-all;
      }

      .recommendation {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        margin-top: 30px;
        border-radius: 4px;
        font-size: 14px;
        color: #856404;
      }

      .recommendation h3 {
        margin-bottom: 10px;
        color: #856404;
        font-size: 16px;
      }

      .recommendation ul {
        margin-left: 20px;
        margin-top: 10px;
      }

      .recommendation li {
        margin: 5px 0;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #666;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .spinner {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🔍 浏览器兼容性检测</h1>
      <div class="subtitle">检测您的浏览器是否支持五好伴学所需的功能</div>

      <div id="loading" class="loading">
        <div class="spinner"></div>
        <div>正在检测浏览器功能...</div>
      </div>

      <div id="results" style="display: none">
        <!-- 摘要信息 -->
        <div class="summary">
          <div class="summary-item">
            <span class="summary-label">浏览器类型:</span>
            <span class="summary-value" id="browser-type">-</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">兼容性评分:</span>
            <span class="summary-value" id="compatibility-score">-</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">通过检测:</span>
            <span class="summary-value" id="pass-count">-</span>
          </div>
        </div>

        <!-- User Agent -->
        <div class="info" id="user-agent"></div>

        <!-- ES6+ 语法检测 -->
        <div class="section">
          <div class="section-title">ES6+ 语法支持</div>
          <div id="syntax-checks"></div>
        </div>

        <!-- API 检测 -->
        <div class="section">
          <div class="section-title">浏览器 API 支持</div>
          <div id="api-checks"></div>
        </div>

        <!-- Array 方法 -->
        <div class="section">
          <div class="section-title">Array 方法支持</div>
          <div id="array-checks"></div>
        </div>

        <!-- Object 方法 -->
        <div class="section">
          <div class="section-title">Object 方法支持</div>
          <div id="object-checks"></div>
        </div>

        <!-- String 方法 -->
        <div class="section">
          <div class="section-title">String 方法支持</div>
          <div id="string-checks"></div>
        </div>

        <!-- 推荐 -->
        <div class="recommendation" id="recommendation" style="display: none"></div>
      </div>
    </div>

    <script>
      // 检测结果存储
      const results = {
        syntax: [],
        api: [],
        array: [],
        object: [],
        string: [],
      }

      // 检测函数
      function check(category, name, testFn) {
        const pass = testFn()
        results[category].push({ name, pass })
        return pass
      }

      // 渲染检测结果
      function renderCheck(container, name, pass) {
        const className = pass ? 'pass' : 'fail'
        const status = pass ? '✓ 支持' : '✗ 不支持'
        const div = document.createElement('div')
        div.className = `check-item ${className}`
        div.innerHTML = `
        <span class="check-name">${name}</span>
        <span class="check-status">${status}</span>
      `
        container.appendChild(div)
      }

      // 获取浏览器类型
      function getBrowserType() {
        const ua = navigator.userAgent
        if (ua.includes('Chrome') && !ua.includes('Edge')) return 'Chrome'
        if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari'
        if (ua.includes('Firefox')) return 'Firefox'
        if (ua.includes('Edge')) return 'Edge'
        if (ua.includes('MSIE') || ua.includes('Trident')) return 'IE'
        return '未知'
      }

      // 执行检测
      setTimeout(() => {
        // User Agent
        document.getElementById('user-agent').textContent = `User Agent: ${navigator.userAgent}`

        // ES6+ 语法检测
        check('syntax', 'Promise', () => typeof Promise !== 'undefined')
        check('syntax', 'async/await', () => {
          try {
            eval('(async () => {})()')
            return true
          } catch (e) {
            return false
          }
        })
        check('syntax', 'Optional Chaining (?.)', () => {
          try {
            eval('const obj = {}; obj?.test')
            return true
          } catch (e) {
            return false
          }
        })
        check('syntax', 'Nullish Coalescing (??)', () => {
          try {
            eval('const val = null ?? "default"')
            return true
          } catch (e) {
            return false
          }
        })
        check('syntax', 'Arrow Functions', () => {
          try {
            eval('(() => {})')
            return true
          } catch (e) {
            return false
          }
        })
        check('syntax', 'Template Literals', () => {
          try {
            eval('`template`')
            return true
          } catch (e) {
            return false
          }
        })
        check('syntax', 'Destructuring', () => {
          try {
            eval('const {a} = {a: 1}')
            return true
          } catch (e) {
            return false
          }
        })
        check('syntax', 'Spread Operator', () => {
          try {
            eval('const arr = [...[1, 2]]')
            return true
          } catch (e) {
            return false
          }
        })

        // API 检测
        check('api', 'fetch API', () => typeof fetch !== 'undefined')
        check('api', 'LocalStorage', () => {
          try {
            localStorage.setItem('test', '1')
            localStorage.removeItem('test')
            return true
          } catch (e) {
            return false
          }
        })
        check('api', 'SessionStorage', () => {
          try {
            sessionStorage.setItem('test', '1')
            sessionStorage.removeItem('test')
            return true
          } catch (e) {
            return false
          }
        })
        check('api', 'IntersectionObserver', () => typeof IntersectionObserver !== 'undefined')
        check('api', 'Proxy', () => typeof Proxy !== 'undefined')
        check('api', 'WeakMap', () => typeof WeakMap !== 'undefined')
        check('api', 'Set', () => typeof Set !== 'undefined')
        check('api', 'Map', () => typeof Map !== 'undefined')

        // Array 方法
        check('array', 'Array.includes', () => typeof Array.prototype.includes === 'function')
        check('array', 'Array.find', () => typeof Array.prototype.find === 'function')
        check('array', 'Array.findIndex', () => typeof Array.prototype.findIndex === 'function')
        check('array', 'Array.flat', () => typeof Array.prototype.flat === 'function')
        check('array', 'Array.flatMap', () => typeof Array.prototype.flatMap === 'function')
        check('array', 'Array.from', () => typeof Array.from === 'function')
        check('array', 'Array.of', () => typeof Array.of === 'function')

        // Object 方法
        check('object', 'Object.entries', () => typeof Object.entries === 'function')
        check('object', 'Object.values', () => typeof Object.values === 'function')
        check('object', 'Object.fromEntries', () => typeof Object.fromEntries === 'function')
        check('object', 'Object.assign', () => typeof Object.assign === 'function')
        check('object', 'Object.keys', () => typeof Object.keys === 'function')

        // String 方法
        check('string', 'String.includes', () => typeof String.prototype.includes === 'function')
        check(
          'string',
          'String.startsWith',
          () => typeof String.prototype.startsWith === 'function'
        )
        check('string', 'String.endsWith', () => typeof String.prototype.endsWith === 'function')
        check('string', 'String.repeat', () => typeof String.prototype.repeat === 'function')
        check('string', 'String.padStart', () => typeof String.prototype.padStart === 'function')
        check('string', 'String.padEnd', () => typeof String.prototype.padEnd === 'function')

        // 渲染结果
        const syntaxContainer = document.getElementById('syntax-checks')
        const apiContainer = document.getElementById('api-checks')
        const arrayContainer = document.getElementById('array-checks')
        const objectContainer = document.getElementById('object-checks')
        const stringContainer = document.getElementById('string-checks')

        results.syntax.forEach((r) => renderCheck(syntaxContainer, r.name, r.pass))
        results.api.forEach((r) => renderCheck(apiContainer, r.name, r.pass))
        results.array.forEach((r) => renderCheck(arrayContainer, r.name, r.pass))
        results.object.forEach((r) => renderCheck(objectContainer, r.name, r.pass))
        results.string.forEach((r) => renderCheck(stringContainer, r.name, r.pass))

        // 计算统计
        const allResults = [
          ...results.syntax,
          ...results.api,
          ...results.array,
          ...results.object,
          ...results.string,
        ]
        const passCount = allResults.filter((r) => r.pass).length
        const totalCount = allResults.length
        const score = Math.round((passCount / totalCount) * 100)

        // 更新摘要
        document.getElementById('browser-type').textContent = getBrowserType()
        document.getElementById('compatibility-score').textContent =
          `${score}% (${passCount}/${totalCount})`
        document.getElementById('pass-count').textContent = `${passCount} / ${totalCount}`

        // 显示推荐
        const recommendation = document.getElementById('recommendation')
        if (score < 80) {
          recommendation.style.display = 'block'
          recommendation.innerHTML = `
          <h3>⚠️ 浏览器兼容性较差</h3>
          <p>您的浏览器得分: <strong>${score}%</strong>,可能无法正常使用五好伴学的所有功能。</p>
          <p><strong>建议:</strong></p>
          <ul>
            <li>更新您的浏览器到最新版本</li>
            <li><strong>iOS 用户</strong>: 更新到 iOS 13+ 并使用最新版 Safari</li>
            <li><strong>Android 用户</strong>: 安装最新版 Chrome 浏览器</li>
            <li>如果无法更新,请联系技术支持</li>
          </ul>
        `
        } else if (score < 95) {
          recommendation.style.display = 'block'
          recommendation.innerHTML = `
          <h3>✅ 浏览器兼容性良好</h3>
          <p>您的浏览器得分: <strong>${score}%</strong>,可以正常使用五好伴学的大部分功能。</p>
          <p><strong>建议</strong>: 更新浏览器到最新版本以获得最佳体验。</p>
        `
        } else {
          recommendation.style.display = 'block'
          recommendation.innerHTML = `
          <h3>🎉 浏览器兼容性优秀</h3>
          <p>您的浏览器得分: <strong>${score}%</strong>,完全支持五好伴学的所有功能!</p>
          <p>可以放心使用所有功能。</p>
        `
        }

        // 显示结果,隐藏加载
        document.getElementById('loading').style.display = 'none'
        document.getElementById('results').style.display = 'block'
      }, 500)
    </script>
  </body>
</html>
